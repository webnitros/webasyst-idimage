var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(f,g){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",d=0,e=function(f){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b(c+(f||"")+"_"+d++,f)};return e},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");
(function(a){var b=function(c,d,e){var f=/[^\w\-\.:]/.test(c)?new Function(b.arg+",tmpl","var _e=tmpl.encode"+b.helper+",_s='"+c.replace(b.regexp,b.func)+"';return _s;"):e?b.cache[c]=b(b.load(c)):b.cache[c]=b.cache[c]||b(b.load(c));return d?f(d,b):function(g){return f(g,b)}};b.cache={};b.load=function(c){var d=document.getElementById(c),e=/<\\\/(\w+)/g;if(!d&&console)throw{message:"template with id="+c+" not found"};return d?("textarea"==d.tagName.toLowerCase()?d.value:document.getElementById(c).innerHTML).replace(e,
"</$1"):null};b.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;b.func=function(c,d,e,f,g,h){if(d)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[c]||"\\"+c;if(e)return"="===e?"'+_e("+f+")+'":"'+("+f+"||'')+'";if(g)return"';";if(h)return"_s+='"};b.encReg=/[<>&"'\x00]/g;b.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};b.encode=function(c){return String(c||"").replace(b.encReg,function(d){return b.encMap[d]||""})};b.arg="o";b.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return b}):a.tmpl=b})(this);(function(a){a.fn.lazyLoad=function(b,c){function d(){if(e.stopped)this.onscroll=null;else if(!e.stopped&&!e.loading&&h(g,f)<=e.distance){if(null!==e.hash){var k=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(k)){this.onscroll=null;return}}e.load()}}if("stop"==b){var e=this.data("lazyLoadSettings");e&&(e.stopped=!0)}else if("reload"==b){if(e=this.data("lazyLoadSettings"))e.stopped=!1,e.loading=!1,this.get(0).onscroll=null,this.lazyLoad(e)}else if("sleep"==b){if(e=this.data("lazyLoadSettings"))e.loading=
!0}else if("wake"==b){if(e=this.data("lazyLoadSettings"))e.loading=!1}else if("force"==b)(e=this.data("lazyLoadSettings"))&&(e.loading||e.load());else{if("get"===b)return e=this.data("lazyLoadSettings")||{},e[c];this.data("lazyLoadSettings",a.extend({distance:50,load:function(){},container:g,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},b||{}));e=this.data("lazyLoadSettings");e.loading=!1;e.stopped=!1;var f=a(window),g=e.container||a(this);
null===e.hash||a.isArray(e.hash)||(e.hash=[e.hash]);a.fn.lazyLoad.call(f,e.state);(function(){var k,l=setTimeout(k=function(){if(e.stopped)clearTimeout(l);else{if(null!==e.hash){var m=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===e.hash.indexOf(m)){clearTimeout(l);return}}e.loading?l=setTimeout(k,350):(h(g,f),h(g,f)<=e.distance?(e.load(),l=setTimeout(k,350)):(f.get(0).onscroll=d,clearTimeout(l)))}},350)})();var h="function"===typeof e.distanceBetweenBottoms?e.distanceBetweenBottoms:
function(k,l,m){k="string"===typeof k?a(k):k;m=m||0;return k.position().top+k.outerHeight()-m-(l.scrollTop()+l.height())}}}})(jQuery);$.fn.liveDraggable=function(a){this.each(function(c,d){c=$(this);c.data("init_draggable")&&c.off("mouseover",c.data("init_draggable"))});var b;this.off("mouseover").on("mouseover",b=function(){var c=$(this);c.data("init_draggable")||c.data("init_draggable",b).draggable(a)})};
$.fn.liveDroppable=function(a){this.each(function(c,d){c=$(this);c.data("init_droppable")&&c.off("mouseover",c.data("init_droppable"))});var b=function(){var c=$(this);c.data("init_droppable")||(c.data("init_droppable",b).droppable(a),c.mouseover())};b.call(this);this.off("mouseover",b).on("mouseover",b)};(function(a){a.fn.inlineEditable=function(b,c){function d(){m(a(this))||a(this).addClass(n.placeholderClass).text(n.placeholder)}function e(){m(a(this))==n.placeholder&&a(this).text("").removeClass(n.placeholderClass)}function f(q){return a(q).val()?!1:(a(this).text(n.placeholder).addClass(n.placeholderClass),!0)}function g(){u="edit";this.id=this.id||(""+Math.random()).slice(2);var q=this.id+"-input",t=a("#"+q);if(!t.length){var v=r,w=v.after;a:switch(n.inputType){case "textarea":var B='<textarea id="'+
q+'" style="display:none;"></textarea>';break a;default:B='<input type="text" id="'+q+'" style="display:none;">'}w.call(v,B);t=a("#"+q)}t.addClass(n.inputClass);k(t,r);n.placeholder&&m(a(this))==n.placeholder&&e.call(r);n.beforeMakeEditable.call(this,t);x=n.truncate?r.data("real_text"):m(r);t.val(x).show().focus();r.hide();a(n.editLink).hide();if(!p){q=[];var y=[];v=0;for(w=n.makeReadableBy.length;v<w;++v)B=n.makeReadableBy[v],"blur"==B&&t.blur(function(){"read"!=u&&h.call(this)}),"enter"==B&&q.push(13),
"esc"==B&&q.push(27);v=0;for(w=n.updateBy.length;v<w;++v)B=n.updateBy[v],"alt+enter"==B&&y.push({ctrl:!1,alt:!0,shift:!1,key:13}),"ctrl+enter"==B&&y.push({ctrl:!0,alt:!1,shift:!1,key:13}),"ctrl+s"==B&&y.push({ctrl:!0,alt:!1,shift:!1,key:17});q.length&&function(z){t.keydown(function(A){!~z.indexOf(A.keyCode)||A.ctrlKey||A.altKey||A.shiftKey||"read"!=u&&h.call(this,27==A.keyCode?x:null);if(y.length)for(var D in y){var C=y[D];if(A.keyCode==C.key&&A.ctrlKey==C.ctrl&&A.altKey==C.alt&&A.shiftKey==C.shift){r.trigger("readable");
break}}})}(q);r.unbind("readable.inlineEditable").bind("readable.inlineEditable",function(z,A){"read"!=u&&(z=a("#"+(this.id+"-input")),h.call(z,z.val(),A))});p=!0}n.afterMakeEditable.call(this,t)}function h(q,t){t="undefined"===typeof t?!1:!0;void 0!=q&&null!=q?a(this).val(q):q=a(this).val();if(!1!==t||!1!==n.beforeBackReadable.call(r.get(0),this,{changed:q!=x,old_text:x,new_text:q})){u="read";if(!n.placeholder||!f.call(r,this))if(n.allowEmpty||q){if(n.truncate)r.data("real_text",q),r.text(q.length<
n.truncate-3?q:q.substr(0,n.truncate-3)+"...");else{var v=r,w=q;n.html?v.html(w):v.text(w)}q||d.call(this)}r.show();a(this).hide();a(n.editLink).show();!1===t&&n.afterBackReadable.call(r.get(0),this,{changed:q!=x,old_text:x})}}function k(q,t){var v=n.size.height||t.height();t=n.size.width||1.5*t.width();v=n.minSize.height&&v<n.minSize.height?n.minSize.height:v;t=n.minSize.width&&t<n.minSize.width?n.minSize.width:t;v=n.maxSize.height&&v>n.maxSize.height?n.maxSize.height:v;t=n.maxSize.width&&t>n.maxSize.width?
n.maxSize.width:t;q.height(v);q.width(t)}function l(q){return function(){return q}}function m(q){return n.html?q.html():q.text()}if(this.length){var p=!1;if("string"==typeof b){if("setOption"==b){var n=this.data("inlineEditableSettings")||{};a.extend(!0,n,c);"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(n.hold=l(n.hold));this.data("inlineEditableSettings",n)}return this}c=this.data("inlineEditableSettings");this.data("inlineEditableSettings",a.extend({inputType:"text",inputClass:"",size:{height:null,
width:null},minSize:{height:null,width:null},maxSize:{height:null,width:null},editLink:null,editOnItself:!0,placeholder:null,makeReadableBy:["blur","enter","esc"],updateBy:["ctrl+enter","alt+enter"],beforeBackReadable:function(){},afterBackReadable:function(){},beforeMakeEditable:function(){},afterMakeEditable:function(){},placeholderClass:"hint",truncate:!1,hold:!1,html:!1,allowEmpty:!1},c,b||{}));n=this.data("inlineEditableSettings")||{};var r=this,u="read",x="";"function"!==typeof n.hold&&(n.hold=
l(n.hold));(function(){if(!this.data("inited")){n.truncate&&"boolean"==typeof n.truncate&&(n.truncate=255);if(n.truncate){var q=n.placeholder&&n.placeholder===this.text()?"":this.text();this.data("real_text",q);this.text(q.length<n.truncate-3?q:q.substr(0,n.truncate-3)+"...")}n.placeholder&&d.call(this);n.editLink&&a(n.editLink).unbind("click.inlineEditable").bind("click.inlineEditable",function(){n.hold.call(r)||"edit"!=u&&g.call(r.get(0))});n.editOnItself&&this.unbind("click.inlineEditable").bind("click.inlineEditable",
function(){n.hold.call(r)||"edit"!=u&&g.call(this)});this.unbind("editable.inlineEditable").bind("editable.inlineEditable",function(){n.hold.call(r)||"edit"!=u&&g.call(this)});this.unbind("placeholder.inlineEditable").bind("placeholder.inlineEditable",function(t,v){v&&n.placeholder&&d.call(this);v||a(this).removeClass(n.placeholderClass)});this.data("inited",!0)}}).call(this);return this}}})(jQuery);(function(a){a.fn.photoStreamSlider=function(b){function c(){function f(q){function t(){f.execution=!1;var A="on"+v.charAt(0).toUpperCase()+v.slice(1);A=d[A];"function"==typeof A&&A.call(e);A=q.fn;"function"==typeof A&&A.call(e)}"string"==typeof q&&(q={direction:q,animate:!0});var v=q.direction||"forward",w=q.steps||h.length;if(!f.execution){f.execution=!0;var B=h.filter(":first").outerWidth()*w,y=h.length;if("forward"==v){var z=h.filter(":last").nextAll(":lt("+w+")");w=z.length;z=z.filter(":last");
w&&(h.removeClass("visible"),z.prevAll(":lt("+(y-1)+")").addClass("visible"),z.addClass("visible"))}else z=h.filter(":first").prevAll(":lt("+w+")"),w=z.length,z=z.filter(":last"),w&&(h.removeClass("visible"),z.nextAll(":lt("+(y-1)+")").addClass("visible").show(),z.addClass("visible"));h=a("li.visible",g);y=g.position().left;"forward"==v?(w=m-l-r,y-=B,y=y>-w?y:-w):(y+=B,y=y<r?y:r);q.animate?g.animate({left:y},d.duration,t):(g.css({left:y}),t())}}var g=e.find(d.photoStream),h=a("li.visible",g),k=a("li",
g),l=h.filter(":first").outerWidth()*h.length,m=k.filter(":first").outerWidth()*k.length,p=d.height||k.filter(":first").outerHeight();g.parent().css({overflow:"hidden",height:p,position:"relative",padding:"4px 0",margin:0,width:l});p=g.find("li:first");var n=h.filter(":first"),r=(n.outerWidth()-n.width())/2,u=0,x=p.outerWidth();for(n=n.get(0);p.length&&p.get(0)!=n;)u+=x,p=p.next();g.css({position:"absolute",left:-(u-r),width:m});a(d.forwardLink).unbind("click").bind("click",function(){f("forward");
return!1});a(d.backwardLink).unbind("click").bind("click",function(){f("backward");return!1});e.unbind("append prepend").bind("append prepend",function(q,t){if("append"==q.type){for(var v=g.find("li:last"),w=a();v.hasClass("dummy");)w=w.add(v),v=v.prev("li");w.remove();g.append(t)}else{v=a("<div></div>").html(t);t=v.find("li");var B=t.length*x;v.remove();v=g.find("li:first");for(w=a();v.hasClass("dummy");)w=w.add(v),v=v.next("li");w.remove();g.prepend(t)}k=g.find("li");m=k.filter(":first").outerWidth()*
k.length;g.css("width",m);"prepend"==q.type&&(g.is(":animated")&&g.stop(!1,!0),g.css("left",parseInt(g.css("left"))-B));g.find("li.selected").hasClass("visible")&&e.trigger("home",[null,!1])});e.unbind("forward backward").bind("forward backward",function(q,t){f({direction:q.type,steps:t.steps,animate:"undefined"!==typeof t.animate?t.animate:!0,fn:t.fn});t=g.find("li.selected");q="forward"==q.type?t.next("li:not(.dummy)"):t.prev("li:not(.dummy)");q.length&&(t.removeClass("selected"),q.addClass("selected"))});
e.unbind("home").bind("home",function(q,t,v){q=parseInt(h.length/2);q=h.filter(":eq("+q+")");var w=q.nextAll(".selected:first"),B=q.prevAll(".selected:first"),y=0,z="";"function"!==typeof t&&(v=t);v="undefined"!==typeof v?v:!0;w.length?(z="forward",q.nextAll().each(function(){++y;if(a(this).hasClass("selected"))return!1})):B.length&&(z="backward",q.prevAll().each(function(){++y;if(a(this).hasClass("selected"))return!1}));z&&y?f({direction:z,steps:y,fn:t,animate:v}):"function"==typeof t&&t();return!1});
e.unbind("refresh").bind("refresh",function(){c()})}var d=a.extend({duration:200,height:48},b||{}),e=this;c()}})(jQuery);(function(a){function b(){a("#hint-menu-block").hide().children().hide()}a.product_dragndrop={handlers:{},options:{},init:function(c){this.options=c;c.collections&&(this.initDragCollections(),this.initDropCollections());c.products&&(this.initDragProducts(),this.initDropProducts());return this},bind:function(c,d){this.handlers[c]=d;return this},trigger:function(c){if("function"===typeof this.handlers[c])return this.handlers[c].apply(this,Array.prototype.slice.call(arguments,1))},initDragProducts:function(){var c=
a("#product-list"),d=c.find(".product:not(.s-alien)");d.find(".drag-handle").on("selectstart",function(){document.onselectstart=function(){return!1};return!1});d.liveDraggable({opacity:.75,zIndex:9999,distance:5,appendTo:"body",cursor:"move",refreshPositions:!0,containment:[0,0,a(window).width(),{toString:function(){return a(document).height()}}],start:function(e,f){document.ondragstart=function(){return!1};f.helper.data("scrollTop",a(document).scrollTop());a(document).bind("scroll",a.product_dragndrop._scrolHelper);
a(".block.drop-target").addClass("drag-active")},handle:".drag-handle",stop:function(e,f){document.ondragstart=null;document.onselectstart=null;e=a(this);e.find("input:checked").length||e.removeClass("selected");b();a(document).unbind("scroll",a.product_dragndrop._scrolHelper);a(".block.drop-target").removeClass("drag-active");b()},helper:function(e,f){e=1;f=c.find(".s-select-all");f.is(":checked")?e=f.attr("data-count"):(f=c.find(".product.selected"),f.length?-1!==f.index(this)?e=f.length:(a(this).trigger("select",
!0),e=f.length+1):a(this).addClass("selected"));return'<div id="products-helper"><span class="indicator red">'+e+'</span><i class="icon10 no-bw" style="display:none;"></i></div>'},drag:function(e,f){e=e.originalEvent;f.position.left=e.pageX-20;f.position.top=e.pageY}})},initDropProducts:function(){a("#product-list .product").liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",over:function(c,d){if(a(this).hasClass("s-alien")||!d.draggable.hasClass("product"))return!1;if(a.product_dragndrop.trigger("is_product_sortable"))b();
else if(c=a.product_dragndrop.options.sort)d=a("#hint-menu-block").show(),d.children().hide(),d.find("."+c).show();a.product_dragndrop._activatePhotoListItem.call(this)},out:function(c,d){a.product_dragndrop._unactivatePhotoListItem.call(this)},drop:function(c,d){if(!d.draggable.hasClass("product"))return!1;var e=a(this);if(e.hasClass("selected"))return a.product_dragndrop._unactivatePhotoListItem.call(this),!1;var f=a("#product-list").find(".product.selected");if(!a.product_dragndrop.trigger("is_product_sortable"))return a.product_dragndrop._unactivatePhotoListItem.call(this),
a.product_dragndrop._unactivatePhotoListItem.call(d.draggable),!1;c=null;if(e.hasClass("s-alien")){var g=e.nextAll(":not(.s-alien):first");if(g.length)c=g.attr("data-product-id"),g.before(f);else{g=e.prevAll(":not(.s-alien):first");if(!g.length||g.hasClass("selected"))return!1;c=null;g.after(f)}g.hasClass("last")&&(g.removeClass("last"),f.filter(":last").addClass("last"))}else e.hasClass("drag-active-last")||(c=e.attr("data-product-id")),e.hasClass("last")&&e.hasClass("drag-active-last")?(e.after(f).removeClass("drag-active drag-active-last last"),
f.filter(":last").addClass("last")):e.before(f).removeClass("drag-active"),e.removeClass("drag-active drag-active-last");a.product_dragndrop._unactivatePhotoListItem.call(this);a.product_dragndrop._unactivatePhotoListItem.call(d.draggable);f.trigger("select",!1);d=f.map(function(){return a(this).attr("data-product-id")}).toArray();a.product_dragndrop.trigger("move_product",{product_ids:d,before_id:c,error:function(h){h&&console&&console.log("undefined"!==typeof h.errors?h.errors:h)}})}})},initDragCollections:function(){var c=
a("#wa-app .sidebar:first"),d=c.position(),e=c.width();c=c.height();a(".s-collection-list li.dr").liveDraggable({containment:[d.left,d.top,d.left+1.25*e,d.top+1.25*c],refreshPositions:!0,revert:"invalid",helper:function(){var f=a(this),g=f.parents(".s-collection-list:first").find("ul:first");f=f.clone().addClass("ui-draggable dr-helper").css({position:"absolute"}).prependTo(g);f.find("a:first").append('<i class="icon10 no-bw" style="margin-left: 0; margin-right: 0; display:none;"></i>');return f},
cursor:"move",cursorAt:{left:5},opacity:.75,zIndex:9999,distance:5,start:function(f,g){document.ondragstart=function(){return!1}},stop:function(){document.ondragstart=null}})},initDropCollections:function(){this.initDropBetweenCollections();this.initDropInsideCollections()},initDropBetweenCollections:function(){a(".s-collection-list li.drag-newposition").liveDroppable({greedy:!0,tolerance:"pointer",over:function(c,d){c=a(this);if(d.draggable.attr("data-type")!=c.attr("data-type"))return!1;c.addClass("active").parent().parent().addClass("drag-active")},
out:function(c,d){c=a(this);if(d.draggable.attr("data-type")!=c.attr("data-type"))return!1;c.removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(c,d){var e=a(this);if(d.draggable.attr("data-type")!=e.attr("data-type"))return!1;(e.is(":animated")||e.hasClass("dragging"))&&e.stop().animate({height:"2px"},300,null,function(){e.removeClass("dragging")});e.removeClass("active").parent().parent().removeClass("drag-active")},drop:function(c,d){var e=a(this),f=d.draggable;
d=f.attr("data-type");if(d!=e.attr("data-type"))return!1;c=function(u){u=u.split("-");u.shift();return u.join("-")};var g=c(f.attr("id")),h=e.prev("li"),k=f.next(),l=f.prev();if(h.length&&h.attr("id")=="category-"+g&&!h.hasClass("dr-helper")||this==f.next().get(0))return!1;var m=f.parent("ul"),p=m.children("li.dr[id!=category-"+g+"]").length,n=parseInt(c(m.parent().attr("id")),10)||0;e.after(k).after(f);e=f.parent().parent();if(e.is("li.dr")||e.is(".s-collection-list")){var r=0;e.is(".s-collection-list")||
(r=parseInt(c(e.attr("id")),10)||0);e=f.nextAll("li.dr:first");h=null;e.length&&(h=c(e.attr("id"))||null);p||n===r||(m.parent("li").children("i").hide(),m.hide());a.product_dragndrop.trigger("move_list",{id:g,type:d,before_id:h,parent_id:r,success:function(u){p||n===r||(m.parent("li").children("i").remove(),m.remove(),a.categories_tree.setCollapsed(n))},error:function(u){u&&console&&console.log("undefined"!==typeof u.errors?u.errors:u);l.after(f.next()).after(f);p||m.show()}})}}})},initDropInsideCollections:function(){a(".s-collection-list li.dr a").liveDroppable({tolerance:"pointer",
greedy:!0,out:function(c,d){c=d.draggable;var e=a(this).parent();if(!c.hasClass("product")&&e.attr("data-type")!=c.attr("data-type"))return!1;c.hasClass("product")&&d.helper.find("span").show().end().find("i").hide();e.removeClass("drag-newparent")},over:function(c,d){var e=d.draggable;c=a(this).parent();var f=e.attr("data-type");if(!e.hasClass("product")&&f!=c.attr("data-type"))return!1;"set"!=f&&c.addClass("drag-newparent");if(e.hasClass("product"))return c.hasClass("dynamic")?d.helper.find("span").hide().end().find("i").show():
d.helper.find("span").show().end().find("i").hide(),!1;if(!e.hasClass("dynamic")&&c.hasClass("dynamic"))return d.helper.find("i.no-bw").show(),!1;d.helper.find("i.no-bw").hide();var g='.dr[id!="'+e.attr("id")+'"]',h=a(),k=function(m,p){if(!p.length)return m;m=m.add(p.nextUntil(g).filter("li.drag-newposition"));return 0<p.nextAll(g).length?m:k(m,p.parent().closest("li"))};d=c.prevAll(g+":first");0<d.length?(e=d.find(g),h=0<e.length?k(h,e.last()):k(h,d)):h=h.add(c.prevUntil(g).filter("li.drag-newposition"));
h=0<c.children("ul").children(g).length?h.add(c.children("ul").children("li.drag-newposition:first")):k(h,c);var l=a(".drag-newposition:animated, .drag-newposition.dragging").not(h);l.stop().animate({height:"2px"},300,null,function(){l.removeClass("dragging")});h.stop().animate({height:"10px"},300,null,function(){h.addClass("dragging")})},drop:function(c,d){var e=d.draggable,f=a(this).parent();c=e.attr("data-type");if(!e.hasClass("product")&&("set"==c||f.attr("id")==e.attr("id")||c!=f.attr("data-type")))return!1;
f.removeClass("drag-newparent");if(e.hasClass("product")){if(f.hasClass("dynamic"))return!1;var g=a("#product-list"),h={};if(g.find(".s-select-all").is(":checked"))h.whole_list=!0;else{var k=g.find(".product.selected");h.product_ids=k.map(function(){return a(this).attr("data-product-id")}).toArray()}a.product_dragndrop.trigger("add_to_list",a.extend(h,{collection_param:f.attr("id").replace("-","_id="),success:function(t){h.whole_list?g.find(".s-select-all").trigger("select",!1):h.product_ids&&h.product_ids.length&&
k.trigger("select",!1);t.data&&(f.find(">.counters .count:not(.subtree)").text(t.data.count),f.find(">.counters .subtree").text(t.data.total_count))}}));return!1}if(!e.hasClass("dynamic")&&f.hasClass("dynamic"))return!1;d=e.attr("id").split("-")[1];if(f.attr("id")=="category-"+d)return!1;if(e.hasClass("product"))return a("#product-list").find(".product.selected").trigger("select",!1),!1;var l=parseInt(f.attr("id").split("-")[1],10)||0,m=null,p=e.next(),n=e.prev(),r=!1;f.hasClass("drag-newposition")?
m=f.parent("ul"):f.children("ul").length?m=f.children("ul"):f.find(">i.collapse-handler-ajax").length||(m=a('<ul class="menu-v with-icons dr unapproved"><li class="drag-newposition unapproved" data-type="'+c+'"></li></ul>').appendTo(f),m.find(".drag-newposition").mouseover(),a('<i class="icon16 darr overhanging collapse-handler-ajax unapproved" id="'+c+"-"+l+'-handler"></i>').insertBefore(f.children("a")),r=!0);var u=e.parent("ul"),x=u.children("li.dr[id!=category-"+d+"]").length,q=parseInt(u.parent().attr("id").split("-")[1],
10)||0;m&&m.append(e).append(p);x||q===l||(u.parent("li").children("i").hide(),u.hide());f.is("li.dr")&&a.product_dragndrop.trigger("move_list",{id:d,type:c,parent_id:l,success:function(t){x||q===l||(u.parent("li").children("i").remove(),u.remove(),a.categories_tree.setCollapsed(q));m?(a(".s-collection-list .unapproved").removeClass("unapproved"),r?a.categories_tree.setExpanded(l):f.trigger("count_subtree")):(e.remove(),p.remove(),f.trigger("update_counters",t.data.count||{}))},error:function(t){t&&
console&&console.log("undefined"!==typeof t.errors?t.errors:t);n.after(e).after(p);x||u.show();a(".s-collection-list .unapproved").remove()}})}})},_scrolHelper:function(c){c=a("#products-helper");var d=c.data("scrollTop"),e=a(document).scrollTop();d=d?e-d:50;c.css("top",c.position().top+d+"px");c.data("scrollTop",e)},_extDragActivate:function(c,d,e){var f=e+"-last";if(d.hasClass("last")){var g=c.pageX;c=c.pageY;var h=d.width(),k=d.height(),l=d.offset();"thumbs"==a.product_dragndrop.options.view?g>
l.left+.5*h&&g<=l.left+h?(d.removeClass(e).addClass(f),a.product_dragndrop._shiftToLeft(d)):g>l.left&&g<=l.left+.5*h?(d.removeClass(f).addClass(e),a.product_dragndrop._shiftToRight(d)):a.product_dragndrop._shiftAtPlace(d):"table"==a.product_dragndrop.options.view&&(c>l.top+.5*k?d.removeClass(e).addClass(f):c>l.top&&d.removeClass(f).addClass(e));(c<l.top||c>l.top+k||g<l.left||g>l.left+h)&&d.removeClass(e).removeClass(f)}else d.addClass("drag-active")},_bindExtDragActivate:function(c,d){a(document).bind("mousemove.ext_drag_activate",
function(e){a.product_dragndrop._extDragActivate(e,c,d)})},_unbindExtDragActivate:function(){a(document).unbind("mousemove.ext_drag_activate")},_activatePhotoListItem:function(){var c=a(this),d=a.product_dragndrop.trigger("is_product_sortable"),e=d?"drag-active":"drag-active-disabled";d&&"thumbs"==a.product_dragndrop.options.view&&a.product_dragndrop._shiftToRight(c);c.hasClass("last")?a.product_dragndrop._bindExtDragActivate(c,e):c.addClass(e)},_unactivatePhotoListItem:function(){var c=a(this),d=
a.product_dragndrop.trigger("is_product_sortable"),e=d?"drag-active":"drag-active-disabled",f=e+"-last";c.hasClass("last")&&a.product_dragndrop._unbindExtDragActivate();c.removeClass(e+" "+f);d&&"thumbs"==a.product_dragndrop.options.view&&a.product_dragndrop._shiftAtPlace(c)},_shiftToLeft:function(c){if("left"!==c.data("shifted")){var d=c.find(".p-wrapper");if(!d.length){var e=c.children();d=a("<div class='p-wrapper' style='position:relative;'></div>").appendTo(c);d.append(e)}d.stop().animate({left:-15},
200);c.data("shifted","left")}},_shiftToRight:function(c){if("right"!==c.data("shifted")){var d=c.find(".p-wrapper");if(!d.length){var e=c.children();d=a("<div class='p-wrapper' style='position:relative;'></div>").appendTo(c);d.append(e)}d.stop().animate({left:15},200);c.data("shifted","right")}},_shiftAtPlace:function(c){if(c.data("shifted")){var d=c.find(".p-wrapper");if(d.length){var e=d.children();d.stop().css({left:0});c.append(e);d.remove()}c.data("shifted","")}}}})(jQuery);(function(a){var b=function(h){var k=/^category-(.*?)-handler$/;return k.test(h.attr("id"))?h.attr("id").replace(k,function(l,m){return parseInt(m,10)||0}):0},c=function(h){if(b(h))h=h.parents("li:not(.drag-newposition):first"),l=k=h.find("ul:first");else{h=h.parent();var k=h.next(),l=k.find("ul:first")}return{parent:h,target:k,ul:l}},d=function(h,k){var l=c(h);"category"==l.parent.attr("data-type")&&l.parent.trigger("count_subtree",!1);h.removeClass("rarr").addClass("darr");l.target.show();"function"===
typeof k&&k(h)},e=function(h,k){var l=h.parent.find(".loading:first");h=h.parent.find(".counters");k?(l.show(),h.hide()):(l.hide(),h.show())},f=function(h,k){var l=c(h);"category"!=l.parent.attr("data-type")||l.parent.hasClass("dynamic")||l.parent.trigger("count_subtree",!0);h.removeClass("darr").addClass("rarr");l.target.hide();"function"===typeof k&&k(h);a.get("?action=categoryExpand&id="+b(h)+"&collapsed=1")},g=function(h,k,l){if(!h.data("loading_content")){var m=c(h);m.ul.length?d(h,k):e(m,!0);
var p=!m.ul.length;h.data("loading_content",p);a.get("?action=categoryExpand&id="+b(h)+(p?"&tree=1":""),function(n){p&&(m.target.length?m.target.append(n):m.parent.append(n),e(m,!1),d(h,k),h.data("loading_content",!1));"function"===typeof l&&l()})}};a.categories_tree={init:function(){a("#s-category-list-block").off("click",".collapse-handler-ajax").on("click",".collapse-handler-ajax",function(){var h=a(this);h.hasClass("darr")?f(h):g(h)});a("#s-category-list-block .heading").off("click").click(function(h){var k=
a(this).find(".collapse-handler-ajax");k.is(h.target)||k.click()})},collapse:function(h,k){h=a(h);h.hasClass("darr")?f(h,k):"function"===typeof k&&k(h)},expand:function(h,k,l){h=a(h);h.hasClass("rarr")?g(h,k,l):("function"===typeof k&&k(h),"function"===typeof l&&l(h))},isCollapsed:function(h){return a(h).hasClass("rarr")},setExpanded:function(h){a.get("?action=categoryExpand&id="+h)},setCollapsed:function(h){a.get("?action=categoryExpand&id="+h+"&collapsed=1")},getHandlerByCategoryId:function(h){a();
return(h=parseInt(h,10)||0)?a("#category-"+h+"-handler"):a("#s-category-list-handler")}}})(jQuery);(function(a){a.product_sidebar={options:{},init:function(){var b=a("#s-sidebar");a.product_dragndrop.init({collections:!0}).bind("move_list",function(d){function e(g){g='<div class="dialog width650px height250px small">\n    <div class="dialog-background"></div>\n        <div class="dialog-window">\n        <div class="dialog-content">\n            <div class="dialog-content-indent">\n                <p>%text%</p>\n            </div>\n        </div>\n        <div class="dialog-buttons">\n            <div class="dialog-buttons-gradient">\n                <input class="button gray cancel" type="button" value="%button_text%">\n            </div>\n        </div>\n    </div>\n</div>'.replace("%text%",
g).replace("%button_text%",a.wa.locale.Close);var h=a(g);h.waDialog({onClose:function(){h.remove()}})}if(d.type){var f={id:d.id,type:d.type,parent_id:d.parent_id||0};d.before_id&&(f.before_id=d.before_id);a.products.jsonPost("?module=products&action=moveList",f,d.success,function(g){g.errors&&g.errors.length&&a.each(g.errors,function(h,k){h=null;"string"===typeof k&&(h=k);"string"===typeof k.text&&(h=k.text);h&&e(h)});return"function"===typeof d.error?d.error(g):d.error})}else"function"===typeof d.error&&
d.error("Unknown list type")});b.off("add",".s-collection-list ul").on("add",".s-collection-list ul",function(d,e,f,g){d=a(this);var h=d.parents(".s-collection-list:first"),k=a("<ul></ul>");k.append(tmpl("template-sidebar-list-item",{type:f,item:e}));e=k.children(":not(.drag-newposition):first");f=e.attr("id");f=d.find("#"+f);var l=k.children();f.length?g&&f.replaceWith(e):d.prepend(l).show();l.each(function(){var m=a(this);m.hasClass("dr")?m.find("a").mouseover():m.mouseover()});d.find(".drag-newposition").css({height:"2px"}).removeClass("dragging");
h.find(".s-empty-list").hide();k.remove();return!1});b.unbind("update").bind("update",function(d,e){for(var f in e)if("all"==f)a("#s-all-products").find(".count:first").text(e[f].count);else{d="#"+f+"-";for(var g in e[f])a(d+g).find(".count:first").text(e[f][g].count)}return!1});a("#s-tag-cloud").unbind("update").bind("update",function(d,e){d='<ul class="tags"><li class="block align-center">';for(var f in e){var g=e[f];d+='<a href="#/products/tag='+g.uri_name+'/" style="font-size: '+g.size+"%; opacity: "+
g.opacity+'"  data-id="'+g.id+'"  class="s-product-list">'+g.name+"</a> "}d+="</li></ul>";a("#s-tag-cloud").html(d).parents(".block:first").show();return!1});b.off("count_subtree",".s-collection-list li").on("count_subtree",".s-collection-list li",function(d,e){var f=a(this);"undefined"===typeof e&&(e=f.find("i.collapse-handler-ajax").hasClass("rarr"));d=f.find(">.counters .count:not(.subtree)");f=f.find(">.counters .subtree");f.length||(f=d.clone().addClass("subtree").hide(),d.after(f));e?(d.hide(),
f.show()):(f.hide(),d.show());return!1});b.off("update_counters",".s-collection-list li").on("update_counters",".s-collection-list li",function(d,e){var f=a(this);d=f.find(">.count:not(.subtree)");f=f.find(">.subtree");f.length||(f=d.clone().addClass("subtree").hide(),d.after(f));"undefined"!==typeof e.item&&d.text(parseInt(e.item,10)||0);"undefined"!==typeof e.subtree&&f.text(parseInt(e.subtree,10)||0);return!1});var c=b.find("#s-category-list-widen-arrows");c.find("a.arrow").unbind("click").bind("click",
function(){var d=b.attr("class"),e=0,f=d.match(/left([\d]{2,3})px/);if(f&&f[1]&&(e=parseInt(f[1]))&&(f=e+(a(this).is(".right")?50:-50),f=Math.max(Math.min(f,1E3),200),f!=e)){c.css({width:f.toString()+"px"});e=["left"+e+"px","left"+f+"px"];b.attr("class",d.replace(e[0],e[1]));b.css("width","");var g=a("#s-content");d=g.attr("class");g.attr("class",d.replace(e[0],e[1]));g.css("margin-left","");a.product&&a.product.setOptions({sidebar_width:f});a.shop.jsonPost("?action=sidebarSaveWidth",{width:f});b.trigger("change_width",
[f])}return!1});b.off("click","#s-forcesort-by-name").on("click","#s-forcesort-by-name",function(){a.product_sidebar.sortCategoryDialog();return!1});b.off("click",".s-new-list").on("click",".s-new-list",function(){var d=a(this),e=d.attr("id"),f=0;e?d=e.replace("s-new-",""):(f=d.parents("li.dr:first").attr("id").split("-"),d=f[0],f=f[1]);"category"===d?shopDialogProductsCategory.staticDialog(a.product_list.collection_hash[1],f,"new"):shopDialogProductsSet.staticDialog(a.product_list.collection_hash[1],
"new");return!1})},updateItemInCategoryList:function(b,c){var d=a("#category-"+b.data.id);d.find(".name:first").html(b.data.name);a.isArray(b.data.routes)&&b.data.routes.length?d.find(".routes:first").html(" "+b.data.routes.join(" ")):d.find(".routes:first").html(" ");b.data.subcategories_updated?"0"==b.data.status?d.find("a").addClass("gray"):"1"==b.data.status&&d.find("a").removeClass("gray"):"0"==b.data.status?d.children("a").addClass("gray"):"1"==b.data.status&&d.children("a").removeClass("gray");
d.find(".id:first").html(b.data.id);d.attr("id","category-"+b.data.id);d.find("a").attr("href",c);return null},createNewElementInList:function(b,c){var d=a("#s-"+c+"-list"),e=d.find("ul:first");e.length||(d.prepend('<ul class="menu-v with-icons"><li class="drag-newposition" data-type="'+c+'"></li></ul>'),d.find(".drag-newposition").mouseover(),e=d.find("ul:first"));var f=parseInt(b.parent_id,10)||0;d=a.categories_tree.getHandlerByCategoryId(f);var g=function(){if(f){var h=e.find("#"+c+"-"+b.parent_id);
h.find(">.collapse-handler-ajax").length||(h.append('<ul class="menu-v with-icons dr"><li class="drag-newposition" data-type="'+c+'"></li></ul>'),h.find(".drag-newposition").mouseover(),h.find(">a").before('<i class="icon16 darr overhanging collapse-handler-ajax" id="'+c+"-"+f+'-handler"></i>'),a.categories_tree.setExpanded(f));e=h.find("ul:first")}e.trigger("add",[b,c])};"category"==c?a.categories_tree.expand(d,function(){g()}):g()},sortCategoryDialog:function(){a("#s-products-sort-categories").waDialog({disableButtonsOnSubmit:!0,
onSubmit:function(b){a(this)}})},initCategoryDescriptionWysiwyg:function(b){var c=b.find(".field.description");c.find("i").hide();c.find(".s-editor-core-wrapper").show();c=.8*b.find(".dialog-window").height()||350;var d=a("#s-category-description-content");d.waEditor({lang:wa_lang,toolbarFixed:!1,maxHeight:c,minHeight:c,modification_wysiwyg_msg:d.data("modification-wysiwyg-msg"),uploadFields:b.data("uploadFields")})}}})(jQuery);(function(a){a(function(){a("#s-content").on("click",".s-alert-close",function(){var b=a.storage.get("shop/alerts");b||(b=[]);b.push(a(this).parent().data("alert"));a.storage.set("shop/alerts",b);a(this).parent().remove();return!1})});a.storage=new a.store;a.products={hash:"",list_hash:"",list_params:{},options:{},random:"",init:function(b){a.extend(this.options,b);this.initRouting();this.initSearch();a.product_sidebar.init();a.categories_tree.init();this.tagsHandler()},data:{prev_action:null},initRouting:function(){"undefined"!=
typeof a.History&&a.History.bind(function(){a.products.dispatch()});a.wa.errorHandler=function(c){return 403===c.status||404===c.status?(c=a(c.responseText),c=c.find(".dialog-content").length?a('<div class="block double-padded"></div>').append(c.find(".dialog-content")):a('<div class="block double-padded"></div>').append(c.find(":not(style)")),a("#s-content").empty().append(c),!1):!0};var b=window.location.hash;"#/"!==b&&b?a.wa.setHash(b):this.dispatch()},skip_dispatch:0,forceHash:function(b){b!=
location.hash&&(a.products.skip_dispatch++,a.wa.setHash(b))},dispatch:function(b){if(0<a.products.skip_dispatch)a.products.skip_dispatch--;else{void 0===b&&(b=window.location.hash);b=b.replace(/(^[^#]*#\/*|\/$)/g,"");var c=new a.Event("shop_before_dispatched");a(window).trigger(c);if(c.isDefaultPrevented())return a.products.skip_dispatch=1,window.location.hash=a.products.list_hash,!1;this.hash=b;try{if(b)if(b=b.split("/"),b[0]){c="";for(var d=b.length,e=0;e<b.length;e++){var f=b[e];if(2>e)if(0===
e)c=f;else if("product"==c||"tag"==c||"search"==c||"plugins"==c||"pages"==c||"stocks"==c){d=e;break}else if(parseInt(f,10)!=f&&-1==f.indexOf("="))c+=f.substr(0,1).toUpperCase()+f.substr(1);else{d=e;break}else{d=e;break}}var g=b.slice(d);this.preExecute(c,g);"function"===typeof this[c+"Action"]?(a.shop.trace("$.products.dispatch",[c+"Action",g]),this[c+"Action"].apply(this,g)):a.shop.error("Invalid action name:",c+"Action")}else this.preExecute(),this.defaultAction();else this.preExecute(),this.defaultAction()}catch(h){a.shop.error(h.message,
h)}}},load:function(b,c){var d=Math.random();this.random=d;var e=this;a.get(b,function(f){if(e.random==d){a("#s-content").removeClass("bordered-left").html(f);a("html, body").animate({scrollTop:0},200);if(c)try{c.call(this)}catch(g){a.shop.error("$.products.load callback error: "+g.message,g)}a(document).trigger("wa_loaded")}})},addOptions:function(b){this.options=a.extend(this.options,b||{})},preExecute:function(b,c){try{if(this.data.prev_action&&this.data.prev_action!=b){var d=this.data.prev_action+
"Termination";a.shop.trace("$.products.preExecute",[d,b]);"function"==typeof this[d]&&this[d].apply(this,[])}this.data.prev_action=b;var e=a("#wa"),f=e.data("style");f?e.attr("style",f):e.removeAttr("style");a(window).resize();a("body > .dialog").trigger("close").remove()}catch(g){a.shop.error("preExecute error: "+g.message,g)}},defaultAction:function(){this.productsAction()},welcomeAction:function(){this.load("?module=products&action=welcome")},paramsFromSession:function(b){if(!(window.sessionStorage&&
window.JSON&&window.JSON.stringify&&window.JSON.parse))return b;if(b.category_id){storage=sessionStorage.getItem("shop/list_categories")||"{}";try{storage=JSON.parse(storage)}catch(d){storage={}}var c=storage[b.category_id]=storage[b.category_id]||{};a.each(["sort","order"],function(d,e){void 0===b[e]?b[e]=c[e]:c[e]=b[e]});try{sessionStorage.setItem("shop/list_categories",JSON.stringify(storage))}catch(d){}}return b},buildProductsUrlComponent:function(b){b=this.paramsFromSession(b);return((b.view?
"&view="+b.view:"")+(b.category_id?"&category_id="+b.category_id:"")+(b.set_id?"&set_id="+b.set_id:"")+(b.tag?"&tag="+b.tag:"")+(b.sort?"&sort="+b.sort:"")+(b.order?"&order="+b.order:"")+(b.text?"&text="+b.text:"")+(b.edit?"&edit="+b.edit:"")+(b.hash?"&hash="+b.hash:"")+(b.page?"&page="+b.page:"")+(b.type_id?"&type_id="+b.type_id:"")).slice(1)},productsAction:function(){var b=Array.prototype.join.call(arguments,"/");b=a.shop.helper.parseParams(b||"");this.list_hash=this.hash;this.list_params=b;void 0!==
a.product_list&&void 0!==a.product_list.fixed_blocks&&(a.product_list.fixed_blocks.set&&a.product_list.fixed_blocks.set.unsetFixed(),a.product_list.fixed_blocks.category&&a.product_list.fixed_blocks.category.unsetFixed());window.location.href=this.options.shop_url+"products/"},checkAlerts:function(){var b=a.storage.get("shop/alerts");a(".s-alert").each(function(){-1==a.inArray(a(this).data("alert"),b)&&a(this).show()})},productAction:function(b,c,d){"undefined"!==typeof d&&"force-old"===d&&(d="main/"+
d);var e=Array.prototype.slice.call(arguments).filter(function(g){return g.length}).join("/");a.shop.trace("$.products.productAction",[e,arguments]);var f="?module=product";b&&(f+="&id="+b);"undefined"!=typeof a.product?a.product.dispatch(e):this.load(f,function(g){a.product.dispatch(e)})},productTermination:function(){"undefined"!=typeof a.product&&a.product.termination()},reviewsAction:function(b,c){this.load("?module=reviews"+(b?"&"+b:""))},stocksAction:function(b,c){function d(f){var g=parseFloat(f);
return!isNaN(f)&&(g|0)===g}switch(b){case "log":c&&d(c)&&(c="stock_id="+c);this.load("?module=stocks&action=log"+(c?"&"+c:""));break;case "transfers":this.load("?module=stocks"+(c?"&"+c:""));break;default:var e=b&&d(b)?b:null;order=e?c:b;b="";if(order&&"desc"!==order&&"asc"!==order){if(order=String(order||""),c=order.match(/stock_count_(\d*)_*(desc|asc)*/))b="stock_count_"+c[1],order="desc"===c[2]?"desc":"asc"}else b="count";e=[].concat($jscomp.arrayFromIterable(e?["&stock_id="+e]:[]),$jscomp.arrayFromIterable(order?
["&order="+order]:[]),$jscomp.arrayFromIterable(b?["&sort="+b]:[])).join("");this.load("?module=stocks&action=balance"+e)}},transferInfo:function(b){return a.get("?module=transferInfo&id="+b)},servicesAction:function(b){this.load("?module=services"+(b?"&id="+b:""),function(){a("#s-content").addClass("bordered-left");"function"===typeof a.products.afterServicesAction&&a.products.afterServicesAction()})},tagsHandler:function(){a("#s-products-all-tags").autocomplete({source:"?module=product&action=tagsAutocomplete&type=search",
minLength:1,delay:300,select:function(b,c){a.wa.setHash("#/products/tag="+c.item.value);return!1}})},initSearch:function(){var b=function(){a.wa.setHash("#/products/"+(a.products.list_params&&a.products.list_params.view?"view="+a.products.list_params.view+"&":"")+"text="+encodeURIComponent(this.value))},c=a("#s-products-search");c.unbind("keydown").bind("keydown",function(d){if(13==d.keyCode){b.call(this);var e=a(this);e.autocomplete("close");setTimeout(function(){e.autocomplete("close")},300);return!1}});
c.unbind("search").bind("search",function(){b.call(this);return!1});c.autocomplete({source:"?action=autocomplete",minLength:3,delay:300,select:function(d,e){c.val("");a.wa.setHash("#/product/"+e.item.id);return!1}})},jsonPost:function(b,c,d,e){a.shop.jsonPost(b,c,d,e)},_iframePost:function(b,c,d){var e=b.attr("id")+"-iframe";a("#"+e).length||b.after("<iframe id="+e+" name="+e+" style='display:none;'></iframe>");var f=a("#"+e);b.attr("target",e);f.one("load",function(){try{var g=a(this).contents().find("body").html();
var h=a.parseJSON(g)}catch(k){d(g);return}"ok"==h.status?c(h):d(h)})}}})(jQuery);(function(a){a.product={options:{duration:200,container_selector:"#shop-productprofile",message_selector:"#product-save-message",form_selector:"#s-product-save",update_delay:100},message:{submit:'<i class="icon16 loading"></i>',success:'<i class="icon16 yes"></i>',error:'<i class="icon16 no"></i>'},path:{id:null,mode:null,tab:null,tail:null,raw:null,params:{}},ajax:{random:null,target:null,link:null,save:!1,cached:{}},data:{main:{}},$edit_forms:a(),getData:function(b,c){return(this.data[b]||{})[c]},
setData:function(b,c,d){this.data[b]=this.data[b]||{};this.data[b][c]=d},standalone_tabs:["images","services","pages","reviews"],init:function(b,c){this.setOptions(b,c);this.initFeatureDate();this.deleteDivider()},setOptions:function(b,c){c?this[c+"_options"]=a.extend(this[c+"_options"]||{},b||{}):this.options=a.extend(this.options,b||{});this.options.sidebar_width=this.options.sidebar_width||250},get:function(b){if(this.options[b+"_selector"])return a(this.options[b+"_selector"]);throw new exception("");
},deleteDivider:function(){a(".js-delete-divider").click(function(){a(this).parent().find("input").val("");a(this).parent().hide();a.product.helper.updateSubmitButton(!0)})},initFeatureDate:function(){function b(){var e=a(this),f=e.siblings(".js-datepicker-hidden");e.val()||f.val("");try{a.datepicker.parseDate(a.datepicker._defaults.dateFormat,e.val()),e.data("last-correct-value",e.val()),f.data("last-correct-value",f.val())}catch(g){e.val(e.data("last-correct-value")||""),f.val(f.data("last-correct-value")||
"")}}var c=a(a.product.options.form_selector).find(".js-datepicker-wrapper"),d=c.find(".js-datepicker");d.each(function(){a(this).datepicker({altField:a(this).siblings(".js-datepicker-hidden"),altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,onSelect:b}).on("blur",b).on("keydown keypress keyup",function(e){13===e.which&&e.preventDefault()})});c.on("click",".js-focus-on-field",function(){d.focus()})},parsePath:function(b){b=b.replace(/^.*#\//,"").replace(/(^\/|\/$)/,"");var c=b.split("/"),d=c.pop(),
e={};d.match(/^[\w_\-]+=/)?e=a.shop.helper.parseParams(d):c.push(d);return{id:c[0]||"new",mode:c[1]||"profile",tab:c[1]?c[2]||"main":!1,tail:c.slice(3).join("/")||"",raw:b,params:e}},dispatch:function(b){"string"==typeof b&&(b=this.parsePath(b));var c=[];a.shop.trace("$.product.dispatch",[this.path,b,b.raw]);if(b.tab)switch(b.tab){case "main":a(document).trigger("wa_product_section_change","product-general");break;case "descriptions":a(document).trigger("wa_product_section_change","product-seo");
break;case "images":a(document).trigger("wa_product_section_change","product-media");break;case "features":a(document).trigger("wa_product_section_change","product-sku");break;case "services":a(document).trigger("wa_product_section_change","product-services");break;case "related":a(document).trigger("wa_product_section_change","product-related");break;case "pages":a(document).trigger("wa_product_section_change","product-pages");break;default:a(document).trigger("wa_product_section_change","product")}else a(document).trigger("wa_product_section_change",
"product");if(!this.path.id){var d=this.get("container");d.length&&(this.path.id=d.data("product-id"),c.push("load"))}if(this.path.id!=b.id)this.path.id&&c.push("blur"),c.push("load");else{d="undefined";this.path.mode!=b.mode?(a.shop.trace("$.product.dispatch mode",this.path.mode+"->"+b.mode),this.path.mode&&this.path.tab?(a.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+b.tab),d=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(this.path.mode+"Tab"+d+"Blur"),c.push(this.path.mode+
"TabBlur"),c.push(this.path.mode+"Blur")):c.push("focus"),c.push(b.mode+"Init"),c.push(b.mode+"Focus")):this.path.tab&&b.tab!=this.path.tab&&(a.shop.trace("$.product.dispatch tabBlur",this.path.tab+"->"+b.tab),d=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1),c.push(b.mode+"Tab"+d+"Blur"),c.push(b.mode+"TabBlur"));c.push(b.mode+"Action");var e=this.tabIsLoaded(b);b.tab&&(d=b.tab.substr(0,1).toUpperCase()+b.tab.substr(1));if(b.tab&&b.tab!=this.path.tab)if(a.shop.trace("$.product.dispatch tabFocus",
this.path.tab+"->"+b.tab),e)c.push(b.mode+"TabShow"),c.push(b.mode+"TabInit"),c.push(b.mode+"Tab"+d+"Init"),c.push(b.mode+"TabFocus"),c.push(b.mode+"Tab"+d+"Focus");else{c.push(b.mode+"TabFocus");var f=b.mode+"Tab"+d+"Load";this.isCallable(f)?c.push(f):c.push(b.mode+"TabLoad")}b.tab&&e&&c.push(b.mode+"Tab"+d+"Action")}for(d=0;d<c.length;d++)if(!1===this.call(c[d],[b]))return!1},termination:function(){var b=[];if(this.path.mode&&this.path.tab){var c=this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1);
b.push(this.path.mode+"Tab"+c+"Blur");b.push(this.path.mode+"TabBlur");b.push(this.path.mode+"Blur")}b.push("blur");for(c=0;c<b.length;c++)this.call(b[c],[])},isCallable:function(b){return"function"==typeof this[b]},tabIsLoaded:function(b){return a("#s-product-edit-forms").find(".s-product-form."+b.tab).length?!0:!1},call:function(b,c,d){d=null;var e=this.isCallable(b);c=c||[];a.shop.trace("$.product.call",[b,c,e]);if(e)try{d=this[b].apply(this,c)}catch(f){a.shop.error("Error at method $.product."+
b+". Original message: "+f.message,f)}return d},load:function(b){var c=this.get("container");if(!c.length||c.data("product-id")!=b.id){var d=this;c="?module=product&id="+b.id;b.hasOwnProperty("tail")&&"force-old"===b.tail&&(c+="&force-old=1");a.shop.trace("$.product.load product",c);a.products.load(c,function(){d.dispatch(b)})}this.editTabMainData.sku_id="new"==b.id?-1:0;this.editTabMainData.stocks={}},focus:function(){a("*").off(".product");this.helper.init()},blur:function(){this.path.id=null;this.path.mode=
null;this.path.tab=null;this.path.tail=null;a("*").off(".product");a("#mainmenu").find(".s-level2").show();a("#s-product-edit-menu, #s-product-edit-save-panel").hide();a("#s-sidebar").show().animate({width:a.product.options.sidebar_width},"fast").queue(function(){a(this).dequeue()});a("#s-toolbar").show().animate({width:"200px"});a("#maincontent").animate({"margin-top":"84px"},"fast");a("#s-content").animate({"margin-left":a.product.options.sidebar_width},"fast")},saveData:function(b,c,d){var e=this,
f=e.get("form"),g="radio",h=f.find('input[name="product[sku_type]"]:first');if(h.is(":radio")){var k=f.find('input[name="product[sku_type]"]:checked').val();h=f.find('input[name="product[sku_type]"]')}else g="hidden",k=f.find('input[name="product[sku_type]"]:not(:disabled)').val();if("1"==k&&!a("#s-product-feature-superposition").find("input:checked:first").length&&"radio"==g)return h.filter("[value=0]").attr("checked",!0),a.product.onSkuTypeChange(0),!1;if(e.ajax.save)return setTimeout(function(){e.saveData(b,
c,d)},100),!1;if(this.path.tab&&(k="editTab"+this.path.tab.substr(0,1).toUpperCase()+this.path.tab.substr(1)+"Save",!1===this.call(k)))return!1;e.ajax.save=!0;a("#s-product-description-content").length&&a("#s-product-description-content").waEditor("sync");f.find(".s-price").find("input").each(function(){this.value=this.value.replace(/\s+/g,"")});a.shop.trace("$.product.saveData(mode="+b+", tab="+c+")");k=a("#product-tags_tag");k.length&&(g=jQuery.Event("keypress",{which:13}),k.trigger(g));a(f).find(':input[name^="product\\["]:not(:disabled)').each(function(){var l=
a(this).attr("type");if("text"!=l&&"textarea"!=l)return!0;this.defaultValue==this.value?a(this).attr("disabled",!0).addClass("js-ajax-disabled"):a(this).hasClass("js-ajax-disabled")&&a(this).removeAttr("disabled").removeClass("js-ajax-disabled")});this.refresh("submit");this.clearValidateErrors();a.ajax({url:a(f).attr("action"),data:a(f).serializeArray(),dataType:"json",type:"post",success:function(l){if("fail"==l.status)e.showValidateErrors(l.errors)||e.refresh("error",l.errors);else if(l.data.redirect)a.shop.trace("$.product.saveData redirect",
l.data.redirect),window.location.href=l.data.redirect;else{e.refresh("success",l.data.message||"");a.shop.trace("$.product.saveData updateData",[b,c]);e.updateData(l.data,b,c);d&&"function"==typeof d&&d();if(e.path.tab&&(l="editTab"+e.path.tab.substr(0,1).toUpperCase()+e.path.tab.substr(1)+"Saved",!1===e.call(l)))return!1;a.each(e.standalone_tabs,function(m,p){e.path.tab!=p&&(m="editTab"+p.substr(0,1).toUpperCase()+p.substr(1)+"Saved",e.call(m))})}e.ajax.save=!1},error:function(l,m,p){e.ajax.save=
!1;e.refresh("error",m)}});return!1},showValidateErrors:function(b){b=b||{};if(a.isEmptyObject(b))return!1;var c=this,d=!1,e=c.$edit_forms;if(b.features&&b.features.gtin){var f=e.find(".s-product-form.features").find('input[name="product[features][gtin]"]');if(f.length){f.addClass("error js-validate-error-input");var g=a('<div class="errormsg js-validate-error-msg"></div>').text(b.features.gtin);f.after(g);d=!0;c.refresh("error",$_("Cannot save the value of the \u201cGTIN\u201d feature for this product."))}}if(b.skus){var h=
e.find(".s-product-form.main table.s-product-skus tbody");a.each(b.skus,function(k,l){"status"===k?(d=!0,c.refresh("error",$_(l))):l.features&&l.features.gtin&&(k=h.find('.js-sku-settings[data-id="'+k+'"]').find('input[name="skus['+(k+'][features][gtin]"]')),k.length&&(k.addClass("error js-validate-error-input"),l=a('<div class="errormsg js-validate-error-msg"></div>').text(l.features.gtin),k.after(l),d=!0,c.refresh("error",$_("Cannot save the value of the \u201cGTIN\u201d feature for an SKU of this product."))))})}return d},
clearValidateErrors:function(){var b=this.$edit_forms,c=b.find(".s-product-form.main table.s-product-skus tbody");b=b.find(".s-product-form.features");c.find(".js-validate-error-input").removeClass("error");c.find(".js-validate-error-msg").remove();b.find(".js-validate-error-input").removeClass("error");b.find(".js-validate-error-msg").remove()},updateData:function(b,c,d){a.shop.trace("$.product.updateData("+c+","+d+")",b);var e=a("#s-product-edit-forms .s-product-form.main"),f=this.path.id;if(this.path.id&&
"new"!=this.path.id)this.path.id!=b.id&&a.shop.error("Abnormal product ID change",[this.path.id,b]);else{this.path.id=b.id;a(this.options.container_selector).data("product-id",this.path.id);var g="/product/"+this.path.id+"/";null!==c&&(c=c||this.path.mode||"profile")&&("profile"!=c&&(g+=c+"/"),null!==d&&(d=d||this.path.tab||"")&&"main"!=d.toLowerCase()&&(g+=d+"/"));a.shop.trace("update location.hash="+g);var h=/#\/product\/new\//,k="#/product/"+this.path.id+"/";a("#shop-productprofile, #s-product-edit-menu, #s-product-edit-forms, #s-product-profile-page").find('[href*="#/product/new/"]').each(function(){a(this).attr("href",
a(this).attr("href").replace(h,k))});a("#s-product-edit-forms").find(':input[name="product\\[id\\]"]').val(this.path.id);window.location.hash=g}c=a("#shop-productprofile h1");c.find(".s-product-name:first").text(b.name);c.find(".s-product-id").show().text("id: "+b.id);document.title=b.name+a.product.options.title_suffix;a("#product-stock-stat").html(tmpl("template-product-stock-stat",b.raw));e.find(':input[name="product\\[type_id\\]"]').parents(".value").data("type",b.type_id);if(a.isEmptyObject(b.frontend_urls))a(".s-product-frontend-url-not-empty").hide(),
a(".s-product-frontend-url-empty").show();else{c=a("#s-product-frontend-url");c.text(b.url);a("#s-product-frontend-url-input").val(b.url);c.trigger("readable");d=c.parent();d.attr("href",b.frontend_urls[0].url);d.find("span:first").text(b.frontend_urls[0].base);c.closest("div.value").find(".s-product-frontend-url").each(function(l){b.frontend_urls[l+1]&&a(this).attr("href",b.frontend_urls[l+1].url).text(b.frontend_urls[l+1].url)});a(".s-product-frontend-url-not-empty").show();a(".s-product-frontend-url-empty").hide();
c="";d=0;for(g=b.frontend_urls.length;d<g;d+=1)c+=' <span class="s-product-frontend-url-not-empty"><a href="'+b.frontend_urls[d].url+'" target="_blank">'+b.frontend_urls[d].url+'</a><i class="icon10 new-window"></i></span> ';c&&a("#s-product-frontend-links").find(".s-product-frontend-url-not-empty").wrapAll("<div></div>").closest("div").replaceWith(c)}this.editTabMainUpdate(b.raw||{},b.features_selectable_strings,f);e.find("select.s-product-categories").each(function(){var l=a(this),m=l.parent(),
p=l.val();if("select"==p||"---"==p){var n=a("#s-product-edit-forms .s-product-form.main select.s-product-categories");1<n.length?m.remove():m.find(".s-product-delete-from-category").hide()}else if("create"==p){var r=m.find("input.val").val();"0"==r?(n=a("#s-product-edit-forms .s-product-form.main select.s-product-categories"),1<n.length?m.remove():(l.val(r),l.show().attr("disabled",!1),m.find("input.val").attr("disabled",!0),m.find(".s-new-category").hide(),m.find(".s-product-delete-from-category").hide())):
(l.val(r),l.show().attr("disabled",!1),m.find("input.val").attr("disabled",!0),m.find(".s-new-category").hide(),m.find(".s-product-delete-from-category").show())}p=parseInt(p,10);if(!a.isEmptyObject(b.storefront_map[p])){l="";p=b.storefront_map[p];for(n=0;n<p.length;n+=1)l+='<a class="hint" href="'+p[n]+'" target="_blank">'+p[n]+"</a> ";m.find(".s-storefront-map").html(l)}});a("#s-product-categories").html(tmpl("template-product-categories",{categories:b.categories||[]}));a("#s-product-tags").html(tmpl("template-product-tags",
{tags:b.tags||[]}));a("#s-product-save table.s-product-skus > tbody > tr").each(function(){var l=a(this).data("id");a(this).find("td.s-stock .s-product-stock-icon").each(function(){var m=a(this).data("stock");b.raw&&b.raw.skus&&b.raw.skus[l]&&b.raw.skus[l].stock_icon[m]&&a(this).html(b.raw.skus[l].stock_icon[m])})});e.find("tr.js-sku-settings").each(function(){var l=a(this),m=l.attr("data-id");(m=b.raw.skus[m])&&void 0!==m.file_name&&!m.file_name&&(l.find(".s-sku-attachment").hide(),l.find(".fileupload").show())});
this.helper.checkChanges(this.get("form"),!0);a("#s-product-edit-menu li a i.icon10.status-yellow-tiny").remove();this.helper.updateSubmitButton(!1);"0"==b.raw.sku_type&&(e=a("#s-product-feature-superposition"),e.find("input[type=checkbox]").attr("checked",!1),f=e.find("ul.features li"),f.find(".count").text(""),f.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass("status-gray-tiny"),e=e.find(".superposition-count"),e.find(".options").text(""),e.find(".skus").text(""));a("#s-product-meta-title").attr("placeholder",
b.default_meta_title);a("#s-product-meta-keywords").attr("placeholder",b.default_meta_keywords);a("#s-product-meta-description").attr("placeholder",b.default_meta_description);a('#s-product-profile-tabs .s-tab-block[data-tab="stock-logs"]').trigger("refresh");this.setData("main","category_name",b.category_name)},refresh:function(b,c){a(this.options.form_selector).find(':input[name^="product\\["]:disabled.js-ajax-disabled').each(function(){a(this).removeAttr("disabled").removeClass("js-ajax-disabled")});
var d=a(this.options.message_selector);d.removeClass("errormsg successmsg status").empty().show();this.timer&&clearTimeout(this.timer);var e=null;d.append(this.message[b]||"");switch(b){case "submit":d.addClass("status");break;case "error":d.addClass("errormsg");for(b=0;b<c.length;b++)d.append(c[b][0]);e=2E4;break;case "success":c&&d.addClass("successmsg").append(c),e=3E3,this.helper.updateSubmitButton(!1)}e&&(this.timer=setTimeout(function(){d.removeClass("errormsg successmsg status").empty().show()},
e))},editTabLoad:function(b,c){var d=this,e=a("#s-product-edit-forms .s-product-form."+b.tab);!0===c||!e.length&&"new"==b.id?(a.shop.trace("product.editTabLoad: create",[b.tab+" \u2014 create",b,c]),this.saveData(this.path.mode,b.tab,function(){b.tab&&d.call(b)})):this.editTabLoadContent(b)},editTabLoadContent:function(b,c){var d=this;b=b||this.path;var e="?module=product&action="+b.tab+"&id="+b.id;b.tail&&(e+="&param[]="+b.tail.split("/").join("&param[]="));var f=Math.random();this.ajax.random=f;
var g=a("#s-product-edit-forms .s-product-form."+b.tab);g.length&&g.remove();a("#s-product-edit-forms > form").append(tmpl("template-productprofile-tab",{id:b.tab}));g=a("#s-product-edit-forms .s-product-form."+b.tab);this.ajax.target=g;this.ajax.link=a("#s-product-edit-menu li."+b.tab);a.shop.trace("$.product.editTabLoadContent",[b,e,b.params]);if(b.params&&c){var h=typeof b.params;switch(h){case "String":e+=b.params;break;case "Array":e+=b.params.serialize();break;default:a.shop.error("unexpected type "+
h,b.params)}}a.ajax({url:e,type:c?"POST":"GET",data:c?c||{}:b.params||{},success:function(k,l){a.shop.trace("$.product.loadTab status="+l);if(d.ajax.random==f){g.empty().append(k);d.ajax.target=null;d.ajax.link=null;k="#/product/"+b.id+"/edit/";b.tab&&(k+=b.tab+"/");b.tail&&(k+=b.tail+"/");if(b.params&&!a.isEmptyObject(b.params)){l=[];for(var m in b.params)b.params.hasOwnProperty(m)&&l.push(m+"="+b.params[m]);k+=l.join("&")}window.location.hash=k;d.dispatch(b)}}})},editTabInit:function(b){a("html, body").animate({scrollTop:0},
200);a("#shop-productprofile").find(".s-product-name").removeClass("editable");this.$edit_forms=a("#s-product-edit-forms")},editTabFocus:function(b){a("#s-product-edit-menu li."+b.tab).addClass("selected");this.refresh()},editTabBlur:function(b){if(b){a("#s-product-edit-forms .s-product-form").hide();a("#s-product-edit-menu li.selected").removeClass("selected");var c=b.tab;if(-1!==this.standalone_tabs.indexOf(c)){var d=this;this.helper.checkChanges(this.get("form"),!0,function(e){e&&(a.shop.trace("$.product.editTabBlur: save standalone tab ["+
c+"]",d.standalone_tabs),d.saveData(d.path.mode,c,function(){c&&d.call(d.path)}))})}this.path.tab=null;this.path.tail=null}},editTabShow:function(b){var c=a("#s-product-edit-forms .s-product-form."+b.tab);c.length?(c.show(),a.shop.trace("$.product.showTab",b),this.path.tab=b.tab):a.shop.error("$.product.showTab",b)},editClick:function(b){var c=b.attr("href").replace(/.*#\/product\/(\d+|new)\/edit\//,"").replace(/\/$/,"").split("/"),d=[];if(c.length){a.shop.trace("$.product.editClick",c);for(var e,
f="editTab";e=c.shift();)if(f+=e.substr(0,1).toUpperCase()+e.substr(1),e="function"==typeof this[f],a.shop.trace("$.settings.featuresClick try",[f,e,c]),!0===e){var g=f;d=c.slice(0)}}if(g){if(a.shop.trace("$.product.editClick",[g,d]),!b.hasClass("js-confirm")||confirm(b.attr("title")||"Are you sure?")){d.push(b);try{this[g].apply(this,d)}catch(h){a.shop.error("Error at method $.product."+g+". Original message: "+h.message,h)}}}else a.shop.error("Not found js handler for link",[g,b]);return!1},switchSubMenu:function(b){b=
b||"default";a("#mainmenu .s-submenu > *").hide();a("#mainmenu .s-submenu .s-submenu-"+b).show()},profileFocus:function(){var b=this.options.duration,c=this;a("#s-product-edit-menu, #s-product-edit-save-panel").hide();c.switchSubMenu();a("#s-sidebar").show().animate({width:a.product.options.sidebar_width});a("#s-toolbar").show().animate({width:"200px"},b).queue(function(){a(this).dequeue();a("#s-product-edit-forms").hide();a("#s-product-profile-page, h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").show();
c.get("container").find(".back").attr("href","#/"+a.products.list_hash)});a("#maincontent").animate({"margin-top":"84px"},b);a("#s-content").animate({"margin-left":a.product.options.sidebar_width},b);a("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return c.editClick(a(this))})},profileAction:function(){this.path.mode="profile"},disableSkus:function(b,c){var d=a(this.options.form_selector).find(".s-sku-list");b?c?d.find(".s-sku-virtual").hide().find(":input").attr("disabled",
!0):d.find(".s-sku-virtual").show().find(":input").attr("disabled",!1):(c?d.hide():d.show(),d.find(":input").attr("disabled",c))},skuTypeFeaturesSelectableLoad:function(b,c){var d=this,e="?module=product&action=featuresSelectable&id="+this.path.id,f={type_id:b,sku_type:1};a("#s-product-feature-superposition-field-group").load(e,f,function(){var g=d.featureSelectableInit();c&&(c.base_price_selectable&&g.find(':input[name="product[base_price_selectable]"]').val(c.base_price_selectable),c.currency&&
g.find("select.s-product-currency").val(c.currency));d.onSkuTypeEnabled(b)})},onSkuTypeEnabled:function(b){var c=a("#s-product-feature-superposition-field-group");b&&c.data("type",b);c.show(400,function(){a.product.checkFeatureValidation()});c.find("input").attr("disabled",!1);"new"==a.product.path.id?a.product.disableSkus(!1,!0):a.product.disableSkus(!0,!1);b=["compare_price","purchase_price"];for(var d,e,f=0;f<b.length;f++)d=c.find(':input[name="product['+b[f]+'_selectable]"]:first'),d.length&&
!parseInt(d.val())&&(e=a(':input[name^="skus"][name$="['+b[f]+']"]:first'),e.length&&d.val(e.val()))},checkFeatureValidation:function(){var b=a("#s-product-feature-superposition-field-group").find("ul.features li"),c=a("#product-save-message");b.find(".status-blue-tiny").length?c.removeClass("errormsg").empty():c.addClass("errormsg").empty().html($_("Select parameters to be available to customers for ordering this product in the storefront.")).show()},onSkuTypeChange:function(b){var c=a("#s-product-feature-superposition-field-group");
a.shop.trace("onSkuTypeChange",{sku_type:b});if("1"==b)if(b=a(this.options.form_selector+' :input[name="product[type_id]"]').val(),c.data("type")!=b)c={base_price_selectable:c.find(':input[name="product[base_price_selectable]"]').val(),currency:c.find("select.s-product-currency").val()},parseInt(c.base_price_selectable)||(c.base_price_selectable=a(':input[name^="skus"][name$="[price]"]:first').val()),a.product.skuTypeFeaturesSelectableLoad(b,c);else a.product.onSkuTypeEnabled();else c.hide(400,function(){a("#product-save-message").removeClass("errormsg").empty()}),
c.find("input").attr("disabled",!0),c=a(this.options.form_selector).find(".s-product-skus"),"new"==a.product.path.id?a.product.disableSkus(!1,!1):(b=c.find("tbody"),a.product.disableSkus(!0,!0),b.find(">tr:not(.s-sku-virtual)").length||(a.product.editTabMainSkuAdd(),b.find(">tr:not(.s-sku-virtual):first").find('input[name="product[sku_id]"]').attr("checked",!0))),c.closest(".field").find(".name").show()},featureSelectableInit:function(){var b=a(this.options.form_selector),c=a("#s-product-feature-superposition"),
d=b.find(".s-product-skus");b=b.find(':input[name="product[base_price_selectable]"]');var e=this;c.on("click","ul.features>li",function(){var f=a(this);f.parent().find("li.selected").removeClass("selected");f.addClass("selected");f=f.attr("data-feature-id");f=c.find(".feature-values[data-feature-id="+f+"]");c.find(".feature-values").hide();f.show();return!1});c.on("change","ul.values>li input",function(){var f=a(this).parents("li:first").parent().find(">li input:checked").length,g=c.find("ul.features li.selected");
g.find(".count").text(f||"");f=f?"status-blue-tiny":"status-gray-tiny";g.find("i").removeClass("status-blue-tiny status-gray-tiny").addClass(f);e.featureSelectableCount(c);a.product.checkFeatureValidation()});a.shop.changeListener(b,function(){d.find(".s-sku-virtual .s-price input").val(a(this).val())});a.shop.changeListener(d,function(){var f=a(this);if("product[sku_id]"!=f.attr("name")&&(f=f.parents("tr:first"),f.length)){var g=parseInt(f.attr("data-id"),10);if(g){if(f.hasClass("js-sku-settings")&&
(f=d.find("tr[data-id="+g+"]:first"),!f.length))return;f.find("input.s-input-virtual").val(0);f.removeClass("s-sku-virtual");a("#s-product-view").find("tr[data-id="+g+"]").removeClass("s-sku-virtual")}}},"input, textarea");c.find("i.status-blue-tiny:first").parents("li").trigger("click");return c},featureSelectableCount:function(b){b||(b=a("#s-product-feature-superposition"));var c=[],d=a("#s-product-edit-forms .s-product-form.features");b.find("ul.features>li").each(function(){var k=a(this),l=parseInt(k.find(".count").text(),
10);l&&c.push(l);if(d.length){var m=d.find('div[data-code="'+k.data("feature-code")+'"] div.value');if(l){k=k.data("feature-id");var p=b.find('div.feature-values[data-feature-id="'+k+'"] ul.values input:checked');m.each(function(){var n=a(this),r=p.filter('[value="'+n.data("value-id")+'"]').length;n.find("input:checkbox").attr("checked",r?"checked":null).attr("disabled","disabled");r?n.show():n.hide()})}else m.show(),m.find("input:checkbox").each(function(n,r){r.checked=r.defaultChecked;r.disabled=
null})}});var e=b.find(".superposition-count");if(c.length){e.find(".options").text($_("Parameters: %s").replace("%s",c.join(" x ")));for(var f=1,g=0,h=c.length;g<h;g+=1)f*=c[g];e.find(".skus").html('<span class="highlighted">'+$_("SKUs: %d").replace("%d",f)+"</span>")}else e.find(".options").text(""),e.find(".skus").html("")},editInit:function(){a("#s-product-edit-forms").unbind("keydown.product").bind("keydown.product",function(d){if(a(d.target).is(":input")&&(d.ctrlKey||d.metaKey)&&83==d.keyCode)return a("#s-product-save-button").click(),
!1});a.shop.makeFlexibleInput("s-product-meta-title");if(!this.options.edit_rights)return window.location.hash="#/product/"+this.path.id+"/",!1;var b=a(this.options.form_selector);b.bind("submit.product",function(d){return a.product.saveData("profile",null)});b.on("change.product, keyup.product","div.s-product-form:not(.ajax) :input",function(d){a.product.helper.onChange(a(this).parents("div.s-product-form"))});b.on("change.product, keyup.product, keypress.product",':input[name="product[name]"]',
function(d){a.product.helper.onNameChange(a(this),!1,a.product.options.update_delay||500)});a.shop.changeListener(b,':input[name="product[url]"]',function(){var d=a(this);a.getJSON("?module=product&action=checkUrlInUse",{id:a.product.path.id,url:d.val()||""},function(e){a.product.informAboutUrlInUse("ok"===e.status&&e.data.url_in_use)})});var c=a("#product-tags");c.data("tags_input_init")||(c.tagsInput({autocomplete_url:"?module=product&action=tagsAutocomplete",height:120,onChange:function(){a.product.updateMetaFields()},
defaultText:""}).data("tags_input_init",!0),a("#s-product-popular-tags").off("click.product","a").on("click.product","a",function(){var d=a(this).text();c.removeTag(d);c.addTag(d)}));b.on("change.product",".s-product-currency",function(){var d=a(this).val();b.find(".s-product-currency").val(d);b.find(".s-product-currency-readonly").text(d);a("#s-product-currency-code").val(d)});b.on("change.product",':input[name="product[type_id]"]',function(){return a.product.editTabMainTypeChange(a(this))});b.on("change",
'select[name="product[status]"]',function(){"1"==a(this).val()?(a(this).prev().removeClass("no-bw").addClass("yes"),a(".s-product-status-text").hide()):(a(this).prev().removeClass("yes").addClass("no-bw"),a(".s-product-status-text").show())});b.on("change",'input[name="product[sku_type]"]',function(){a.product.onSkuTypeChange(this.value)}).change();a.product.featureSelectableInit();a.product.editTabMainTypeChange(a(".js-shop-product-set-type"))},informAboutUrlInUse:function(b){b?a("#s-product-url-in-use-block").show().find(".s-text").html(b):
a("#s-product-url-in-use-block").hide()},editFocus:function(){var b=this.options.duration,c=this;a("h1 .s-product-edit-link, #mainmenu .s-level2, #s-product-frontend-links").hide();a("#s-sidebar, #s-toolbar").animate({width:0},b).queue(function(){a(this).hide();a(this).dequeue();a("#s-product-edit-menu, #s-product-edit-forms, #s-product-edit-save-panel").show();"new"!=c.path.id?c.get("container").find(".back").attr("href","#/product/"+c.path.id+"/"):c.get("container").find(".back").attr("href","#/"+
a.products.list_hash);a("#s-product-profile-page").hide();c.switchSubMenu("productprofile")});a("#maincontent").animate({"margin-top":"40px"},b);a("#s-content").animate({"margin-left":0},b);a("#shop-productprofile").off("click.edit-product","a.js-action").on("click.edit-product","a.js-action",function(){return c.editClick(a(this))})},editBlur:function(){this.path.tab=!1;this.path.mode=!1;a(a.product.options.form_selector).off("submit.product");a(this.options.form_selector).off("change.product, keyup.product");
a("#s-product-edit-forms").off("click.edit-product")},editAction:function(b){this.path.mode=b.mode},editTabMainData:{sku_id:-1,stocks:{}},editTabMainInit:function(b){a("#s-product-type").each(function(){a(this).parent().get(0)!=document.body&&(a("body > #s-product-type").remove(),a(document.body).append(a(this)))});var c=a("#s-product-edit-forms .s-product-form.main"),d=this,e=c.find("table.s-product-skus:last > tbody");e.sortable({distance:5,helper:"original",items:"> tr",handle:"i.sort",opacity:.75,
tolerance:"pointer",update:function(g,h){g=parseInt(a(h.item).data("id"),10);h=a(h.item).prev().data("id");h=void 0===h?0:parseInt(h,10);d.editTabMainSkuSort(g,h,a(this));h=e.find('> tr.js-sku-settings[data-id="'+g+'"]');h.length&&(h=h.detach(),a.shop.trace("detach",h),h&&(a.shop.trace("detach",e.find('> tr[data-id="'+g+'"]').length),e.find('> tr[data-id="'+g+'"]:first').after(h)))},start:function(g,h){e.find("> tr.js-sku-settings").hide()},stop:function(g,h){e.find("> tr.js-sku-settings").show()}});
var f=a("#s-product-frontend-url");f.inlineEditable({editLink:"#s-product-frontend-url-edit-link",editOnItself:!1,minSize:{height:15,width:100},makeReadableBy:[],beforeMakeEditable:function(g){var h=a(this).closest("span.s-product-frontend-url-not-empty"),k=h.find("span.slash"),l=h.find("i.new-window");a(g).after(k);l.hide();h.find("a.s-frontend-base-url").hide();h.find("span.s-frontend-base-url").show()},beforeBackReadable:function(g,h){g=a(this).closest("span.s-product-frontend-url-not-empty");
h=g.find("span.slash");g.find("i.new-window").show();g.find("span.s-frontend-base-url").hide();g.find("a.s-frontend-base-url").show().append(h)}});parseInt(b.id,10)||f.trigger("editable");"new"==b.id&&a.product_list&&a.isArray(a.product_list.collection_hash)&&("category"==a.product_list.collection_hash[0]?c.find("select.s-product-categories").val(a.product_list.collection_hash[1]):"set"==a.product_list.collection_hash[0]&&c.find(".add-set-button").click().closest(".field").find("select:first").val(a.product_list.collection_hash[1]));
c.off("change.product","select.s-product-categories").on("change.product","select.s-product-categories",function(g){g=a(this);var h=g.val(),k=g.parent(),l=k.find(".s-product-delete-from-category"),m=parseInt(h,10)||0;m?l.show():l.hide();"create"==h?(k.find(".s-new-category").show(),k.find("input.val").attr("disabled",!1),g.hide().attr("disabled",!0).addClass("js-ignore-change")):k.find("input.val").val(m)});c.off("keydown.product","input.new-category").on("keydown.product","input.new-category",function(g){if(13==
g.keyCode)return a(this).parent().find("input[type=button]").click(),!1});c.off("click.product",".s-new-category input[type=button]").on("click.product",".s-new-category input[type=button]",function(g){var h=a(this).parent(),k=h.parent(),l=h.find("input[name=new_category]");g=l.val();a.shop.jsonPost("?module=category&action=save&category_id=0&parent_id=0",{name:g},function(m){var p=k.find("select"),n=p.find("option.separator:first").show();a.when(n.after('<option class="category" value="'+m.data.id+
'">'+m.data.name+"</option>")).then(function(){p.find("option:first").text($_("Please select a category"));p.val(m.data.id).attr("disabled",!1).show().removeClass("js-ignore-change");h.find("input.val").val(m.data.id).attr("disabled",!0);h.hide();k.find(".s-product-delete-from-category").show();l.val("");a.product.helper.onTabChanged("main",{"saving new category":!0});a("#s-category-list>ul").trigger("add",[m.data,"category"])})})});c.off("click.product",".s-product-delete-from-category").on("click.product",
".s-product-delete-from-category",function(){var g=a(this),h=g.parent("div"),k=h.find("select");if(k.length)if(2<a("#s-product-edit-forms .s-product-form.main select.s-product-categories").length){k.attr("disabled",!0);var l=h.parents("div.field:first").find('input[name="product[categories.deleted]"]');if(0<parseInt(k.val())){var m=l.val().split(",");m.push(k.val());m.sort();l.val(m.join(","));a.product.helper.onChange(a.product.get("form").find("div.main:first"))}h.remove()}else k.val("selected").attr("disabled",
!1),h.find("input.val").val(0).attr("disabled",!0).parent().hide(),h.find(".s-storefront-map").html(""),h.find(".s-product-delete-from-category").hide();else l=h.parents("div.field:first").find('input[name="product[categories.deleted]"]'),k=g.parents(".value:first").find(":input:first"),0<parseInt(k.val())&&(m=l.val().split(","),m.push(k.val()),m.sort(),l.val(m.join(",")),a.product.helper.onChange(a.product.get("form").find("div.main:first"))),g.parents(".value:first").remove();return!1})},editTabMainAction:function(b){var c=
!1,d=null;b&&b.params&&b.params.focus?(d=b.params.name||"",!d.length&&b.params.sku&&(d="product[skus]["+parseInt(b.params.sku,10)+"]",b.params.focus&&(d+="["+b.params.focus+"]"),"stock"==b.params.focus&&(d+="["+(parseInt(b.params.stock,10)||0)+"]")),c=':input[name$="'+d.replace(/(\[|\]|\|\-)/g,"\\$1")+'"]:first'):b&&"new"==b.id&&(c=':input[name$="[name]"]:first');c&&(a.shop.trace("$.product.editTabMainFocus",[d,a(c).length]),setTimeout(function(){a(c).focus();window.location.hash="#/product/"+b.raw.replace(/\/focus=.*$/,
"/")},100))},editTabMainBlur:function(){},editTabMainSave:function(){if(!1===this.call("editTabMainSkuEproductSave"))return!1},helper:{options:{tab_changed:'<i class="icon10 status-yellow-tiny"></i>',defaultChangedStatus:!1},data:{url_helper:{url:"",name:"",timer:null}},init:function(){this.data.url_helper={url:"",name:"",timer:null}},onTabChanged:function(b,c){a.shop.trace("$.product.onTabChanged id="+b+" changed="+!!c,c);a("#s-product-edit-menu li."+b+" .s-product-edit-tab-status").html(c?this.options.tab_changed:
"");c&&this.updateSubmitButton(!0)},type:function(b){return parseInt(b,10)||parseInt(a('#s-product-edit-forms .s-product-form.main :input[name="product\\[type_id\\]"]').val(),10)||0},onNameChange:function(b,c,d){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);var e=a(a.product.options.form_selector).find(':input[name="product\\[url\\]"]'),f=e.parent();if(a.product.path.id&&"new"!=a.product.path.id||e.val()!=this.data.url_helper.url)a.shop.trace("$.product.onNameChange stop "+
this.data.url_helper.url+" != "+e.val()),a(a.product.options.form_selector).off(".product",':input[name="product\\[name\\]"]'),f.find(".js-url-helper").hide();else{c&&(f.find(".js-url-helper").length?f.find(".js-url-helper").show():f.append('<i class="icon16 loading js-url-helper"></i>'));var g=this;this.data.url_helper.timer=setTimeout(function(){g.urlHelper(b,e,d)},d||500)}},onChange:function(b){var c=this.getContainerId(b),d=this;this.checkChanges(b.parents("form"),!1,function(e){d.updateSubmitButton(e);
if(e)d.checkChanges(b,!1,function(f){d.onTabChanged(c,f)});else d.onTabChanged(c,e)})},urlHelper:function(b,c){this.data.url_helper.timer&&clearTimeout(this.data.url_helper.timer);b={name:a(b).val()};a.shop.trace("$.product.urlHelper ",b);if(b.url!=this.data.url_helper.name){var d=this;this.data.url_helper.url=b.url;a.getJSON("?module=product&action=suggestUrl",b,function(e){"ok"===e.status&&(d.data.url_helper.url=e.data.url,c.val(e.data.url),c.parent().find(".js-url-helper").hide(),a.product.informAboutUrlInUse(e.data.in_use))})}else c.parent().find(".js-url-helper").hide()},
getValueByName:function(b,c){for(var d=b,e=c.replace(/\]/,"").split("[");e.shift();)if(void 0!==d[c])d=d[c];else{d="";break}a.shop.trace("$.product.helper.getValueByName",[d,c,b]);return d},checkChangesStack:{},checkChanges:function(b,c,d){var e=b.attr("id");this.checkChangesStack[e]&&(clearTimeout(this.checkChangesStack[e]),this.checkChangesStack[e]=null);var f=this;this.checkChangesStack[e]=setTimeout(function(){var g=f.checkChangesDelayed(b,c);a.shop.trace("$.product.helper.checkChanges["+e+"]",
[b,c,g,d?"callback":"none"]);d&&d(g)},c?50:500)},checkChangesDelayed:function(b,c){var d=this.options.defaultChangedStatus,e=this,f=":input:not(.js-ignore-change)";if(b.hasClass("s-product-form")){if(b.hasClass("ajax"))return!1}else b.hasClass("s-product-form-chunk")||(f=".s-product-form:not(.ajax) "+f);b.find(f).each(function(){var g=a(this),h=(g.attr("type")||this.tagName).toLowerCase();switch(h){case "input":case "text":case "textarea":if(g.hasClass("ace_text-input"))break;this.defaultValue!=this.value&&
(d=!0,c&&(this.defaultValue=this.value,e.updateInput(this.name,this.value,"textarea"==h)));break;case "radio":case "checkbox":this.defaultChecked!=this.checked&&(d=!0,c&&(this.defaultChecked=this.checked));break;case "select":this.length&&a(this).find("option").each(function(){this.defaultSelected!=this.selected&&(d=!0,c&&(this.defaultSelected=this.selected))});break;case "file":this.value&&(d=!0,c&&(this.value=null));break;case "reset":case "button":case "submit":break;case "hidden":g.hasClass("js-check-change")&&
void 0!==g.attr("data-value")&&(defaultValue=g.attr("data-value"),this.disabled?c&&(h=a.shop.helper.escape(this.name),h=b.find(':input[name="'+h+'"]:enabled'),h.length&&g.attr("data-value",h.val())):defaultValue!=this.value&&(d=!0,c&&g.attr("data-value",this.value)));break;default:a.shop.error("$.product.checkChangesDelayed unsupported type "+h,[h,this])}!c&&d&&(a.shop.trace("$.product.helper.checkChangesDelayed",[this,d,this.defaultValue,this.value]),d=g);return c||!d});return d},getContainerId:function(b){b=
(a(b).attr("class")||"").split(" ");var c=!1,d;for(d in b)if("s-product-form"!=b[d]){c=b[d];break}return c},updateInput:function(b,c,d,e){if(b){var f=".s-"+b.replace(/\[(.+?)\]/g,"-$1")+"-input";a.shop.trace("update field: "+b+" "+f,c);var g=a(f);g.is("input,textarea")?g.val(c):d?"product[summary]"===b?g.text(c):g.html(c):g.text(c);e&&(b=a(f).attr("name"),b=b.replaceAll(/\[-[\d]+\]/,"["+e+"]"),a.shop.trace("$.product.helper.updateInput name",[b]))}},updateSubmitButton:function(b){a("#s-product-edit-save-panel :submit").removeClass(b?
"green":"yellow").addClass(b?"yellow":"green")},count:function(b){var c=0,d;for(d in b)b.hasOwnProperty(d)&&c++;return c}},multiSkus:function(b,c){c="boolean"===typeof c?c:!0;var d=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first");1<b?(d.find("thead tr th.s-sku-sort").show(),d.find(".s-name,.s-sku-sort").show("slow"),d.find(".delete").parent("a").show(),c&&(2===b?d.find("> tbody:first > tr:first .s-name :input").focus():d.find("> tbody:first > tr:last .s-name :input").focus())):
(d.find("thead tr th.s-sku-sort").hide(),d.find(".s-name,.s-sku-sort").hide(),d.find(".delete").parent("a").hide(),d.find(".s-sku-big").removeClass("s-sku-big"))},editTabMainSkuAdd:function(){try{var b=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),c=0,d="0";b.find(':input[name$="[price]"]').each(function(){var g=a(this),h=g.val()?g.val().replace(",","."):0;h=parseFloat(h);h>c&&(c=h,d=g.val()||"0")});var e=0;b.find(':input[name$="[purchase_price]"]').each(function(){e=
Math.max(e,parseFloat(a(this).val())||0)});a.product.multiSkus(b.find("tr:not(.js-sku-settings)").length+1);var f={id:--a.product.editTabMainData.sku_id,product_id:a('input:hidden[name="product[id]"]').val()||"new",sku:"",available:1,status:1,name:"",price:""+c,price_loc:d,purchase_price:""+e,stock_icon:{0:"<i class='icon10 status-green' ></i>"},stock:{},count:null};a.shop.trace("$.product.editTabMainSkuAdd",[a.product.editTabMainData.sku_id,f]);b.append(tmpl("template-sku-edit",{sku_id:a.product.editTabMainData.sku_id,
sku:f,stocks:this.getData("main","stocks"),stock_ids:this.getData("main","stock_ids")},!0));b.find(".s-product-currency").trigger("change");b.find("td.s-sku").addClass("s-sku-big")}catch(g){a.shop.error(g.message,g)}return!1},editTabMainSkuSort:function(b,c,d){try{a.post("?module=product&action=skuSort",{product_id:this.path.id,sku_id:b,after_id:c},function(e){a.shop.trace("$.product.editTabMainSkuSort result",e);e.error&&(a.shop.error("Error occurred while sorting product SKUs","error"),d.sortable("cancel"))},
function(e){a.shop.trace("$.product.editTabMainSkuSort cancel",{data:e});d.sortable("cancel");a.shop.error("Error occurred while sorting product SKUs","error")})}catch(e){a.shop.error(e.message,e)}return!1},editTabMainProductDelete:function(b){b=a("#s-product-list-delete-products-dialog");var c=b.parent();b.length||(c=a("<div></div>").appendTo("body"));c.load("?module=dialog&action=productsDelete",{product_id:[a.product.path.id]},function(){a("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(d){a(this).find(".dialog-buttons i.loading").show();a.shop.jsonPost("?module=products&action=deleteList",{product_id:[a.product.path.id],get_lists:1},function(e){a.product_list&&a("#s-sidebar").trigger("update",e.data.lists);d.trigger("close");window.location.hash="#/products/"});return!1}})});return!1},editTabMainSkuDelete:function(b,c){var d=a("#s-product-edit-forms .s-product-form.main table.s-product-skus:first").find("tbody:first"),
e=c.parents("tbody").find('> tr[data-id="'+b+'"]'),f=this;if(0<b){var g=c.parents("tbody").find('tr[data-id]:not(.js-sku-settings):not([data-id^="-"])').length;c=c.parents("tbody").find("tr[data-id]:not(.js-sku-settings)").length;1<g?a.ajax({url:"?module=product&action=skuDelete",data:{sku_id:b,product_id:this.path.id},dataType:"json",type:"post",success:function(h){"fail"==h.status?f.refresh("error",h.errors):h.data.redirect?window.location.href=h.data.redirect:(f.refresh("success",h.data.message||
"Success"),e.hide("normal",function(){e.remove();a('#s-product-view table.s-product-skus > tbody > tr[data-id="'+b+'"]').remove();a.product.multiSkus(d.find("tr:not(.js-sku-settings)").length,!1)}),a("#s-product-edit-forms .s-product-form.main").find("input[name=product\\[sku_id\\]][value="+h.data.sku_id+"]").attr("checked",!0))},error:function(h,k,l){f.refresh("error",k)}}):1<c?(e.after('<input type="hidden" name="skus['+b+']" value="%deleted%">'),e.hide("normal",function(){e.remove();a('#s-product-view table.s-product-skus > tbody >tr[data-id="'+
b+'"]').remove();a.product.multiSkus(d.find("tr:not(.js-sku-settings)").length,!1)})):f.refresh("error",$_("A product must have at least one SKU."))}else e.hide("normal",function(){e.remove();a('#s-product-view table.s-product-skus > tbody >tr[data-id="'+b+'"]').remove();a.product.multiSkus(d.find("tr:not(.js-sku-settings)").length,!1)})},editTabMainCategoriesAdd:function(){var b=a("#s-product-edit-forms .s-product-form.main select.s-product-categories:last").parent("div"),c=b.clone(!1);c.find("select").val("select").attr("disabled",
!1).show();c.find("input.val").val(0).attr("disabled",!0).parent().hide();c.find(".s-product-delete-from-category").hide();c.find(".s-storefront-map").html("");c.show();b.after(c)},editTabMainSkuStock:function(b,c){c=a("#s-product-sku-"+b);c.hide().find(":input:enabled").attr("disabled",!0);b=a("#s-product-sku-stock-"+b);b.show().find(":input:disabled").removeAttr("disabled");b.find(":input:first").val(c.find(":input:first").val())},editTabMainSkuSettings:function(b,c){c.hide();var d=c.parents("tr");
c=d.data();var e=this;a.when(d.after(tmpl("template-sku-settings",{sku_id:b,sku:c}))).done(function(){var f="?module=product&action=skuSettings&product_id="+e.path.id;f+="&sku_id="+b;f+="&type_id="+e.helper.type();var g=a('#s-product-edit-forms .s-product-form.main tr.js-sku-settings[data-id="'+b+'"] > td:first');g.load(f,function(){d.find(':input[name$="[available]"], :input[name$="[status]"]').remove();a.product_images&&a.product_images.options&&a.product_images.options.enable_2x&&a.fn.retina&&
g.find(".s-product-image-crops img").retina();a.product.initFeatureDate();if(0<b){a.shop.trace("fileupload",[g.find(".fileupload").length,typeof g.find(".fileupload").fileupload]);try{var h=document.cookie.match(/(?:^|; )_csrf=([^;]*)/),k=h?decodeURIComponent(h[1]):"";g.find(".fileupload:first").fileupload({dropZone:null,url:"?module=product&action=skuEproductUpload",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,start:function(){g.find(".fileupload:first").hide()},progress:function(l,m){a.shop.trace("fileupload progress",
m);l=g.find(".js-progressbar-container");l.show();l.find(".progressbar-inner:first").css("width",Math.round(100*m.loaded/m.total,0)+"%")},done:function(l,m){a.shop.trace("fileupload done",[m.result,typeof m.result]);l=(m.result.files||[]).shift();g.find(".js-progressbar-container").hide();!l||l.error?(g.find(".error-message").text(l.error).show(),g.find(".fileupload:first").addClass("error").show()):(m=g.find(".s-sku-attachment"),m.find("input.s-input-file-name").val(l.name),m.find(".s-file-name").text(l.name),
m.find(".s-file-size").text(l.size),m.find(".s-file-description").val(""),m.find("input[type=checkbox]").attr("checked",!0),m.show(),d.find("input.s-input-virtual").val(0))},fail:function(l,m){a.shop.trace("fileupload fail",[m.textStatus,m.errorThrown]);g.find(".error-message").text("error").show().text(m.errorThrown||"error");g.find(".js-progressbar-container").hide();g.find(".fileupload:first").addClass("error").show()},formData:{product_id:a.product.path.id,sku_id:b,_csrf:k}})}catch(l){a.shop.error("Exception "+
l.message,l)}}})})},editTabMainSkuImageSelect:function(b,c,d){b=d.parents("li:first");var e=b.hasClass("selected"),f=d.parents("div.value:first");f.find("ul.s-product-image-crops li.selected").removeClass("selected");e?f.find('input[name$="[image_id]"]').val(0):(b.addClass("selected"),f.find('input[name$="[image_id]"]').val(c));a.shop.trace("$.product.editTabMainSkuImageSelect",[f,f.find(':input[name$="[image_id]"]')]);a.product.helper.onChange(d.parents("div.s-product-form"))},editTabMainSkuEproductSave:function(b){b=
a("#s-product-edit-forms .s-product-form.main tr.js-sku-settings"+(b&&0<b?'[data-id="'+b+'"]':"")+" > td:first .fileupload");a.shop.trace("$.product.editTabMainSkuEproductSave",b.length);b.length&&b.fileupload("start")},editTabMainSkuEproductDelete:function(b){},editTabMainLinkEdit:function(b){return!1},editTabMainTypeSelect:function(b){var c=b.parents("form").find(':input[name="product[type_id]"]').parents(".value");"main"==this.path.tab?b.hide():(c.find(".js-action").hide(),window.location.hash=
"/product/"+this.path.id+"/"+this.path.mode+"/");c.find(".js-type-name").hide();c.find(":input").show().focus();setTimeout(function(){c.find(":input").focus()},100)},editTabMainTypeChange:function(b){var c=b.parents(".value"),d=b.find(":selected:first"),e=d.val();b=parseInt(d.data("sku-type"));c.find(".js-type-icon").html(d.data("icon"));c.find(".js-type-name").text(d.text());e!=c.data("type")?a("#s-product-edit-forms .s-product-form.features").length&&"undefined"!=typeof this.editTabFeaturesReload?
this.editTabFeaturesReload(e):(c=a("#s-product-edit-menu > li.features > a"),e="/features/"+e+"/",c.attr("href",c.attr("href").replace(/\/features\/.*$/,e))):(c=a("#s-product-edit-menu > li.features > a"),e="/features/",c.attr("href",c.attr("href").replace(/\/features\/.*$/,e)));c=a(this.options.form_selector+' :input[name="product[sku_type]"]');a.shop.trace("sku_type",[b,c]);c.filter('[value="1"]').trigger("disabled",[b?null:!0]);e=c.parents("ul");b?(c.filter(":checked").change(),e.find('[data-sku-type="1"]').hide()):
(c.filter('[value="0"]').trigger("checked",!0).change(),e.find('[data-sku-type="1"]').show())},editTabMainUpdate:function(b,c,d){var e=a("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody"),f=a("#s-product-view table.s-product-skus tbody");e.find('tr[data-id^="-"]').remove();f.find('tr[data-id^="-"]').remove();e.parents("table").find("tr:hidden").show();var g=[];for(h in b.skus||{})g.push(a.extend({id:h},b.skus[h]));g=g.sort(function(u,x){return u.sort-x.sort});var h=this.getData("main",
"stocks");var k=this.getData("main","stock_ids"),l="";tmpl.cache["template-sku-edit"]=tmpl(tmpl.load("template-sku-edit"));for(var m=0,p=g.length;m<p;m+=1)l+=tmpl("template-sku-edit",{sku_id:g[m].id,sku:g[m],hide_sort_column:1>=p,stocks:h,stock_ids:k,checked:g[m].id==b.sku_id});e.html(l);e.find("select.s-product-currency").val(b.currency);e.parent().show();e.closest(".s-sku-list").show();this.multiSkus(e.find("tr:not(.js-sku-settings)").length);l="";m=0;for(p=g.length;m<p;m+=1)l+=tmpl("template-sku",
{sku_id:g[m].id,sku:g[m],stocks:h,stock_ids:k,runout:b.runout||{}});f.html(l);d&&"new"!=d||e.parents("div.field-group:first").after(a("#s-sku-type-field-group"));c&&(d=a("#s-product-feature-superposition .superposition-count"),d.find(".options").text(c.options),d.find(".skus").html('<span class="highlighted">'+c.skus+"</span>"));var n=/#\/product\/new\//,r="#/product/"+b.id+"/";a("#s-product-edit-forms .s-product-form.main table.s-product-skus tbody, #s-product-view table.s-product-skus tbody").find('[href*="#/product/new/"]').each(function(){a(this).attr("href",
a(this).attr("href").replace(n,r))})},editTabDescriptionsBlur:function(){var b=a("#s-product-description-content");b.length&&b.data("redactor")&&b.waEditor("sync")},editTabDescriptionsAction:function(){var b=a("#s-product-description-content");if(b.length&&!b.data("redactor")){var c=b.parents("div.s-product-form");b.waEditor({lang:wa_lang,modification_wysiwyg_msg:b.data("modification-wysiwyg-msg"),toolbarFixedTopOffset:a("#mainmenu").length?a("#mainmenu").height():0,imageUploadFields:b.data("uploadFields"),
saveButton:a("#s-product-save-button"),callbacks:{change:function(){b.length&&(b.waEditor("sync"),a.product.helper.onChange(c))},keydown:function(d){if("115"!=d.which&&"83"!=d.which||!d.ctrlKey&&!d.metaKey)a.product.helper.onChange(c);else return d.preventDefault(),a("#s-product-save-button").click(),!1}}})}},profileInit:function(){void 0!==a.product_list&&void 0!==a.product_list.fixed_blocks&&(a.product_list.fixed_blocks.set&&a.product_list.fixed_blocks.set.unsetFixed(),a.product_list.fixed_blocks.category&&
a.product_list.fixed_blocks.category.unsetFixed());if(this.options.edit_rights){var b=a("#shop-productprofile").find(".s-product-name");parseInt(this.path.id,10)?b.addClass("editable"):b.removeClass("editable");var c=this.get("form");b.inlineEditable({minSize:{width:150},maxSize:{width:550},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){a("#s-edit-product").hide()},afterBackReadable:function(d,e){a("#s-edit-product").show();if(!e.changed)return!1;a.shop.jsonPost("?module=product&action=save&id="+
a.product.path.id,{update:{name:a(d).val()}},function(f){var g=a(d).val();document.title=g+a.product.options.title_suffix;"ok"===f.status&&f.data&&a("#s-product-meta-title").attr("placeholder",f.data.default_meta_title);c.find('input[name="product[name]"]').val(g)})},hold:function(){return!a(this).hasClass("editable")}})}this.call("profileLazyInit",[])},profileLazyInit:function(){var b=a("#product-sales-plot");if(window.sales_data&&sales_data.length){if(!b.data("graph_rendered")){var c=function(){b.length&&
0<b.width()?(showSalesGraph(sales_data,"undefined"==typeof cash_type?null:cash_type),b.data("graph_rendered",1)):setTimeout(c,1E3)};c()}}else b.remove();if(sku_plot_data&&sku_plot_data.length&&sku_plot_data[0]&&sku_plot_data[0].length){if(!a("#product-sku-plot").data("graph_rendered")){var d=[];a.each(sku_plot_data[0],function(e,f){d.push({label:f[0],value:f[1]})});showPieGraph(d,{color_type:"products"});a("#product-sku-plot").data("graph_rendered",1)}}else a("#product-sku-plot").remove()},updateMetaFields:function(){var b=
a(".s-product-name-input").val();a("#s-product-meta-title").attr("placeholder",b);var c=[b],d=5;a(".s-sku-name-input").each(function(){if(0>=d)return!1;var g=a.trim(a(this).val());g&&c.push(g);--d});b=this.getData("main","category_name");null!==b&&c.push(b);b=a("#product-tags").val().split(",");d=5;for(var e=0;e<b.length&&!(0>=d);e+=1){var f=a.trim(b[e]);f&&c.push(f);--d}a("#s-product-meta-keywords").attr("placeholder",c.join(", "));a("#s-product-meta-description").attr("placeholder",a("#s-product-summary").val())},
getId:function(){return this.path.id}}})(jQuery);(function(a){a.fn.rateWidget=function(b,c,d){function e(l){var m=0;this.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){if(m==l)return!1;m++;a(this).removeClass("star-empty").addClass("star")});this.attr("data-rate",l)}function f(l){return function(){return l}}var g=!!("ontouchstart"in window||navigator.msMaxTouchPoints),h=this;if(this&&this.length){if("string"==typeof b){if("getOption"==b&&"rate"==c)return parseInt(this.attr("data-rate"),10);if("setOption"==b&&("rate"==
c&&(e.call(this,parseInt(d,10)),c={rate:d}),"object"===typeof c&&c)){var k=this.data("rateWidgetSettings")||{};a.extend(k,c);"undefined"!==typeof c.hold&&"function"!==typeof c.hold&&(k.hold=f(k.hold))}return this}this.data("rateWidgetSettings",a.extend({onUpdate:function(){},rate:null,hold:!1,withClearAction:!0},b||{}));if(!this.data("inited"))return k=this.data("rateWidgetSettings"),"function"!==typeof k.hold&&(k.hold=f(k.hold)),function(){h.attr("id")||h.attr("id",(""+Math.random()).substr(2));
null!==k.rate&&h.attr("data-rate",k.rate);h.find("i:lt("+h.attr("data-rate")+")").removeClass("star-empty").addClass("star");g||h.mouseover(function(n){k.hold.call(h)||(n=n.target,"I"==n.tagName&&(n=a(n),n.prevAll().removeClass("star star-empty").addClass("star-hover").end().removeClass("star star-empty").addClass("star-hover"),n.nextAll().removeClass("star star-hover").addClass("star-empty")))}).mouseleave(function(){k.hold.call(h)||e.call(h,h.attr("data-rate"))});h.click(function(n){if(!k.hold.call(h)){for(var r=
n.target;"I"!=r.tagName;)if(r==this)return;var u=h.attr("data-rate"),x=0;h.find("i").removeClass("star star-hover").addClass("star-empty").each(function(){x++;a(this).removeClass("star-empty").addClass("star");if(this==r)return u!=x&&(h.attr("data-rate",x),k.onUpdate(x)),!1});return!1}});if(k.withClearAction){var l="clear-"+a(this).attr("id"),m=a("#"+l);m.length||(h.after('<a href="javascript:void(0);" class="inline-link rate-clear" id="'+l+'" style="display:none;"><b><i>'+$_("clear")+"</b></i></a>"),
m=a("#"+l));m.click(function(){if(!k.hold.call(h)){var n=h.attr("data-rate");e.call(h,0);if(0!==n)k.onUpdate(0)}});var p;h.parent().mousemove(function(){k.hold.call(h)||(p&&clearTimeout(p),m.show(0))}).mouseleave(function(){p=setTimeout(function(){k.hold.call(h)||m.hide(0)},150)})}this.unbind("clear").bind("clear",function(){e.call(h,0)});this.data("inited",!0);h[0].addEventListener("touchend",function(n){a(n.target).trigger("click")},!1)}.call(this),this}}})(jQuery);(function(a){a.product_reviews={container:null,sidebar_counter:null,statuses:{},form:null,hotkeys:{"alt+enter":{ctrl:!1,alt:!0,shift:!1,key:13},"ctrl+enter":{ctrl:!0,alt:!1,shift:!1,key:13},"ctrl+s":{ctrl:!0,alt:!1,shift:!1,key:17}},options:{},init:function(b){this.options=b;this.statuses=b.statuses;b.product_id&&(this.product_id=b.product_id);this.form=a("#s-review-add-form");this.sidebar_counter=a("#s-all-reviews").find(".count");b.container&&(this.container="object"===typeof b.container?b.container:
a(b.container),this.container.find(".s-reviews").off("click",".s-review-reply, .s-review-delete, .s-review-restore, .js-review-publish").on("click",".s-review-reply, .s-review-delete, .s-review-restore, .js-review-publish",function(){var d=a(this),e=d.parents("li:first");e=parseInt(e.attr("data-id"),10)||0;if(d.hasClass("s-review-reply")){if("ignore"===a.product_reviews.options.reply)return;a.product_reviews.prepareAddingForm.call(d,a.product_reviews.form,e)}else d.hasClass("s-review-delete")?a.product_reviews.deleteReview(e,
b.afterDelete):d.hasClass("s-review-restore")?a.product_reviews.restoreReview(e,b.afterRestore):d.hasClass("js-review-publish")&&a.product_reviews.publishReview(e);return!1}));this.product_id&&this.container.addClass("ajax");var c=function(){a.product_reviews.addReview("backend",b.afterAdd)};this.addHotkeyHandler("textarea","ctrl+enter",c);this.form.find("input.save").unbind("click").bind("click",c);this.initView();this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading);a.product&&
(a.product.editTabReviewsAction=function(d){d.tail&&setTimeout(function(){a.product_reviews.activeReplyToForm(d.tail)},200)})},activeReplyToForm:function(b){var c=this.container.find(".s-reviews li[data-id="+b+"]");if(c.length){var d=c.find(".s-review-reply:first");this.prepareAddingForm.call(d,this.form,b);a(document).scrollTop(c.offset().top)}},initView:function(){if("reviews"==a.products.hash.substr(0,7)){var b=a("#s-sidebar");b.find("li.selected").removeClass("selected");b.find("#s-all-reviews").addClass("selected")}},
initReview:function(b){var c=a(document),d=b.$wrapper,e=d.data("id"),f=b.locales,g=b.urls,h=!1;d.on("click",".js-show-image",function(k){k.preventDefault();k=a(this);var l=[];d.find(".js-show-image").each(function(){var m=a(this),p=l,n=p.push,r=m.attr("href");m=m.attr("title");m=a("<div />").text(m).html();n.call(p,{href:r,title:m})});(k=k.closest(".s-image-wrapper").prevAll(".s-image-wrapper").length)&&(l=l.slice(k).concat(l.slice(0,k)));a.swipebox(l,{useSVG:!1,hideBarsDelay:!1,afterOpen:function(){function m(){var p=
a("#swipebox-close");p.length&&p.trigger("click");c.off("scroll",m)}c.on("scroll",m)}})});d.on("click",".js-delete-image",function(k){k.preventDefault();var l=a(this).closest(".s-image-wrapper");k=l.data("image-id");!h&&confirm(f.confirm)&&(h=!0,a.post(g["delete"],{review_id:e,image_id:k},"json").always(function(){h=!1}).done(function(){l.remove()}))})},initLazyLoad:function(b){var c=b.count,d=b.total_count,e=b.url||"?module=reviews",f=a(b.target||".s-reviews:first ul:first");a(window).lazyLoad("stop");
c<d&&(a(window).lazyLoad({container:f,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();a(".lazyloading-progress").show();a.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(g){g=a("<div></div>").html(g);var h=g.find(".s-reviews").children();c+=h.length;f.append(h);a(".lazyloading-progress-string").replaceWith(g.find(".lazyloading-progress-string"));a(".lazyloading-progress").replaceWith(g.find(".lazyloading-progress"));
c>=d?(a(window).lazyLoad("stop"),a(".lazyloading-link").hide()):(a(".lazyloading-link").show(),a(window).lazyLoad("wake"));g.remove()},"html")}}),a(".lazyloading-link").unbind("click").bind("click",function(){a(window).lazyLoad("force");return!1}))},prepareAddingForm:function(b,c){if(c)this.after(b),b.find(".rate a:first").hide();else{var d=a("#s-review-add li:first");d.find("form").length||d.append(b);b.find(".rate a:first").show()}a.product_reviews.clear(!1);a("input[name=parent_id]",b).val(c)},
addHotkeyHandler:function(b,c,d){var e=this.hotkeys[c];this.form.off("keydown",b).on("keydown",b,function(f){if(f.keyCode==e.key&&f.altKey==e.alt&&f.ctrlKey==e.ctrl&&f.shiftKey==e.shift)return d()})},addReview:function(b,c){var d=this.sidebar_counter;a.post("backend"!=b&&b?"#":"?module=reviews&action=add",a.product_reviews.form.serialize(),function(e){if("fail"==e.status)a.product_reviews.clear(!1),a.product_reviews.showErrors(e.errors);else if("ok"==e.status&&e.data.html){var f=a("input[name=parent_id]",
a.product_reviews.form),g=a.product_reviews.form.parents(".s-review:first").parent("li"),h=e.data.html,k=a("ul:first",g),l=a.product_reviews.container;g.length||(l.show(),k=a("ul:first",l).show());k.length||(k=a('<ul class="menu"></ul>'),g.append(k));k.append(a('<li data-id="'+e.data.id+'" data-parent-id="'+e.data.parent_id+'"></li>').append(h));a("textarea",a.product_reviews.form).val("");g=a("#s-review-add");g.find("form").length||(g.append(a.product_reviews.form),f.val(0));d.length&&d.text(parseInt(d.text(),
10)+1);"function"===typeof c&&c(e);a.product_reviews.clear()}else console&&console.log("Error occured.")},"json").error(function(e){console&&console.log(e.responseText?"Error occured: "+e.responseText:"Error occured.")})},deleteReview:function(b,c){var d=this.container,e=this.sidebar_counter;a.post("?module=reviews&action=changeStatus",{review_id:b,status:this.statuses.deleted},function(f){if("ok"==f.status){var g=d.find("li[data-id="+b+"]").find("div:first");g.removeClass("is-published").removeClass("is-unpublished").addClass("is-deleted");
g.find(".s-review-delete").hide();g.find(".s-review-restore").show();e.length&&e.text(parseInt(e.text(),10)-1);"function"===typeof c&&c(f)}},"json")},restoreReview:function(b){var c=this.container,d=this.sidebar_counter;a.post("?module=reviews&action=changeStatus",{review_id:b,status:this.statuses.published},function(e){"ok"==e.status&&(e=c.find("li[data-id="+b+"]").find("div:first"),e.addClass("is-published").removeClass("is-unpublished").removeClass("is-deleted"),e.find(".s-review-delete").show(),
e.find(".s-review-restore").hide(),d.length&&d.text(parseInt(d.text(),10)+1),"function"===typeof success&&success())},"json")},publishReview:function(b){var c=this.container,d=this.sidebar_counter;a.post("?module=reviews&action=changeStatus",{review_id:b,status:this.statuses.published},function(e){"ok"==e.status&&(e=c.find("li[data-id="+b+"]").find("div:first"),e.addClass("is-published").removeClass("is-unpublished").removeClass("is-deleted"),e.find(".s-review-delete").show(),e.find(".js-review-publish").remove(),
d.length&&d.text(parseInt(d.text(),10)+1),"function"===typeof success&&success())},"json")},clear:function(b){b="undefined"===typeof b?!0:b;a(".errormsg",this.form).remove();a(".error",this.form).removeClass("error");a(".wa-captcha-refresh",this.form).click();b&&(a("input[name=captcha], textarea",this.form).val(""),a("input[name=rate]",this.form).val(0),a(".rate a:first",this.form).trigger("clear"))},showErrors:function(b){for(var c=0,d=b.length,e=b[c];c<d;e=b[++c])for(var f in e)a("[name="+f+"]",
this.form).after(a('<em class="errormsg"></em>').text(e[f])).addClass("error")}}})(jQuery);(function(a){a.product_images={product_id:0,image:null,product_image:null,image_list:null,photo_stream:null,tail:null,options:{},init:function(b){this.options=b;this.product_id=b.product_id||0;this.image=b.image||null;this.options.placeholder=this.options.placeholder||null;var c=a("#s-product-edit-menu .images");this.image?setTimeout(function(){a.product_images.initImage()},200):this.initImageList(b);c.find(".hint").text(b.count||b.images&&b.images.length||0);a("#s-product-edit-forms .s-product-form.images").addClass("ajax");
a.product.editTabImagesAction=function(e){if(null!==a.product_images.tail){var f="?module=product&action=images&id="+e.id;if(e.tail&&(f+="&param[]="+e.tail,a.product_images.photo_stream&&a.product_images.photo_stream.length)){var g=a.product_images.photo_stream.find(".s-stream-wrapper>ul");f+="&ps[left]="+parseInt(g.css("left"),10);f+="&ps[width]="+parseInt(g.css("width"),10)}a.get(f,function(h){a("#s-product-edit-forms .s-product-form.images").html(h)})}a.product_images.tail=e.tail};a.product.editTabImagesBlur=
function(e){a("#fileupload").fileupload("destroy")};var d=a("#s-product-set-custom-badge");a(".s-product-images-actions").off("click","li").on("click","li",function(){var e=a(this),f=e.attr("data-action");switch(f){case "set-badge":a.product_images.setBadge(e.attr("data-type"));break;case "set-custom-badge":d.data("type",e.attr("data-type"));d.show();break;case "delete-badge":a.product_images.deleteBadge()}"set-custom-badge"!=f&&d.hide();return!1});d.find("input[type=button]").unbind("click").bind("click",
function(){var e=a(this).parent();d.show();a.product_images.setBadge(d.data("type"),e.find("textarea[name=code]").val());return!1})},initImageList:function(b){this.image_list=a(b.image_list||"#s-product-image-list");this.image_list.html(tmpl("template-product-image-list",{images:b.images,placeholder:b.placeholder,type:b.type,product_id:this.product_id}));this.initListSortable();b.type&&"thumbs"!=b.type||this.initListEditable();b.enable_2x&&a.fn.retina&&this.image_list.find("img").retina()},initImage:function(){a("#s-product-one-image").parent().width();
this.photo_stream=a("#s-product-image-toolbar ul.s-photostream:first");var b=this.setImageDimensions();a(window).unbind("resize.product_images").bind("resize.product_images",function(h){a("#s-product-image").length?a.product_images.image?(h=a.product_images.setImageDimensions(),a.product_images.loupe.resize(h)):a(this).unbind("resize.product_images"):a(this).unbind("resize.product_images")});a("#s-product-image-description").inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],
placeholderClass:"gray",placeholder:a.product_images.options.placeholder,minSize:{height:50,widht:600},size:{width:b.width},editLink:"#s-product-image-description-edit-link",allowEmpty:!0,beforeMakeEditable:function(h){var k=a(this),l=this.id+"-button",m=a("#"+l);m.length||(h.after('<br><input type="button" id="'+l+'" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>'),a("#"+l).click(function(){k.trigger("readable")}));a("#"+this.id+"-hint").show();m.show().prev("br").hide()},
afterBackReadable:function(h,k){h=a(h).val();var l="#"+this.id+"-";a(l+"button").hide().prev("br").hide();a(l+"hint").hide();k.changed&&a.products.jsonPost("?module=product&action=imageSave",{id:a.product_images.image.id,data:{description:h}})}});var c=this.photo_stream,d=c.find("li.selected");c.photoStreamSlider({backwardLink:"#s-product-image-toolbar .rewind",forwardLink:"#s-product-image-toolbar .ff",photoStream:"ul",duration:400});c.off("click","li.visible a").on("click","li.visible a",function(){var h=
a(this).attr("href"),k=a(this).parent();d.removeClass("selected");d=k.addClass("selected");c.trigger("home",[function(){location.href=h}]);return!1});this.photo_stream=c;this.product_image=a("#s-product-image");var e=a("#s-product-set-custom-badge");a(".s-product-image-actions").off("click","li").on("click","li",function(){var h=a(this),k=h.attr("data-action");switch(k){case "delete":a.product_images.deleteImage();break;case "rotate-right":a.product_images.rotateImage("right");break;case "rotate-left":a.product_images.rotateImage("left");
break;case "set-badge":a.product_images.setBadge(h.attr("data-type"));break;case "set-custom-badge":e.data("type",h.attr("data-type"));e.show();break;case "delete-badge":a.product_images.deleteBadge()}"set-custom-badge"!=k&&e.hide();return!1});e.find("input[type=button]").unbind("click").bind("click",function(){var h=a(this).parent();e.show();a.product_images.setBadge(e.data("type"),h.find("textarea[name=code]").val());return!1});b=this.image;a("#s-product-image-loupe").length&&a.product_images.loupe.init({original:{width:b.width,
height:b.height,src:"?module=product&action=ImageDownload&id="+b.id},image:{width:this.product_image.width(),height:this.product_image.height(),src:b.url_big,dom:this.product_image},animate:!(!b.dimensions.width||!b.dimensions.height)});var f=this;a("#s-restore-image-original").unbind("click").bind("click",function(){confirm($_("This will reset all changes you applied to the image after upload, and will restore the image to its original. Are you sure?"))&&(f.coverToggle(),a.products.jsonPost("?module=product&action=imageRestore",
{id:f.image.id},function(h){a("#s-product-view").find("li[data-image-id="+f.image.id+"] img").attr("src",h.data.url_crop);a("<img>").attr("src",h.data.url_big).load(function(){a(this).remove();a.products.dispatch("#/product/"+f.product_id+"/edit/images/"+f.image.id+"/");f.coverToggle()})},"json"))});this.options.enable_2x&&a.fn.retina&&a("#s-product-image").retina();var g=!1;a(document).unbind("keydown.product_images").bind("keydown.product_images",function(h){var k=a(h.target).prop("nodeName").toLowerCase();
h=h.keyCode;if(!(g||"text"==k||"textarea"==k||37!=h&&39!=h)){if(39==h)return k=c.find("li.selected").next(),k.length&&!k.hasClass("dummy")&&(g=!0,location.href=k.find("a").attr("href")),!1;if(37==h)return k=c.find("li.selected").prev(),k.length&&!k.hasClass("dummy")&&(g=!0,location.href=k.find("a").attr("href")),!1}})},setImageDimensions:function(){var b=a("#s-product-image"),c=a("#s-product-one-image").parent().width(),d=this.image.dimensions;d.width=parseInt(d.width,10);d.height=parseInt(d.height,
10);var e={width:"",height:""};!isNaN(d.width)&&d.width<c?(e.width=d.width,isNaN(d.height)||(e.height=d.height)):e.width=c;b.css(e);return e},deleteImage:function(){var b=this,c=a("#s-product-image-delete-dialog");c.waDialog({onSubmit:function(){c.trigger("close");b.coverToggle();var d=c.find("form");a.shop.jsonPost(d.attr("action"),d.serialize(),function(e){var f="#/product/"+b.product_id+"/edit/images/",g=b.photo_stream.find("li.selected"),h=g.next("li:not(.dummy)");h.length?f=h.find("a").attr("href"):
(h=g.prev("li:not(.dummy)"),h.length&&(f=h.find("a").attr("href")));a(".s-product-image-crops").find("li[data-image-id="+e.data.id+"]").remove();b.coverToggle();location.href=f});return!1}})},rotateImage:function(b){var c=this;c.coverToggle();a.products.jsonPost("?module=product&action=imageRotate&id="+c.image.id,{direction:b},function(d){a("#s-product-view").find("li[data-image-id="+c.image.id+"] img").attr("src",d.data.url_crop);a("<img>").attr("src",d.data.url_big).load(function(){a(this).remove();
a.products.dispatch("#/product/"+c.product_id+"/edit/images/"+c.image.id+"/");c.coverToggle()})})},setBadge:function(b,c,d){c=c||b;var e=a("#photo-organize-menu"),f=e.find("li[data-type="+b+"]");f.find("a").append('<span class="count"><i class="icon16 loading"></i></span>');a.shop.jsonPost("?module=product&action=badgeSet&id="+this.product_id,{code:c},function(g){var h=a("#s-product-one-image");h.find(".top.right").html(g.data);e.find("li.selected").removeClass("selected").find(".small").text("");
f.addClass("selected");f.find("span.count").remove();h.length||(f.find("a").append('<span class="count"><i class="icon10 yes"></i></span>'),setTimeout(function(){f.find("span.count").remove()},1E3));"custom"!=b?(a("#s-product-set-custom-badge").hide(),f.find(".small").text(g.data)):a("#s-product-set-custom-badge").show();"function"===typeof d&&d(g)})},deleteBadge:function(){a.getJSON("?module=product&action=badgeDelete&id="+this.product_id,function(b){a("#s-product-one-image").find(".top.right").html("");
a("#photo-organize-menu").find("li.selected").removeClass("selected").find(".small").text("")})},initListSortable:function(){this.image_list.sortable({distance:5,helper:"clone",items:"li",opacity:.75,tolerance:"pointer",start:function(){document.ondragstart=function(){return!1}},update:function(b,c){document.ondragstart=null;var d=a(this);b=a(c.item);var e=parseInt(b.attr("data-image-id"),10);b=b.next();var f=null;b.length&&(f=parseInt(b.attr("data-image-id"),10));a.products.jsonPost("?module=product&action=imageMove",
{id:e,before_id:f},function(g){if("function"===typeof a.product_images.options.onSort)a.product_images.options.onSort(e,f)},function(){d.sortable("cancel")})}})},coverToggle:function(){var b=a("#s-product-image-cover");if(b.is(":hidden")){var c=b.find(".loading");c.css({position:"absolute",left:parseInt((b.width()-c.width())/2,10)+"px",top:parseInt((b.height()-c.height())/2,10)+"px"});b.show()}else b.hide()},initListEditable:function(){this.image_list.off("click",".editable").on("click",".editable",
function(){a(this).inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholderClass:"gray",placeholder:a.product_images.options.placeholder,minSize:{height:40},allowEmpty:!0,beforeMakeEditable:function(b){var c=a(this);b.css({"font-size":c.css("font-size"),"line-height":c.css("line-height")}).width(c.parents("li:first").find("img").width());var d=this.id+"-button",e=a("#"+d);e.length||(b.after('<br><input type="button" id="'+d+'" value="'+$_("Save")+'"> <em class="hint" id="'+
this.id+'-hint">Ctrl+Enter</em>'),a("#"+d).click(function(){c.trigger("readable")}));a("#"+this.id+"-hint").show();e.show()},afterBackReadable:function(b,c){var d=a(this);d=parseInt(d.parents("li:first").attr("data-image-id"),10);b=a(b).val();var e="#"+this.id+"-";a(e+"button").hide();a(e+"hint").hide();c.changed&&a.products.jsonPost("?module=product&action=imageSave",{id:d,data:{description:b}})}}).trigger("editable")})}}})(jQuery);(function(a){a.product_stocks={options:{},container:null,products_ids:[],stock_id:null,waLoading:a.waLoading(),init:function(b){this.options=b;this.stocks=b.stocks;this.stock_id=b.stock_id;this.container=a("#s-product-stocks");this.products_ids=[];this.initView();this.options.lazy_loading&&0<this.options.product_stocks.length&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(b){var c=b.count,d=b.total_count,e=b.sort;a(window).lazyLoad("stop");if(c<d){var f=this;a(window).lazyLoad({container:f.container.find("tbody"),
state:"undefined"===typeof b.auto||b.auto?"wake":"stop",hash:"stocks",load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();a(".lazyloading-progress").show();var g=function(k){console&&(k&&k.errors?console.error("Error when loading products: "+k.errors):k&&k.responseText?console.error("Error when loading products: "+k.responseText):console.error(k));a(window).lazyLoad("stop")},h=["module=stocksBalance","offset="+c,"total_count="+d];f.stock_id&&h.push("stock_id="+f.stock_id);f.options.order&&
h.push("order="+f.options.order);e&&h.push("sort="+e);a.get("?"+h.join("&"),function(k){k&&"ok"===k.status?(c+=k.data.count,f.append({product_stocks:k.data.product_stocks,stocks:f.stocks,is_single_stock:!!f.stock_id})?(a(".lazyloading-progress-string").text(k.data.progress.loaded+" "+k.data.progress.of),a(".lazyloading-progress").hide(),a(".lazyloading-chunk").text(k.data.progress.chunk),c>=d||1>k.data.count?(a(window).lazyLoad("stop"),a(".lazyloading-link").hide()):(a(".lazyloading-link").show(),
a(window).lazyLoad("wake"))):a(window).lazyLoad("stop")):g(k)},"json").error(g)}});a(".lazyloading-link").off("click").on("click",function(){a(window).lazyLoad("force");return!1})}},initView:function(){if(!this.append({product_stocks:this.options.product_stocks,stocks:this.stocks,is_single_stock:!!this.stock_id}))return this},append:function(b){var c=this;b=function(d){var e=[];a.each(d.product_stocks,function(f,g){0>c.products_ids.indexOf(g.id)&&(e.push(g),c.products_ids.push(g.id))});d.product_stocks=
e;return d}(b);try{this.container.find("tbody").append(tmpl("template-product-stocks",b))}catch(d){return console.error("Error: "+d.message),!1}return!0},showLoading:function(){this.waLoading.show();this.waLoading.animate(1E4,95,!1)},doneLoading:function(){this.waLoading.done()}}})(jQuery);(function(a){a.product_stocks_log={product_id:null,container:null,options:{},init:function(b){this.options=b;this.container=b.container?a(b.container):a("body");this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(b){var c=b.count,d=this.options.total_count,e=b.url;a(window).lazyLoad("stop");if(c<d){var f=this;a(window).lazyLoad({container:f.container,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",load:function(){if(f.container.is(":visible"))a(window).lazyLoad("sleep"),
a(".lazyloading-link").hide(),a(".lazyloading-progress").show(),a.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(h){h=a("<div></div>").html(h);var k=h.find("table tr");k.length?(c+=k.length,a("table",f.container).append(k),c>=d?(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide()):(a(window).lazyLoad("wake"),a(".lazyloading-link").show())):(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide());a(".lazyloading-progress-string",f.container).replaceWith(a(".lazyloading-progress-string",
h));a(".lazyloading-chunk",f.container).replaceWith(a(".lazyloading-chunk",h));h.remove()});else{a(window).lazyLoad("sleep");var g=setInterval(function(){f.container.is(":visible")&&(a(window).lazyLoad("wake"),clearInterval(g))},500)}}});a(".lazyloading-link").off("click").on("click",function(){a(window).lazyLoad("force");return!1})}}}})(jQuery);(function(a){a.stocks_log={container:null,options:{},init:function(b){this.options=b;this.container=b.container||a("#s-content");this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(b){var c=b.count,d=this.options.total_count,e=b.url;a(window).lazyLoad("stop");if(c<d){var f=this;a(window).lazyLoad({container:f.container,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();a(".lazyloading-progress").show();
a.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(g){g=a("<div></div>").html(g);var h=g.find("table tr");h.length?(c+=h.length,a("table",f.container).append(h),c>=d?(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide()):(a(window).lazyLoad("wake"),a(".lazyloading-link").show())):(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide());a(".lazyloading-progress-string",f.container).replaceWith(a(".lazyloading-progress-string",g));a(".lazyloading-chunk",f.container).replaceWith(a(".lazyloading-chunk",
g));g.remove()})}});a(".lazyloading-link").off("click").on("click",function(){a(window).lazyLoad("force");return!1})}}}})(jQuery);(function(a){a.product_orders={product_id:null,container:null,options:{},init:function(b){this.options=b;this.container=b.container?a(b.container):a("body");this.options.lazy_loading&&this.initLazyLoad(this.options.lazy_loading)},initLazyLoad:function(b){var c=b.count,d=this.options.total_count,e=b.url;a(window).lazyLoad("stop");if(c<d){var f=this;a(window).lazyLoad({container:f.container,state:"undefined"===typeof b.auto||b.auto?"wake":"stop",load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();
a(".lazyloading-progress").show();a.get(e+"&lazy=1&offset="+c+"&total_count="+d,function(g){g=a("<div></div>").html(g);var h=g.find("table tr");h.length?(c+=h.length,a("table",f.container).append(h),c>=d?(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide()):(a(window).lazyLoad("wake"),a(".lazyloading-link").show())):(a(window).lazyLoad("stop"),a(".lazyloading-progress").hide());a(".lazyloading-progress-string",f.container).replaceWith(a(".lazyloading-progress-string",g));a(".lazyloading-chunk",
f.container).replaceWith(a(".lazyloading-chunk",g));g.remove()})}});a(".lazyloading-link").off("click").on("click",function(){a(window).lazyLoad("force");return!1})}}}})(jQuery);(function(a){var b=[],c=[];a.fn.doAutosize=function(d){var e=a(this).data("minwidth"),f=a(this).data("maxwidth"),g="",h=a(this),k=a("#"+a(this).data("tester_id"));g!==(g=h.val())&&(g=g.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">"),k.html(g),k=k.width(),d=k+d.comfortZone>=e?k+d.comfortZone:e,k=h.width(),(d<k&&d>=e||d>e&&d<f)&&h.width(d))};a.fn.resetAutosize=function(d){var e=a(this).data("minwidth")||d.minInputWidth||a(this).width();d=a(this).data("maxwidth")||d.maxInputWidth||
a(this).closest(".tagsinput").width()-d.inputPadding;var f=a(this),g=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:f.css("fontSize"),fontFamily:f.css("fontFamily"),fontWeight:f.css("fontWeight"),letterSpacing:f.css("letterSpacing"),whiteSpace:"nowrap"}),h=a(this).attr("id")+"_autosize_tester";0< !a("#"+h).length&&(g.attr("id",h),g.appendTo("body"));f.data("minwidth",e);f.data("maxwidth",d);f.data("tester_id",h);f.css("width",e)};a.fn.addTag=function(d,e){e=jQuery.extend({focus:!1,
callback:!0},e);this.each(function(){var f=a(this).attr("id"),g=a(this).val().split(b[f]);""==g[0]&&(g=[]);d=jQuery.trim(d);if(e.unique){var h=a(g).tagExist(d);1==h&&a("#"+f+"_tag").addClass("not_valid")}else h=!1;if(""!=d&&1!=h&&(a("<span>").addClass("tag").append(a("<span>").text(d).append("\u00a0\u00a0"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+f).removeTag(escape(d))})).insertBefore("#"+f+"_addTag"),g.push(d),a("#"+f+"_tag").val(""),e.focus?a("#"+f+"_tag").focus():
a("#"+f+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,g),e.callback&&c[f]&&c[f].onAddTag&&(h=c[f].onAddTag,h.call(this,d)),c[f]&&c[f].onChange)){var k=g.length;h=c[f].onChange;h.call(this,a(this),g[k-1])}});return!1};a.fn.removeTag=function(d){d=unescape(d);this.each(function(){var e=a(this).attr("id"),f=a(this).val().split(b[e]);a("#"+e+"_tagsinput .tag").remove();str="";for(var g=0;g<f.length;g++)f[g]!=d&&(str=str+b[e]+f[g]);a.fn.tagsInput.importTags(this,str);c[e]&&c[e].onRemoveTag&&c[e].onRemoveTag.call(this,
d)});return!1};a.fn.tagExist=function(d){return 0<=jQuery.inArray(d,a(this))};a.fn.importTags=function(d){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,d)};a.fn.tagsInput=function(d){var e=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},d);this.each(function(){e.hide&&
a(this).hide();var f=a(this).attr("id"),g=jQuery.extend({pid:f,real_input:"#"+f,holder:"#"+f+"_tagsinput",input_wrapper:"#"+f+"_addTag",fake_input:"#"+f+"_tag"},e);b[f]=g.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange)c[f]=[],c[f].onAddTag=e.onAddTag,c[f].onRemoveTag=e.onRemoveTag,c[f].onChange=e.onChange;var h='<div id="'+f+'_tagsinput" class="tagsinput"><div id="'+f+'_addTag">';e.interactive&&(h=h+'<input id="'+f+'_tag" value="" data-default="'+e.defaultText+'" />');a(h+'</div><div class="tags_clear"></div></div>').insertAfter(this);
a(g.holder).css("width",e.width);a(g.holder).css("height",e.height);""!=a(g.real_input).val()&&a.fn.tagsInput.importTags(a(g.real_input),a(g.real_input).val());if(e.interactive){a(g.fake_input).val(a(g.fake_input).attr("data-default"));a(g.fake_input).css("color",e.placeholderColor);a(g.fake_input).resetAutosize(e);a(g.holder).bind("click",g,function(k){a(k.data.fake_input).focus()});a(g.fake_input).bind("focus",g,function(k){a(k.data.fake_input).val()==a(k.data.fake_input).attr("data-default")&&
a(k.data.fake_input).val("");a(k.data.fake_input).css("color","#000000")});if(void 0!=e.autocomplete_url){autocomplete_options={source:e.autocomplete_url};for(attrname in e.autocomplete)autocomplete_options[attrname]=e.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(g.fake_input).autocomplete(e.autocomplete_url,e.autocomplete),a(g.fake_input).bind("result",g,function(k,l,m){l&&a("#"+f).addTag(l[0]+"",{focus:!0,unique:e.unique})})):void 0!==jQuery.ui.autocomplete&&(a(g.fake_input).autocomplete(autocomplete_options),
a(g.fake_input).bind("autocompleteselect",g,function(k,l){a(k.data.real_input).addTag(l.item.value,{focus:!0,unique:e.unique});return!1}))}else a(g.fake_input).bind("blur",g,function(k){var l=a(this).attr("data-default");""!=a(k.data.fake_input).val()&&a(k.data.fake_input).val()!=l?k.data.minChars<=a(k.data.fake_input).val().length&&(!k.data.maxChars||k.data.maxChars>=a(k.data.fake_input).val().length)&&a(k.data.real_input).addTag(a(k.data.fake_input).val(),{focus:!0,unique:e.unique}):(a(k.data.fake_input).val(a(k.data.fake_input).attr("data-default")),
a(k.data.fake_input).css("color",e.placeholderColor));return!1});a(g.fake_input).bind("keypress",g,function(k){if(k.which==k.data.delimiter.charCodeAt(0)||13==k.which)return k.preventDefault(),k.data.minChars<=a(k.data.fake_input).val().length&&(!k.data.maxChars||k.data.maxChars>=a(k.data.fake_input).val().length)&&a(k.data.real_input).addTag(a(k.data.fake_input).val(),{focus:!0,unique:e.unique}),a(k.data.fake_input).resetAutosize(e),!1;k.data.autosize&&a(k.data.fake_input).doAutosize(e)});g.removeWithBackspace&&
a(g.fake_input).bind("keydown",function(k){if(8==k.keyCode&&""==a(this).val()){k.preventDefault();k=a(this).closest(".tagsinput").find(".tag:last").text();var l=a(this).attr("id").replace(/_tag$/,"");k=k.replace(/[\s]+x$/,"");a("#"+l).removeTag(escape(k));a(this).trigger("focus")}});a(g.fake_input).blur();g.unique&&a(g.fake_input).keydown(function(k){(8==k.keyCode||String.fromCharCode(k.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,\/]+/))&&a(this).removeClass("not_valid")})}return!1});
return this};a.fn.tagsInput.updateTagsField=function(d,e){var f=a(d).attr("id");a(d).val(e.join(b[f]))};a.fn.tagsInput.importTags=function(d,e){a(d).val("");var f=a(d).attr("id");e=e.split(b[f]);for(var g=0;g<e.length;g++)a(d).addTag(e[g],{focus:!1,callback:!1});c[f]&&c[f].onChange&&c[f].onChange.call(d,d,e[g])}})(jQuery);(function(a){function b(c){var d=[],e="";a.each(c,function(f,g){g.name&&("product_id[]"===g.name?d.push(parseInt(g.value,10)):"hash"===g.name&&(e=g.value))});!e&&d.length&&(e="id/"+d.join(","));return e}a.product_list={options:{},collection_hash:[],collection_param:"",total_count:0,category_count:0,sort:null,order:null,container:null,toolbar:null,sortable:!0,cached:{},fixed_blocks:{},init:function(c){var d=[];c.collection_param&&d.push(c.collection_param);d.push("view="+c.view);c.sort&&d.push("sort="+
c.sort);c.order&&d.push("order="+c.order);c.page&&1<c.page&&d.push("page="+c.page);d="#/products/"+d.join("&");a.products.forceHash(d);try{this.options=c;this.container=a("#product-list");this.toolbar=a(".js-product-list-toolbar");this.sidebar=a("#s-sidebar");var e=this.options.products;delete this.options.products;this.total_count=this.options.total_count||0;this.category_count=parseInt(this.options.category_count,10);isNaN(this.category_count)&&(this.category_count=this.total_count);this.sortable=
"undefined"===typeof c.sortable?this.sortable:c.sortable;this.sort=c.sort||null;if(c.enable_2x)this.container.on("append_product_list",function(){a.fn.retina&&a.product_list.container.find("img").not(".is-empty").retina()});if(e&&c.view){try{this.container.append(tmpl("template-product-list-"+this.options.view,{products:e,sort:this.sort,primary_currency:this.options.primary_currency,stocks:this.options.stocks},"thumbs"!=this.options.view)),this.container.trigger("append_product_list",[e])}catch(g){return console.log("Error: "+
g.message),this}delete c.products}a.isArray(this.options.collection_hash)&&this.options.collection_hash.length?this.collection_hash=this.options.collection_hash:this.collection_hash=[];this.collection_param=this.options.collection_param?this.options.collection_param:"";c.order&&(this.order=c.order);if(this.options.lazy_loading)this.initLazyLoad(this.options.lazy_loading);else{var f=d.replace(/&page=\d+/,"")+"&page=";a(".pagination a").each(function(){var g=a(this).attr("href").match(/\?page=(\d+)/);
a(this).attr("href",f+(g?g[1]:1))})}this.initSelecting();this.initView(this.options.view);this.initDragndrop();this.rubberTable();"table"==this.options.view&&this.initInlineEditor()}catch(g){a.shop.error("$.product_list.init error: "+g.message,g)}return this},initLazyLoad:function(c){var d=c.count,e=this.total_count;a(window).lazyLoad("stop");if(d<e){var f=this,g=f.container.find("tr.header th[data-additional-column]").map(function(){return a(this).data("additional-column")}).get().join(",");a(window).lazyLoad({container:f.container,
state:"undefined"===typeof c.auto||c.auto?"wake":"stop",hash:["","products"],load:function(){a(window).lazyLoad("sleep");a(".lazyloading-link").hide();a(".lazyloading-progress").show();a.get("?module=products&action=loadList&offset="+d+("&total_count="+e)+(f.collection_param?"&"+f.collection_param:"")+(f.sort?"&sort="+f.sort:"")+(f.order?"&order="+f.order:"")+("&enabled_columns="+(g||"")),function(h){if("ok"==h.status&&h.data.count){d+=h.data.count;var k=f.container;try{f.container.append(tmpl("template-product-list-"+
f.options.view,{products:h.data.products,check_all:k.find(".s-select-all:first").length?k.find(".s-select-all:first").attr("checked"):!1,sort:a.product_list.sort,primary_currency:a.product_list.options.primary_currency,stocks:a.product_list.options.stocks})),f.container.trigger("append_product_list",[h.data.products])}catch(l){console.log("Error: "+l.message);a(window).lazyLoad("stop");return}k.find(".last").removeClass("last");k.find(".product:last").addClass("last");a(".lazyloading-progress-string").text(h.data.progress.loaded+
" "+h.data.progress.of);a(".lazyloading-progress").hide();a(".lazyloading-chunk").text(h.data.progress.chunk);d>=e?(a(window).lazyLoad("stop"),a(".lazyloading-link").hide()):(a(".lazyloading-link").show(),a(window).lazyLoad("wake"))}else h.data&&!h.data.count?console&&(console.log("Count of again loaded products is 0"),a(".lazyloading-progress").hide()):(h.errors&&console&&console.log("Error when loading products: "+h.errors),a(window).lazyLoad("stop"))},"json")}});a(".lazyloading-link").off("click").on("click",
function(){a(window).lazyLoad("force");return!1})}},initSelecting:function(){var c=this.container,d=this.toolbar.find(".count"),e=c.find(".s-select-all:first"),f=function(){var g=parseInt(c.find("> .product.selected").length,10);g?d.text(g).show():d.text("").hide()};a(document).keydown(function(g){16!=g.keyCode||a(g.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(g){16==g.keyCode&&(document.body.onselectstart=null)});c.off("select",".product").on("select",
".product",function(g,h,k){k=void 0!==k?k:!0;(void 0!==h?h:1)?a(this).addClass("selected").find("input:first").attr("checked",!0):(a(this).removeClass("selected").find("input:first").attr("checked",!1),e.is(":checked")&&e.attr("checked",!1));k&&f();return!1});e.unbind("select").bind("select",function(g,h){h=void 0!==h?h:!0;g=a(this);h?(g.attr("checked",!0),c.find("> .product").trigger("select",!0,!1),d.text(g.attr("data-count")).show()):(g.attr("checked",!1),c.find("> .product").trigger("select",
!1,!1),d.text("").hide())});c.off("click",".product input").on("click",".product input",function(g,h){var k=g.shiftKey;g=this.checked;h&&(k=h.shiftKey,g=h.checked);h=a(this).parents(".product:first");g?h.addClass("selected"):(e.is(":checked")&&e.attr("checked",!1),h.removeClass("selected"));if(k&&g){(k=c.data("last_checked"))||(k=c.find("> .product:first").trigger("select",!0));var l=h.prevAll(".selected[data-product-id="+k.attr("data-product-id")+"]");if(l.length){var m=h.prev();for(k=k.get(0);m.length&&
k!=m.get(0);)m.addClass("selected").find("input").attr("checked",!0),m=m.prev()}else if(l=h.nextAll(".selected[data-product-id="+k.attr("data-product-id")+"]"),l.length)for(m=h.next(),k=k.get(0);m.length&&k!=m.get(0);)m.addClass("selected").find("input").attr("checked",!0),m=m.next();c.data("last_checked")||l.length||k.trigger("selected",!1)}g&&c.data("last_checked",h);f()});if(a.browser.mozilla)c.off("click",".product label").on("click",".product label",function(g){if(g.shiftKey){var h=a(g.target);
a(h).is("label")||(h=a(h).parents("label:first"));h=a("#"+h.attr("for"));h.trigger("click",{shiftKey:g.shiftKey,checked:!h.attr("checked")})}})},initView:function(c){try{var d=this.container,e=this.sidebar;d.find(".s-select-all:first").length&&d.find(".s-select-all:first").click(function(){a(this).trigger("select",this.checked)});"table"==c&&(a("#s-content .list-view-mode-table").click(function(){d.toggleClass("single-lined");a.storage.set("shop/product_list/multi-lined",!d.hasClass("single-lined"));
return!1}),a.storage.get("shop/product_list/multi-lined")&&d.removeClass("single-lined"));var f="view="+c;e.find(".s-collection-list li.dr").each(function(){var l=a(this);l.find("a:first").attr("href","#/products/"+l.attr("id").replace("-","_id=")+"&"+f)});a("#s-products-search").autocomplete("disable").val(this.options.text||"").autocomplete("enable");var g="s-all-products",h=a.product_list.collection_hash.length&&"search"!==a.product_list.collection_hash[0]&&"tag"!==a.product_list.collection_hash[0]&&
"id"!==a.product_list.collection_hash[0];h&&(g=a.product_list.collection_hash.join("-"));a.shop.trace("$.product_list.initView",[c,g]);e.find("li.selected").removeClass("selected");var k=e.find("#"+g);0>=k.length&&window.location.hash&&(k=e.find('a[href="'+window.location.hash+'"]').parent());0>=k.length&&(k=e.find("#s-all-products"));k.addClass("selected");h&&k.find(".count:first").text(this.category_count);this.initEditingControls();this.initToolbar();a(document).trigger("product_list_init_view")}catch(l){a.shop.error("$.product_list.initView error: "+
l.message,l)}},highlightInlineEditorCells:function(){a.product_list.container.find("tr").each(function(){var c=a(this),d=c.data("edit-rights");d&&c.data("min-price")==c.data("max-price")||c.find(".s-product-price .editable").filter(function(){return!a(this).data("plugin")}).addClass("not-editable");d&&1==c.data("sku-count")||c.find(".s-product-stock .editable").filter(function(){return!a(this).data("plugin")}).addClass("not-editable")})},initInlineEditor:function(){function c(g,h){if(g.data("denied-reason")==
h)g.data("denied-reason",""),alert(h);else{g.data("denied-reason",h);setTimeout(function(){g.data("denied-reason","")},3E3);g.wrapInner('<div class="animation-container" style="position:relative;"></div>');var k=g.find(".animation-container").animate({left:"3px"},100,function(){k.animate({left:"0px"},100,function(){k.animate({left:"3px"},100,function(){k.animate({left:"0px"},100,function(){k.children().first().unwrap()})})})})}}function d(g){var h=[];a.product_list.container.find("tr.product").each(function(){var k=
a(this);void 0===k.data("original-price")&&k.data("edit-rights")&&h.push(a(this).data("product-id"))});if(!h.length)return g();a.post("?module=products&action=inlineEditorData",{ids:h},function(k){k.data&&a.product_list.container.find("tr.product").each(function(){var l=a(this),m=k.data[parseInt(l.data("product-id"),10)];m&&(l.data("stocks",m.stocks||null),l.data("original-price",m.price.replace(/\.?0+$/g,"")))});g()},"json")}var e=this,f=0;e.options.stocks&&e.options.stocks.length&&(f=e.options.stocks.length);
a.product_list.highlightInlineEditorCells();a.product_list.container.on("append_product_list",function(){a.product_list.highlightInlineEditorCells()});a.product_list.container.on("click",".s-product-price,.s-product-stock",function(){function g(){if(l)h.html(tmpl("template-list-price-editor-one",{product_id:k.data("product-id"),currency:k.data("currency"),value:k.data("original-price")}));else{var m=k.data("stocks");f?(m&&"object"===typeof m||(m={}),h.html(tmpl("template-list-stock-editor-many",{product_id:k.data("product-id"),
values:m}))):(m&&"object"!==typeof m||(m=""),h.html(tmpl("template-list-stock-editor-one",{product_id:k.data("product-id"),value:m})))}h.find(".cancel").click(function(){var n=h;n.removeClass("editor-on").html(n.data("read-only-state-html"));n.data("read-only-state-html","");n.data("denied-reason","")});var p=h.find("form").submit(function(){if(p.find(".loading").length)return!1;p.find(":submit").after('<i class="icon16 loading"></i>');a.post("?module=products&action=inlineSave",p.serialize(),function(n){p.find(".loading").remove();
try{n.data&&n.data[0]&&(n.data[0].alien=k.hasClass("s-alien"));var r=a("<table>").html(tmpl("template-product-list-table",{products:n.data,check_all:a.product_list.container.find(".s-select-all:first").prop("checked"),sort:a.product_list.sort}));k.replaceWith(r.find("tr"));e.container.trigger("append_product_list",[n.data])}catch(u){console.log("Error: "+u.message)}},"json");return!1});p.on("dblclick",!1);setTimeout(function(){h.find(":input:visible:first").focus()},0)}var h=a(this);if(!h.data("plugin")){var k=
h.closest("tr"),l=h.hasClass("s-product-price");if(l){if(k.data("min-price")!=k.data("max-price"))return c(h,$_("Inline editing is available only for products with a single SKU"))}else if("1"!=k.data("sku-count"))return c(h,$_("Inline editing is available only for products with a single SKU"));if(!k.data("edit-rights"))return c(h,$_("Insufficient access rights"));h.hasClass("editor-on")||(h.addClass("editor-on").data("read-only-state-html",h.html()),a.product_list.container.removeClass("single-lined"),
void 0!==k.data("original-price")?g():(h.html('<i class="icon16 loading"></i>'),d(g)))}})},initEditingControls:function(){var c=a("#s-product-list-title"),d=a.product_list.collection_hash[0],e="?module=category&action=save&";"set"===d&&(e="?module=set&action=save&");c.hasClass("editable")&&(c.inlineEditable({minSize:{width:350},maxSize:{width:600},size:{height:30},inputClass:"s-title-h1-edit",beforeMakeEditable:function(){a(".s-product-list-manage").hide()},afterBackReadable:function(f,g){a(".s-product-list-manage").show();
if(!g.changed)return!1;a.shop.jsonPost(e+a.product_list.collection_param+"&edit=name",{name:a(f).val()},function(h){a.product_list.sidebar.find("#"+d+"-"+h.data.id).find(".name:first").html(h.data.name)})}}),"name"==this.options.edit&&c.trigger("editable"));c=a("#s-product-list-settings");!c.length||"category"!=d&&"set"!=d||c.unbind("click").bind("click",function(){"category"==d?shopDialogProductsCategory.staticDialog(a.product_list.collection_hash[1],null,"edit"):shopDialogProductsSet.staticDialog(a.product_list.collection_hash[1],
"edit");return!1});c=a("#s-product-list-delete");!c.length||"category"!=d&&"set"!=d||c.unbind("click").bind("click",function(){a("#s-product-list-delete-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(){function f(p,n){if(!p.length)return n&&n();var r=p.shift();g(["category",r],function(){f(p,n)})}function g(p,n){var r={hash:p.join("/")||"all",remove:["list"]};m&&r.remove.push("products");var u=function(){a.product_list.remove(r,
function(q,t){h(p,q);a.product_list.sidebar.trigger("update",q.data.lists);n&&n()})},x=a("#"+p.join("-")+"-handler");x.length?a.categories_tree.expand(x,function(q){q.parent().find("ul:first").hide();u()}):u();return!1}function h(p,n){var r=p[0],u=a("#"+p.join("-")),x=u.prev(".drag-newposition");p=a("#s-"+p[0]+"-list");var q=p.find("ul:first");"set"==r?(u.remove(),x.remove()):(r=u.find("ul:first"),r.length&&(r.find(">li.drag-newposition:first").remove(),u.hide(),r.find(">li").each(function(){u.after(this)})),
r=u.parents("ul:first"),u.remove(),x.remove(),r.find("li.dr").length||(q.get(0)!=r.get(0)?(r.parents("li:first").find("i.collapse-handler").remove(),r.closest("li").find(".collapse-handler-ajax:first").remove(),r.remove()):q.closest(".block").find(".collapse-handler-ajax:first").remove()));q.find("li.dr:first").length?(q.show(),p.find(".s-empty-list").hide()):(q.hide(),p.find(".s-empty-list").show());n.data.old_parent_category&&"undefined"!==typeof n.data.old_parent_category.children_count&&!parseInt(n.data.old_parent_category.children_count,
10)&&a("#category-"+n.data.old_parent_category.id+"-handler").remove()}var k=a(this),l=parseInt(a.product_list.collection_hash[1]);k.find(".dialog-buttons i.loading").show();var m="1"==k.find("input[name=s-delete-products]:checked").val();"category"==d&&k.find('input[name="s-delete-sub"]').is(":checked")?a.get("?action=categoryExpand&tree=1&recurse=1&id="+l,function(p){p=a("<div>").html(p).find('li[id^="category-"]').map(function(){return parseInt(this.id.substr(9),10)}).get().reverse();p.push(l);
f(p,function(){location.href="#/"})}):g(a.product_list.collection_hash,function(){location.href="#/"});return!1}});return!1});"set"===d&&a("#s-embed-code").click(function(){a("#s-product-list-embed-dialog").waDialog();return!1})},initDragndrop:function(){a.product_dragndrop.init({products:!0,view:this.options.view,sort:this.options.sort}).bind("move_product",function(c){a.shop.jsonPost("?module=product&action=move&"+a.product_list.collection_param,{product_ids:c.product_ids,before_id:c.before_id||
null},c.success,c.error)}).bind("is_product_sortable",function(){return a.product_list.sortable}).bind("add_to_list",function(c){var d={};c.whole_list?d.hash=a.product_list.collection_hash.join("/")||"all":d.product_id=c.product_ids;a.shop.jsonPost("?module=product&action=addToList&"+c.collection_param,d,c.success,c.error)})},initToolbar:function(){var c=this.toolbar;c.find("li").unbind("click.product_list").bind("click.product_list",function(d){d.preventDefault();d=a(this);var e=d.attr("data-action");
if(e){var f=a.product_list.getSelectedProducts("delete"!=e);if(!f.count)return alert($_("Please select at least one product")),!1;switch(e){case "new-set":break;case "category":a.product_list.categoriesDialog(f);break;case "set":a.product_list.setsDialog(f);break;case "type":a.product_list.typesDialog(f);break;case "assign-tags":a.product_list.assignTagsDialog(f);break;case "delete":a.product_list.deleteProductsDialog(f);break;case "delete-from-set":"set"==a.product_list.collection_hash[0]&&a.product_list.deleteFromSet(f);
break;case "delete-from-category":"category"==a.product_list.collection_hash[0]&&a.product_list.deleteFromCategory(f);break;case "visibility":a.product_list.visibilityDialog(f,d);break;case "export":a.product_list.exportProducts(f,a(this).attr("data-plugin"));break;case "duplicate":a.product_list.duplicateProducts(f,a(this));break;case "promo":a.product_list.associatePromo(f,a(this));break;case "coupon":a.product_list.createCoupon(f);break;case "set-badge":case "delete-badge":a.product_list.setBadge(f,
a(this));break;default:return}return!1}});c.find('li[data-action="set-custom-badge"] a').click(function(){a(this).parent().find(".textarea-wrapper").slideToggle("fast");return!1}).closest("li").find(".textarea-wrapper").click(function(){return!1}).find("input").click(function(){var d=a.product_list.getSelectedProducts(!0);d.count?a.product_list.setBadge(d,a(this).closest("li")):alert($_("Please select at least one product"));return!1});(function(){var d,e=a("#mainmenu").height(),f=c.find(":first").offset().top-
e,g=a(document),h=a(window);g.bind("scroll",d=function(){jQuery.contains(document.documentElement,c[0])?g.scrollTop()>f&&c.height()+e<h.height()?c.addClass("s-fixed").css({top:e}):c.removeClass("s-fixed"):(g.off("scroll",d),h.off("resize",d))});h.bind("resize",d)})()},getSelectedProducts:function(c){c=c||!1;var d={count:0};if(this.container.find(".s-select-all:first").attr("checked")){var e=a.product_list.collection_hash.join("/")||"all";c?d.serialized=[{name:"hash",value:e}]:d.hash=e;d.count=this.total_count}else c?
d.serialized=a.product_list.container.find(".product.selected").map(function(){d.count+=1;return{name:"product_id[]",value:a(this).attr("data-product-id")}}).toArray():d.product_id=a.product_list.container.find(".product.selected").map(function(){d.count+=1;return a(this).attr("data-product-id")}).toArray();return d},visibilityDialog:function(c,d){if(!a.isArray(c.serialized))return!1;var e=d.find("i.icon16");if(!e.hasClass("loading")){d=a("#visibility-dialog-wrapper");d.length||(d=a('<div id="visibility-dialog-wrapper">').appendTo("#s-content"));
var f=e.attr("class");e.attr("class","icon16 loading");d.data("products",c).load("?module=dialog&action=visibility",function(){e.attr("class",f)})}},categoriesDialog:function(c){var d=a("#s-categories"),e=this.sidebar,f=this.container;d.length&&d.parent().remove();a("<div></div>").appendTo("body").load("?module=dialog&action=categories",function(){a("#s-categories").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var g=a(this);g.find(".dialog-content h1 span").text("("+c.count+")").show();g.find(".dialog-buttons i.loading").hide();
g.find("input[name=new_category_name]").val("");g.find("input[name=new_category]").attr("checked",!1)},onSubmit:function(g){var h=g.find("form");h.find(".dialog-buttons i.loading").show();a.shop.jsonPost(h.attr("action"),h.serializeArray().concat(c.serialized),function(k){k.data.new_category&&a("#s-category-list ul:first").trigger("add",[k.data.new_category,"category","#/products/category_id="+k.data.new_category+"&view="+a.product_list.options.view]);k.data.categories&&(e.trigger("update",[{category:k.data.categories}]),
f.find(".s-select-all:first").trigger("select",!1));h.find("input:checked").attr("checked",!1);g.trigger("close")});return!1}})})},setsDialog:function(c){var d=a("#s-sets"),e=this.sidebar,f=this.container;d.length&&d.parent().remove();a("<div></div>").appendTo("body").load("?module=dialog&action=sets",function(){a("#s-sets").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var g=a(this);g.find(".dialog-content h1 span").text("("+c.count+")").show();g.find(".dialog-buttons i.loading").hide();
g.find("input[name=new_set_name]").val("");g.find("input[name=new_set]").attr("checked",!1)},onSubmit:function(g){var h=g.find("form");h.find(".dialog-buttons i.loading").show();a.shop.jsonPost(h.attr("action"),h.serializeArray().concat(c.serialized),function(k){k.data.new_set&&a("#s-set-list ul:first").trigger("add",[k.data.new_set,"set","#/products/set_id="+k.data.new_set+"&view="+a.product_list.options.view]);k.data.sets&&(e.trigger("update",[{set:k.data.sets}]),f.find(".s-select-all:first").trigger("select",
!1));h.find("input:checked").attr("checked",!1);g.trigger("close")});return!1}})})},assignTagsDialog:function(c){var d=a("#s-assign-tags"),e=function(){a("#s-assign-tags").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){var f=a(this);f.find(".dialog-content h1 span").text("("+c.count+")").show();f.find(".dialog-buttons i.loading").hide()},onSubmit:function(f){var g=a(this),h=g.find("#s-assign-tags-list_tag");if(h.length){var k=jQuery.Event("keypress",{which:13});h.trigger(k)}g.find(".dialog-buttons i.loading").show();
var l=g.attr("action");setTimeout(function(){var m=g.serializeArray().concat(c.serialized);a.shop.jsonPost(l,m,function(p){p.data.denied_message&&alert(p.data.denied_message);"search"===p.data.cloud?f.trigger("close"):p.data.cloud&&a("#s-tag-cloud").trigger("update",[p.data.cloud]);f.trigger("close");a.products.dispatch()},function(){f.trigger("close")})},10);return!1}})};d.length&&d.remove();a.post("?module=dialog&action=assignTags",c.serialized,function(f){a("body").append(f);e()})},typesDialog:function(c){var d=
a("#s-types"),e=this.container,f=this.sidebar,g=function(){a("#s-types").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(k){var l=a(this);l.find(".dialog-buttons i.loading").show();a.shop.jsonPost(l.attr("action"),l.serializeArray().concat(c.serialized),function(m){f.trigger("update",{type:m.data.types});e.find(".s-select-all:first").trigger("select",!1);l.find("input:checked").attr("checked",!1);k.trigger("close");a.products.dispatch()});
return!1}})},h=d.parent();d.length?g():(h=a("<div></div>").appendTo("body"),h.load("?module=dialog&action=types",g))},deleteFromSet:function(c){0<c.count&&a.shop.jsonPost("?module=products&action=deleteFromSet&id="+this.collection_hash[1],c.serialized,function(){a.products.dispatch()})},deleteFromCategory:function(c){0<c.count&&a.shop.jsonPost("?module=products&action=deleteFromCategory&id="+this.collection_hash[1],c.serialized,function(){a.products.dispatch()})},deleteProductsDialog:function(c){var d=
function(){a("#s-product-list-delete-products-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a(this).find(".dialog-buttons i.loading").hide()},onSubmit:function(g){a(this).find(".dialog-buttons i.loading").show();a.product_list.remove(a.extend(c,{remove:["products"]}),function(h,k){a.product_list.sidebar.trigger("update",h.data.lists);a.products.dispatch();g.trigger("close");k.length&&alert((g.data("not-allowed-string")||"").replace("%d",k.length))});return!1}})},e=a("#s-product-list-delete-products-dialog"),
f=e.parent();e.length||(f=a("<div></div>").appendTo("body"));0<c.count&&f.load("?module=dialog&action=productsDelete",c,d)},exportProducts:function(c,d){for(var e=[],f,g=!1;f=c.serialized.pop();)f.name&&("product_id[]"==f.name?e.push(parseInt(f.value,10)):"hash"==f.name&&(g=f.value));c="?action=importexport#/"+d;g?window.location=c+("/hash/"+g):e.length&&(c+="/hash/id/"+e.join(","),window.location=c)},createCoupon:function(c){for(var d=[],e,f=!1;e=c.serialized.pop();)e.name&&("product_id[]"==e.name?
d.push(parseInt(e.value,10)):"hash"==e.name&&(f=e.value));c=this.options.marketing_url+"coupons/create/";f?window.location=c+("?products_hash="+f):d.length&&(c+="?products_hash=id/"+d.join(","),window.location=c)},duplicateProducts:function(c,d){for(var e=[],f,g=!1;f=c.serialized.pop();)f.name&&("product_id[]"==f.name?e.push(parseInt(f.value,10)):"hash"==f.name&&(g=f.value));!g&&e.length&&(g="id/"+e.join(","));g&&(d.find("i.icon16").removeClass("split").addClass("loading"),this.duplicate(g,{progress:function(h){d.attr("title",
Math.round(100*h.offset/h.total_count)+"%")},finish:function(h,k){d.attr("title",null);var l=d.find("i.icon16");l.removeClass("loading").addClass("yes");setTimeout(function(){l.removeClass("yes").addClass("split")},3E3);a(document).one("product_list_init_view",function(){var m={};a.each(k,function(p,n){m[n]=1});a("#product-list [data-product-id]").each(function(){var p=a(this),n=a(this).data("product-id");n&&m[n]&&p.addClass("highlighted")})});(h||k)&&a.products.dispatch()},error:function(h){}}))},
setBadge:function(c,d){function e(l){var m="delete-badge"==f?null:l.data;a("#product-list [data-product-id]").each(function(){var p=a(this);if(h||g[p.data("product-id")]){if(p.is("tr")){var n=p.find(".s-image a");n.find(".s-image-corner").remove();m&&n.prepend(a('<div class="s-image-corner"></div>').html(m))}else n=p.find(".s-product-image a"),n.find(".s-image-corner.top.right").remove(),m&&n.append(a('<div class="s-image-corner top right"></div>').html(m));p.trigger("badge",[m])}});"set-custom-badge"==
f&&d.parent().find(".textarea-wrapper").slideUp("fast");d.find(".loading").remove();d.find("a").append(a('<span class="count"><i class="icon16 yes"></i></span>').animate({opacity:0},function(){a(this).remove()}));a.product_list.container.find(".s-select-all:first").trigger("select",!1)}var f=d.data("action");"set-custom-badge"!=f&&d.parent().find(".textarea-wrapper").slideUp("fast");d.find(".loading").remove();d.find("a").append('<span class="count"><i class="icon16 loading"></i></span>');var g={},
h=!1;a.each(c.serialized,function(){h=h||"hash"==this.name;g[this.value]=1});if("delete-badge"==f)d.find(".loading").remove(),a.shop.jsonPost("?module=product&action=badgeDelete",c.serialized,e);else{var k="set-custom-badge"==f?d.find("textarea").val():d.data("type");c=c.serialized;c.push({name:"code",value:k});a.shop.jsonPost("?module=product&action=badgeSet",c,e,function(l){"object"===typeof l.errors&&"string"===typeof l.errors[0]&&alert(l.errors[0]);d.find(".loading").remove()})}},duplicate:function(c,
d){var e=this,f=[];a.shop.jsonPost("?module=products&action=duplicate",{hash:c,limit:50,offset:d.offset||0},function(g){"ok"==(g.status||"error")?(f=f.concat(g.data.new_ids||[]),g.data.offset<g.data.total_count?(d.offset=g.data.offset,e.duplicate(c,d),d.progress(g.data||{})):d.finish(g.data||{},f)):"fail"==g.status&&g.errors.message&&a("#s-product-list-duplicate-error-dialog").waDialog()},function(g){if(g.errors)if(d.finish(),g.errors.message){var h=a("#s-product-list-duplicate-error-dialog");h.find(".js-content").html(g.errors.message);
h.waDialog()}else alert(g.errors)})},remove:function(c,d){var e={},f=[];if(c.product_id)var g=function(){100>=c.product_id.length&&(e.get_lists=!0);e.product_id=c.product_id.splice(0,100);a.shop.jsonPost("?module=products&action=deleteList",e,function(h){h.data.not_allowed&&h.data.not_allowed.length&&(f=f.concat(h.data.not_allowed));c.product_id.length?g():"function"===typeof d&&d(h,f)})};else e.hash=c.hash||this.collection_hash.join("/")||"all",e.remove=a.isArray(c.remove)&&c.remove.length?c.remove:
["list"],1==e.remove.length&&"list"==e.remove[0]?g=function(){a.shop.jsonPost("?module=products&action=deleteList",e,d)}:(e.count=100,g=function(){a.shop.jsonPost("?module=products&action=deleteList",e,function(h){h.data.not_allowed&&h.data.not_allowed.length&&(f=f.concat(h.data.not_allowed));0<h.data.rest_count&&null!=h.data.rest_count?g():"function"===typeof d&&d(h,f)})});g()},associatePromo:function(c,d){function e(){var f=location.pathname+"?module=productsAssociatePromoDialog",g={products_hash:b(c.serialized)};
return a.post(f,g).done(function(h){a(h).waDialog({onLoad:function(){a("body").addClass("is-scroll-locked")},onCancel:function(){a("body").removeClass("is-scroll-locked");a(this).remove()}})})}d.data("locked")||(d.data("locked",!0),e().always(function(){d.removeData("locked")}))},rubberTable:function(){var c=a("#wa"),d=a("#s-content"),e=a("#s-content > .content");d=parseInt(d.css("margin-left"));var f=parseInt(e.css("margin-right")),g=a(".s-product-list-table-container table").width(),h=c.attr("style");
h&&c.data("style",h);e=parseInt(e.width()-a(".s-product-list-table-container").width())+g+d+f;c.width()<e&&c.css({"min-width":e+"px"});a(window).resize()}}})(jQuery);var shopDialogProductsSet=function(a){shopDialogProductsSet=function(b){this.$wrapper=b.$wrapper;this.is_new=b.is_new;this.initClass()};shopDialogProductsSet.prototype.initClass=function(){this.is_new&&this.initTransliterateSetID();this.initTypeSwitch();this.initDatepickers()};shopDialogProductsSet.prototype.initTypeSwitch=function(){var b=this.$wrapper;b.find("input[name=type]").on("click",function(){"0"==a(this).val()?b.find(".js-set-dynamic-settings").hide():b.find(".js-set-dynamic-settings").show()})};
shopDialogProductsSet.prototype.initDatepickers=function(){var b=this;b.$wrapper.find(".js-datepicker").each(function(){var c=a(this);c.datepicker({});c.datepicker("widget").hide()});(function(){function c(f){var g=a.datepicker._defaults.dateFormat,h=null;try{a.datepicker.parseDate(g,f),h=!0}catch(k){h=!1}return h}var d=b.$wrapper.find(".js-start-date"),e=b.$wrapper.find(".js-finish-date");d.on("change",function(){var f=a(this),g=a.trim(f.val()),h=null;g&&(c(g)?h=new Date(f.datepicker("getDate").getTime()+
864E5):f.val("").addClass("error"));e.datepicker("option","minDate",h)});e.on("change",function(){var f=a(this),g=a.trim(f.val()),h=null;g&&(c(g)?h=new Date(f.datepicker("getDate").getTime()-864E5):f.val("").addClass("error"));d.datepicker("option","maxDate",h)});a([d,e]).on("keydown",function(f){f=a(this);f.hasClass("error")&&f.removeClass("error")});d.trigger("change").datepicker("refresh");e.trigger("change").datepicker("refresh")})()};shopDialogProductsSet.prototype.initTransliterateSetID=function(){var b=
this.$wrapper,c=b.find(".js-product-set-id");b=b.find(".js-product-list-name");var d="",e=!1,f,g;c.bind("keydown",function(){var h=a(this);null!==f&&(clearTimeout(f),f=null);f=setTimeout(function(){var k=h.val();d!==k&&(e=!0,d=k,h.unbind("keydown"))},200)});b.bind("keydown",function(){var h=a(this);e?h.unbind("keydown"):(null!==g&&(clearTimeout(g),g=null),g=setTimeout(function(){var k=h.val();k&&a.getJSON("?action=transliterate&str="+k,function(l){e?h.unbind("keydown"):"ok"==l.status&&(d=l.data,c.val(d))})},
200))})};shopDialogProductsSet.staticDialog=function(b,c){var d=a("#s-product-set-dialog"),e=function(){d=a("#s-product-set-dialog");d.waDialog({esc:!1,disableButtonsOnSubmit:!0,onLoad:function(){new shopDialogProductsSet({$wrapper:d,is_new:"new"===c});setTimeout(function(){a(".js-product-list-name").focus()},50)},onSubmit:function(g){var h=a(this),k=function(m){if(0<location.hash.indexOf("set_id")){var p=location.hash.replace("set_id="+b,"set_id="+m.data.id);"rule"in m.data&&(p=p.replace(/&sort=[^&]*/,
"&sort="),p=p.replace(/&order=[^&]*/,"&order="))}else p="#/products/set_id="+m.data.id;"new"===c&&a.product_sidebar.createNewElementInList(m.data,"set");a.product_sidebar.updateItemInCategoryList(m,p);location.hash!=p?location.hash=p:a.products.dispatch();g.trigger("close")},l=function(m){if(m&&m.errors){m=m.errors;var p=0,n;for(n in m){var r=g.find("input[name="+n+"]");if(r.length){r.addClass("error");p+=1;var u=r.parent().find(".errormsg");u.length&&u.text(m[n]);r.one("keyup",function(){--p||h.find("[type='submit']").removeAttr("disabled",
!1);r.removeClass("error");u.length&&u.text("")})}}return!1}};if(h.find("input:file").length)a.products._iframePost(h,k,l);else return a.shop.jsonPost(h.attr("action"),h.serialize(),k,l),!1},onClose:function(){d.find(".js-datepicker").each(function(){a(this).datepicker("widget").hide()})}})};var f=d.length?d.closest(".s-products-set-dialog-wrapper").empty():a('<div class="s-products-set-dialog-wrapper"></div>').appendTo("body");"new"===c?f.load("?module=set&action=Create",e):"edit"===c&&f.load("?module=set&action=Edit&set_id="+
b,e)};return shopDialogProductsSet}(jQuery);var shopDialogProductsCategory=function(a){shopDialogProductsCategory=function(b){this.$wrapper=b.$wrapper;this.category_id=b.category_id;this.category_type=b.category_type;this.account_name=b.account_name;this.filter_count=b.filter_count;this.filter_ignore_id=[];this.ignore_id=[];this.filter_element_html=b.templates.filter_element_html;this.show_all=b.texts.show_all;this.initClass()};shopDialogProductsCategory.prototype.initClass=function(){var b=this;b.initAutocomplete();b.initEvent();b.initFilter();
b.initMetaTagEdit();b.initFrontendUrlEdit();b.initCategoryVisibility();b.initSocialMetaTag();b.initShowMoreFilters();b.initFilterIgnoreId();b.updateShowFilterButton();b.initFilterAutocomplete();var c=b.$wrapper.find('*[data-slider="range"]');c.length&&c.each(function(){b.initRangeSlider(".js-feature-slider-"+a(this).data("code"))})};shopDialogProductsCategory.prototype.initEvent=function(){this.initDynamicSettingsEvent();this.disableManualSorting();this.initShowMore();this.initShowAllFeatureValue();
this.initGetFeatures();this.initFieldValidation()};shopDialogProductsCategory.prototype.initShowMoreFilters=function(){var b=this;b.$wrapper.on("click",".js-show-more-filters",function(c){c.preventDefault();c={category:b.category_id,offset:b.getFilterOffset(),ignore_id:b.filter_ignore_id,category_type:b.category_type,get_all:!0};a.post("?module=categoryGetFeatures",c).success(function(d){if(!d||!d.data.features)return!1;a.each(d.data.features,function(e,f){b.setFilterElement(f)});b.updateShowFilterButton(!0)})})};
shopDialogProductsCategory.prototype.updateShowFilterButton=function(b){b=void 0===b?!1:b;var c=this.$wrapper.find(".js-show-more-filters"),d=this.$wrapper.find(".js-category-filters .js-filter-checkbox").length;d=d-1-this.filter_ignore_id.length;d=this.filter_count-d;0<d&&!1===b?c.text(this.show_all+" ("+d+")"):c.hide()};shopDialogProductsCategory.prototype.setFilterElement=function(b,c){var d=this.filter_element_html,e=this.$wrapper.find(".js-category-filters");c=c?c:!1;d=d.replace(/%id/g,b.id);
d=d.replace(/%name/g,b.name);d=d.replace(/%code/g,b.code);d=d.replace(/%type_name/g,b.type_name);e.append(d);c&&this.$wrapper.find('.js-category-filter input[data-filter-id="'+b.id+'"]').prop("checked",!0)};shopDialogProductsCategory.prototype.getFilterOffset=function(){var b=this.$wrapper.find(".js-category-filters .js-filter-checkbox").length;b=b-1-this.filter_ignore_id.length;0>b&&(b=0);return b};shopDialogProductsCategory.prototype.initFilterIgnoreId=function(){var b=[];this.$wrapper.find(".js-category-filters .js-filter-checkbox:checked").each(function(){var c=
a(this).val();"price"!==c&&b.push(c)});this.filter_ignore_id=b};shopDialogProductsCategory.prototype.initFilterAutocomplete=function(){var b=this,c=b.$wrapper.find(".js-filter-autocomplete");c.autocomplete({source:function(d,e){a.post("?action=autocomplete&type=filter",{term:d.term,category_id:b.category_id,options:{ignore_id:b.filter_ignore_id,category_type:b.category_type}},function(f){e(f)},"json")},minLength:1,delay:300,create:function(){c.autocomplete("widget").appendTo(".js-filter-autocomplete-block")},
select:function(d,e){d.preventDefault();b.setFilterElement(e.item,!0);b.filter_ignore_id.push(parseInt(e.item.id));a(this).val("");return!1},focus:function(){return!1}})};shopDialogProductsCategory.prototype.initAutocomplete=function(){var b=this,c=b.$wrapper.find(".js-autocomplete"),d=[];c.length&&c.autocomplete({source:function(e,f){b.$wrapper.find(".js-condition-feature").each(function(){var g=a(this).data("feature_id");a.isNumeric(g)&&-1==a.inArray(g,d)&&d.push(g)});a.ajax({type:"POST",url:"?action=autocomplete&type=feature",
data:{term:e.term,options:{ignore_id:d,count:1}},success:function(g){var h=b.$wrapper.find(".js-autocomplete-wrapper .errormsg");f(g);0===g.length?h.html("").html($_("Matching features were not found or are already selected.")):h.html("")},dataType:"json"})},minLength:1,delay:300,create:function(){c.autocomplete("widget").appendTo(".js-autocomplete-block")},select:function(e,f){b.renderFeature(f.item.id);b.ignore_id.push(parseInt(f.item.id));return!1},focus:function(){return!1}})};shopDialogProductsCategory.prototype.initRangeSlider=
function(b){var c=a(b).find(".js-begin"),d=a(b).find(".js-end"),e=parseFloat(c.attr("placeholder")),f=parseFloat(d.attr("placeholder")),g=1,h=a(b).find(".js-range-slider");if(h.data("step"))g=parseFloat(h.data("step"));else if(b=f-e,Math.round(e)!=e||Math.round(f)!=f){g=b/10;for(b=0;1>g;)g*=10,b+=1;g=Math.pow(10,-b);(b=Math.round(1E5*Math.abs(Math.round(e)-e))/1E5)&&b<g&&(g=b);(b=Math.round(1E5*Math.abs(Math.round(f)-f))/1E5)&&b<g&&(g=b)}e=parseFloat(c.val()?c.val():0);f=parseFloat(d.val()?d.val():
100<c.val()?parseFloat(c.val())+100:100);h.slider({range:!0,min:e-3,max:f+5,step:g,values:[e,f],slide:function(k,l){k=a(this).slider("option","min");var m=a(this).slider("option","max");2!=a(l.handle).index()&&(l.values[0]==k&&a(this).slider("option","min",k-g),c.val(l.values[0]));1!=a(l.handle).index()&&(l.values[1]==m&&a(this).slider("option","max",m+g),d.val(l.values[1]))},stop:function(k,l){d.change()}});c.add(d).change(function(){var k=""===c.val()?h.slider("option","min"):parseFloat(c.val()),
l=""===d.val()?h.slider("option","max"):parseFloat(d.val());l>=k&&(h.slider("option","values",[k,l]),h.slider("option","max",parseFloat(l)+5),h.slider("option","min",parseFloat(k)-3))})};shopDialogProductsCategory.prototype.initShowFeatures=function(b,c,d,e,f){var g=b.type.substr(0,5);if("range"==g){var h=[],k=[],l;for(l in b.values)b.values.hasOwnProperty(l)&&(h.push(parseInt(b.values[l].begin)),k.push(parseInt(b.values[l].end)));b.values={};b.values[0]={begin:Math.min.apply(Math,h)?Math.min.apply(Math,
h):"",end:Math.max.apply(Math,k)?Math.max.apply(Math,k):""}}c.append(tmpl(d,{feature:b,default_checked:e,show_all:f}));"range"===g&&this.initRangeSlider(".js-feature-slider-"+b.code)};shopDialogProductsCategory.prototype.initGetFeatures=function(){var b=this;this.$wrapper.on("change",".js-condition-feature",function(){var c=a(this).closest("tr").find(".js-condition-feature-block");if(this.checked){var d=a(this).data("feature_id"),e="?module=category&action=getFeatures&feature_id="+d,f=a(this).attr("data-loading");
if("new"===b.category_id&&!f){var g=this;a(g).closest(".js-condition-feature-names").append('<i class="icon16 loading"></i>');a.get(e,function(h){"ok"===h.status&&(h.data.features&&b.initShowFeatures(h.data.features[d],c,"template_feature_field_values",!0,!1),a(g).attr("data-loading","ok"),a(g).closest(".js-condition-feature-names").find("i.loading").remove())})}c.show();c.find(":input").each(function(){a(this).attr("disabled",!1)})}else c.hide(),c.find(":input").each(function(){a(this).attr("disabled",
!0)})})};shopDialogProductsCategory.prototype.initFieldValidation=function(){function b(c){var d="0123456789.,-".split(""),e=[],f=!1;a.each(c.split(""),function(g,h){"-"===h?0===e.length&&e.push(h):"."===h||","===h?f||(f=!0,e.push(".")):0<=d.indexOf(h)&&e.push(h)});return e.join("")}this.$wrapper.on("input",".js-begin, .js-end",function(){var c=a(this).val();var d=b("string"===typeof c?c:""+c);d!==c&&a(this).val(d)})};shopDialogProductsCategory.prototype.renderFeature=function(b){var c=this,d=c.$wrapper,
e=!0,f="feature_id="+b,g="GET";b||(e=!1,f={ignore_id:c.ignore_id,category:c.category_id,category_type:c.category_type,get_all:!0},g="POST");a.ajax({type:g,url:"?module=categoryGetFeatures",data:f,dataType:"json",success:function(h){d.find(".js-show-more").find("i.loading").remove();if("ok"===h.status){var k=d.find(".js-condition-list .js-feature-insertion-block"),l=d.find(".js-show-more").attr("data-count"),m=0,p;for(p in h.data.features)h.data.features.hasOwnProperty(p)&&(c.initShowFeatures(h.data.features[p],
k,"template_feature_field",e,!1),++m);h=l-m;1===m&&0<h?(m="<b><i>"+c.show_all+" ("+h+")</i></b>",d.find(".js-show-more").html(m).attr("data-count",h)):d.find(".js-autocomplete-wrapper").hide()}else"fail"===h.status&&console.log(h.errors)}})};shopDialogProductsCategory.prototype.initShowAllFeatureValue=function(){var b=this;b.$wrapper.on("click",".js-show-all-feature",function(){var c=this,d=a(this).data("feature_id");a(this).html('<i class="icon16 loading"></i>');if("undefined"==typeof d)a(this).parent().find(".js-feature-hidden").show(),
a(this).hide();else{var e="?module=category&action=getFeatures&feature_id="+d,f=a(this).parent();a.get(e,function(g){if("ok"===g.status&&g.data.features){var h=g.data.features[d];f.find(".js-feature-value").each(function(){var k=parseInt(a(this).data("f_val")),l;for(l in h.values)h.values.hasOwnProperty(l)&&l==k&&delete h.values[l]});b.initShowFeatures(h,f,"template_feature_field_values",!0,!0);a(c).html("")}})}})};shopDialogProductsCategory.prototype.initShowMore=function(){var b=this,c=b.$wrapper,
d=c.find(".js-show-more").attr("data-count");b.ignore_id.length||b.$wrapper.find(".js-condition-feature").each(function(){a.isNumeric(a(this).data("feature_id"))&&b.ignore_id.push(a(this).data("feature_id"))});d-=b.ignore_id.length;if(0>=d)c.find(".js-autocomplete-wrapper").hide();else{var e="<b><i>"+this.show_all+" ("+d+")</i></b>";c.find(".js-show-more").html(e).attr("data-count",d)}c.find(".js-show-more").click(function(){a(this).html('<i class="icon16 loading"></i>');b.renderFeature()})};shopDialogProductsCategory.prototype.disableManualSorting=
function(){var b=this.$wrapper;b.find(".js-subcategory-toggle").change(function(){this.checked?b.find('.js-sort-type option[value=""]').attr("disabled",!0).next().attr("selected","selected"):b.find('.js-sort-type option[value=""]').attr("disabled",!1)})};shopDialogProductsCategory.prototype.initDynamicSettingsEvent=function(){var b=this.$wrapper;b.find("input[name=type]").on("click",function(){"0"==a(this).val()?(b.find(".js-category-dynamic-settings").hide(),b.find(".js-category-dynamic-settings").find(":input").each(function(){a(this).attr("disabled",
!0)})):(b.find(".js-category-dynamic-settings").show(),b.find(".js-category-dynamic-settings").find(":input").each(function(){a(this).hasClass("js-always-disabled")||a(this).attr("disabled",!1)}))});b.on("keyup","input[name^=rating]",function(){b.find(".js-condition-rating-interval").attr("checked",!0)});b.find(".js-category-rate").click(function(){b.find(".js-condition-rate").attr("checked",!0)});b.on("keyup","input[name^=count]",function(){b.find(".js-condition-count-interval").attr("checked",!0)});
b.find(".js-category-count-value").click(function(){b.find(".js-condition-count").attr("checked",!0)});b.on("change","input[name^=tag]",function(){b.find(".js-condition-tag").attr("checked",!0)});b.on("keyup","input[name^=price]",function(){b.find(".js-condition-price-interval").attr("checked",!0)});b.on("keyup","input[name^=compare_price]",function(){b.find(".js-condition-compare-price-interval").attr("checked",!0)});b.on("keyup","input[name^=purchase_price]",function(){b.find(".js-condition-purchase-price-interval").attr("checked",
!0)});b.on("change",".js-feature-value",function(){this.checked&&a(this).closest("tr").find(".js-condition-feature").attr("checked",!0);var c=a(this).closest("tr").find(".js-condition-feature").attr("data-feature_id"),d=parseInt(a(this).closest(".js-condition-feature-block").find("input:checkbox:checked").length);c=b.find('.js-category-filter input[data-filter-id="'+c+'"]');c.length&&(2<=d?c.is(":disabled")&&c.attr("disabled",!1):c.attr("disabled",!0))})};shopDialogProductsCategory.prototype.initFrontendUrlEdit=
function(){a("#s-settings-frontend-url").inlineEditable({editLink:".js-settings-frontend-url-edit-link",editOnItself:!1,minSize:{width:100},makeReadableBy:[],beforeMakeEditable:function(e){var f=a(this).parents("div:first"),g=f.find("span.slash");a(e).after(g);f.find("span.s-frontend-base-url").html(f.find("a.s-frontend-base-url").hide().contents()).show()},beforeBackReadable:function(e,f){e=a(this);f=e.parents("div:first");var g=f.find("span.slash");e.after(g);f.find("a.s-frontend-base-url").html(f.find("span.s-frontend-base-url").hide().contents()).show()}});
var b=this.$wrapper.find(".js-product-list-name"),c=this.$wrapper.find(".js-product-list-url"),d={name:"",url:"",timer_id:null};b.unbind(".create_product_list").bind("change.create_product_list, keyup.create_product_list",function(){d.time_id&&clearTimeout(d.time_id);if(c.val()!==d.url)b.unbind(".create_product_list");else{var e=b.val();e!==d.name&&(d.time_id=setTimeout(function(){a.getJSON("?action=transliterate",{str:e},function(f){"ok"===f.status?(c.val(f.data),d={name:e,url:f.data,time_id:null}):
console&&(f.errors?console.error(f.errors):f&&console.error(f))})},300))}})};shopDialogProductsCategory.prototype.initMetaTagEdit=function(){var b=this.$wrapper,c=this.account_name;(function(){var d=a("input[name=meta_title]",b);a.shop.changeListener(a("input[name=name]",b),function(e){d.attr("placeholder",e.val())})})();(function(){var d=a("[name=meta_keywords]",b);a.shop.changeListener(a("input[name=name]",b),function(e){d.attr("placeholder",[c,e.val()].join(", "))})})();a.shop.makeFlexibleInput("s-meta-title")};
shopDialogProductsCategory.prototype.initSocialMetaTag=function(){var b=this.$wrapper.find(".js-category-social-metatag"),c=b.closest(".field-group"),d=c.find(".editable-og-disabler");b.closest(".field").appendTo(c.closest("form").find('[name="meta_title"]').closest(".field-group"));b.prop("checked")||c.show();b.change(function(){b.prop("checked")?(c.slideUp(200),d.prop("disabled",!1)):(c.slideDown(200),d.prop("disabled",!0))})};shopDialogProductsCategory.prototype.initFilter=function(){function b(){var e=
!(1<c.find(".js-filter-item .js-filter-checkbox:checked").length);c.find(".js-filter-item").each(function(){var f=a(this),g=f.find(".js-filter-checkbox"),h=f.find("i.sort");!e&&g.is(":checked")?f.hasClass("unsortable")&&(f.removeClass("unsortable"),h.show()):f.hasClass("unsortable")||(f.addClass("unsortable"),h.hide())});d.sortable("refresh")}var c=this.$wrapper,d=c.find(".js-category-filter");c.on("click",".js-category-allow-filter",function(){this.checked?(d.find(":input").each(function(){a(this).data("disabled")||
a(this).attr("disabled",!1)}),d.show()):(d.find(":input").each(function(){a(this).attr("disabled",!0)}),d.hide())});d.sortable({distance:5,opacity:.75,items:"li:not(.unsortable)",handle:".sort",cursor:"move",tolerance:"pointer"});c.on("change",".js-filter-checkbox",function(){b()});b()};shopDialogProductsCategory.prototype.initCategoryVisibility=function(){var b=this.$wrapper.find(".js-product-category-visibility-block");a("input[name=storefront]",b).change(function(){"route"==this.value?a('input[name="routes[]"]',
b).attr("disabled",!1):a('input[name="routes[]"]',b).attr("disabled",!0)})};shopDialogProductsCategory.staticDialog=function(b,c,d){var e=function(){a("#s-product-category-dialog").waDialog({esc:!1,disableButtonsOnSubmit:!1,onLoad:function(){a("#s-category-description-content").length&&a.product_sidebar.initCategoryDescriptionWysiwyg(a(this));setTimeout(function(){a(".js-product-list-name").focus()},150)},onSubmit:function(g){var h=a(this);if(function(){var m=!1;h.find(".js-condition-feature:checked, .js-condition-tag:checked").each(function(){var p=
a(this).closest("tr").find(".js-condition-feature-block, .js-condition-tag-block"),n=p.find(".js-feature-value:checkbox, .js-tag-value:checkbox");n.length&&!n.is(":checked")&&(m=!0,p.find(".errormsg").html("").html($_("Nothing selected")),h.find(".js-category-error").html("").html($_("Nothing selected")))});setTimeout(function(){h.find(".errormsg").html("")},5E3);return m}())return!1;var k=function(m){if(0<location.hash.indexOf("category_id")){var p=location.hash.replace("category_id="+b,"category_id="+
m.data.id);if("sort_products"in m.data||"rule"in m.data)p=p.replace(/&sort=[^&]*/,"&sort="),p=p.replace(/&order=[^&]*/,"&order=")}else p="#/products/category_id="+m.data.id;"new"===d&&a.product_sidebar.createNewElementInList(m.data,"category");a.product_sidebar.updateItemInCategoryList(m,p);location.hash!=p?location.hash=p:a.products.dispatch();g.trigger("close")},l=function(m){if(m&&m.errors){m=m.errors;for(var p in m)g.find("input[name="+p+"]").addClass("error").parent().find(".errormsg").text(m[p]);
return!1}};a("#s-category-description-content").length&&a("#s-category-description-content").waEditor("sync");if(h.find("input:file").length)a.products._iframePost(h,k,l);else return a.shop.jsonPost(h.attr("action"),h.serialize(),k,l),!1}})},f=a("#s-product-category-dialog");f=f.length?f.parent():a("<div></div>").appendTo("body");"new"===d&&f.load("?module=category&action=Create&parent_id="+c,e);"edit"===d&&f.load("?module=category&action=Edit&category_id="+b,e)};return shopDialogProductsCategory}(jQuery);
//# sourceMappingURL=product.min.js.map