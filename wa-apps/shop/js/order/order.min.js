var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(b){return b.raw=b};$jscomp.createTemplateTagFirstArgWithRaw=function(b,a){b.raw=a;return b};$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};
$jscomp.arrayFromIterator=function(b){for(var a,c=[];!(a=b.next()).done;)c.push(a.value);return c};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var e=b.length,d=0;d<e;d++){var g=b[d];if(a.call(c,g,d,b))return{i:d,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){if(b==Array.prototype||b==Object.prototype)return b;b[a]=c.value;return b};
$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<b.length;++a){var c=b[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,a){var c=$jscomp.propertyToPolyfillSymbol[a];if(null==c)return b[a];c=b[c];return void 0!==c?c:b[a]};$jscomp.polyfill=function(b,a,c,e){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,a,c,e):$jscomp.polyfillUnisolated(b,a,c,e))};
$jscomp.polyfillUnisolated=function(b,a,c,e){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];if(!(d in c))return;c=c[d]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(b,a,c,e){var d=b.split(".");b=1===d.length;e=d[0];e=!b&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<d.length-1;g++){var m=d[g];if(!(m in e))return;e=e[m]}d=d[d.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?e[d]:null;a=a(c);null!=a&&(b?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:a}):a!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+c+"$"+d),$jscomp.defineProperty(e,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.polyfill("Object.is",function(b){return b?b:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(a,c){var e=this;e instanceof String&&(e=String(e));var d=e.length;c=c||0;for(0>c&&(c=Math.max(c+d,0));c<d;c++){var g=e[c];if(g===a||Object.is(g,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(b,a,c){if(null==b)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return b+""};$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(a,c){var e=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var d=e.length,g=a.length;c=Math.max(0,Math.min(c|0,e.length));for(var m=0;m<g&&c<d;)if(e[c++]!=a[m++])return!1;return m>=g}},"es6","es3");$jscomp.polyfill("Array.prototype.findIndex",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6","es3");
$jscomp.polyfill("Array.from",function(b){return b?b:function(a,c,e){c=null!=c?c:function(h){return h};var d=[],g="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof g){a=g.call(a);for(var m=0;!(g=a.next()).done;)d.push(c.call(e,g.value,m++))}else for(g=a.length,m=0;m<g;m++)d.push(c.call(e,a[m],m));return d}},"es6","es3");
(function(b){function a(u){return b.data(u,"tooltip")}function c(u){a(this).delay?r=setTimeout(d,a(this).delay):d();q=!!a(this).track;b(document.body).bind("mousemove",g);g(u)}function e(){if(!b.tooltip.blocked&&this!=k&&(this.tooltipText||a(this).bodyHandler)){k=this;p=this.tooltipText;if(a(this).bodyHandler){h.title.hide();var u=a(this).bodyHandler.call(this);u.nodeType||u.jquery?h.body.empty().append(u):h.body.html(u);h.body.show()}else if(a(this).showBody){u=p.split(a(this).showBody);h.title.html(u.shift()).show();
h.body.empty();for(var v=0,w;w=u[v];v++)0<v&&h.body.append("<br/>"),h.body.append(w);h.body.hideWhenEmpty()}else h.title.html(p).show(),h.body.hide();a(this).showURL&&b(this).url()?h.url.html(b(this).url().replace("http://","")).show():h.url.hide();h.parent.addClass(a(this).extraClass);a(this).fixPNG&&h.parent.fixPNG();c.apply(this,arguments)}}function d(){r=null;y&&b.fn.bgiframe||!a(k).fade?h.parent.show():h.parent.is(":animated")?h.parent.stop().show().fadeTo(a(k).fade,k.tOpacity):h.parent.is(":visible")?
h.parent.fadeTo(a(k).fade,k.tOpacity):h.parent.fadeIn(a(k).fade);g()}function g(u){if(!(b.tooltip.blocked||u&&"OPTION"==u.target.tagName))if(!q&&h.parent.is(":visible")&&b(document.body).unbind("mousemove",g),null==k)b(document.body).unbind("mousemove",g);else{h.parent.removeClass("viewport-right").removeClass("viewport-bottom");var v=h.parent[0].offsetLeft,w=h.parent[0].offsetTop;u&&(v=u.pageX+a(k).left,w=u.pageY+a(k).top,u="auto",a(k).positionLeft&&(u=b(window).width()-v,v="auto"),h.parent.css({left:v,
right:u,top:w}));u=b(window).scrollLeft();var B=b(window).scrollTop(),G=b(window).width(),D=b(window).height(),z=h.parent[0];u+G<z.offsetLeft+z.offsetWidth&&(v-=z.offsetWidth+20+a(k).left,h.parent.css({left:v+"px"}).addClass("viewport-right"));B+D<z.offsetTop+z.offsetHeight&&(w-=z.offsetHeight+20+a(k).top,h.parent.css({top:w+"px"}).addClass("viewport-bottom"))}}function m(u){function v(){h.parent.removeClass(w.extraClass).hide().css("opacity","")}if(!b.tooltip.blocked){r&&clearTimeout(r);k=null;var w=
a(this);y&&b.fn.bgiframe||!w.fade?v():h.parent.is(":animated")?h.parent.stop().fadeTo(w.fade,0,v):h.parent.stop().fadeOut(w.fade,v);a(this).fixPNG&&h.parent.unfixPNG()}}var h={},k,p,r,y=b.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),q=!1;b.tooltip={blocked:!1,defaults:{delay:200,fade:!1,showURL:!0,extraClass:"",noHideOnClick:!1,top:15,left:15,id:"tooltip"},block:function(){b.tooltip.blocked=!b.tooltip.blocked}};b.fn.extend({tooltip:function(u){u=b.extend({},b.tooltip.defaults,u);h.parent||
(h.parent=b('<div id="'+u.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide(),b.fn.bgiframe&&h.parent.bgiframe(),h.title=b("h3",h.parent),h.body=b("div.body",h.parent),h.url=b("div.url",h.parent));var v=this.each(function(){b.data(this,"tooltip",u);this.tOpacity=h.parent.css("opacity");this.tooltipText=this.title;b(this).removeAttr("title");this.alt=""}).mouseover(e).mouseout(m);u.noHideOnClick||v.click(m);return v},fixPNG:y?function(){return this.each(function(){var u=
b(this).css("backgroundImage");u.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(u=RegExp.$1,b(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+u+"')"}).each(function(){var v=b(this).css("position");"absolute"!=v&&"relative"!=v&&b(this).css("position","relative")}))})}:function(){return this},unfixPNG:y?function(){return this.each(function(){b(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){b(this)[b(this).html()?
"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(jQuery);/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
!function(b){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?b(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],b):b(jQuery)}(function(b){function a(f){f=f[0];return 0<f.offsetWidth&&0<f.offsetHeight}function c(f){if(f.minTime&&(f.minTime=z(f.minTime)),f.maxTime&&(f.maxTime=z(f.maxTime)),f.durationTime&&"function"!=typeof f.durationTime&&(f.durationTime=z(f.durationTime)),"now"==f.scrollDefault)f.scrollDefault=function(){return f.roundingFunction(z(new Date),
f)};else if(f.scrollDefault&&"function"!=typeof f.scrollDefault){var l=f.scrollDefault;f.scrollDefault=function(){return f.roundingFunction(z(l),f)}}else f.minTime&&(f.scrollDefault=function(){return f.roundingFunction(f.minTime,f)});if("string"===b.type(f.timeFormat)&&f.timeFormat.match(/[gh]/)&&(f._twelveHourTime=!0),!1===f.showOnFocus&&-1!=f.showOn.indexOf("focus")&&f.showOn.splice(f.showOn.indexOf("focus"),1),0<f.disableTimeRanges.length){for(var n in f.disableTimeRanges)f.disableTimeRanges[n]=
[z(f.disableTimeRanges[n][0]),z(f.disableTimeRanges[n][1])];f.disableTimeRanges=f.disableTimeRanges.sort(function(t,x){return t[0]-x[0]});for(n=f.disableTimeRanges.length-1;0<n;n--)f.disableTimeRanges[n][0]<=f.disableTimeRanges[n-1][1]&&(f.disableTimeRanges[n-1]=[Math.min(f.disableTimeRanges[n][0],f.disableTimeRanges[n-1][0]),Math.max(f.disableTimeRanges[n][1],f.disableTimeRanges[n-1][1])],f.disableTimeRanges.splice(n,1))}return f}function e(f){var l=f.data("timepicker-settings"),n=f.data("timepicker-list");
if(n&&n.length&&(n.remove(),f.data("timepicker-list",!1)),l.useSelect)var t=n=b("<select />",{"class":"ui-timepicker-select"});else n=b("<ul />",{"class":"ui-timepicker-list"}),t=b("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),t.css({display:"none",position:"absolute"}).append(n);if(l.noneOption)if(!0===l.noneOption&&(l.noneOption=l.useSelect?"Time...":"None"),b.isArray(l.noneOption))for(var x in l.noneOption){if(parseInt(x,10)==x){var C=d(l.noneOption[x],l.useSelect);n.append(C)}}else C=
d(l.noneOption,l.useSelect),n.append(C);(l.className&&t.addClass(l.className),null===l.minTime&&null===l.durationTime||!l.showDuration)||("function"==typeof l.step?"function":l.step,t.addClass("ui-timepicker-with-duration"),t.addClass("ui-timepicker-step-"+l.step));C=l.minTime;"function"==typeof l.durationTime?C=z(l.durationTime()):null!==l.durationTime&&(C=l.durationTime);x=null!==l.minTime?l.minTime:0;var H=null!==l.maxTime?l.maxTime:x+F-1;x>H&&(H+=F);H===F-1&&"string"===b.type(l.timeFormat)&&l.show2400&&
(H=F);var L=l.disableTimeRanges,I=0,Q=L.length,N=l.step;"function"!=typeof N&&(N=function(){return l.step});for(var O=0;H>=x;O++,x+=60*N(O)){var K=x,M=D(K,l);if(l.useSelect)var J=b("<option />",{value:M});else J=b("<li />"),J.addClass(43200>K%86400?"ui-timepicker-am":"ui-timepicker-pm"),J.data("time",86400>=K?K:K%86400);J.text(M);if((null!==l.minTime||null!==l.durationTime)&&l.showDuration)if(M=G(x-C,l.step),l.useSelect)J.text(J.text()+" ("+M+")");else{var P=b("<span />",{"class":"ui-timepicker-duration"});
P.text(" ("+M+")");J.append(P)}Q>I&&(K>=L[I][1]&&(I+=1),L[I]&&K>=L[I][0]&&K<L[I][1]&&(l.useSelect?J.prop("disabled",!0):J.addClass("ui-timepicker-disabled")));n.append(J)}(t.data("timepicker-input",f),f.data("timepicker-list",t),l.useSelect)?(f.val()&&n.val(g(z(f.val()),l)),n.on("focus",function(){b(this).data("timepicker-input").trigger("showTimepicker")}),n.on("blur",function(){b(this).data("timepicker-input").trigger("hideTimepicker")}),n.on("change",function(){q(f,b(this).val(),"select")}),q(f,
n.val(),"initial"),f.hide().after(n)):(x=l.appendTo,"string"==typeof x?x=b(x):"function"==typeof x&&(x=x(f)),x.append(t),p(f,n),n.on("mousedown click","li",function(R){f.off("focus.timepicker");f.on("focus.timepicker-ie-hack",function(){f.off("focus.timepicker-ie-hack");f.on("focus.timepicker",A.show)});h(f)||f[0].focus();n.find("li").removeClass("ui-timepicker-selected");b(this).addClass("ui-timepicker-selected");B(f)&&(f.trigger("hideTimepicker"),n.on("mouseup.timepicker click.timepicker","li",
function(S){n.off("mouseup.timepicker click.timepicker");t.hide()}))}))}function d(f,l){var n,t,x;return"object"==typeof f?(n=f.label,t=f.className,x=f.value):"string"==typeof f?n=f:b.error("Invalid noneOption value"),l?b("<option />",{value:x,"class":t,text:n}):b("<li />",{"class":t,text:n}).data("time",String(x))}function g(f,l){return f=l.roundingFunction(f,l),null!==f?D(f,l):void 0}function m(f){f.target!=window&&(f=b(f.target),f.closest(".ui-timepicker-input").length||f.closest(".ui-timepicker-wrapper").length||
(A.hide(),b(document).unbind(".ui-timepicker"),b(window).unbind(".ui-timepicker")))}function h(f){f=f.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&f.disableTouchKeyboard}function k(f,l,n){if(!n&&0!==n)return!1;f=f.data("timepicker-settings");var t=!1;n=f.roundingFunction(n,f);return l.find("li").each(function(x,C){x=b(C);if("number"==typeof x.data("time"))return x.data("time")==n?(t=x,!1):void 0}),t}function p(f,l){l.find("li").removeClass("ui-timepicker-selected");
var n=z(y(f),f.data("timepicker-settings"));null!==n&&(f=k(f,l,n))&&(n=f.offset().top-l.offset().top,(n+f.outerHeight()>l.outerHeight()||0>n)&&l.scrollTop(l.scrollTop()+f.position().top-f.outerHeight()),f.addClass("ui-timepicker-selected"))}function r(f,l){if(""!==this.value&&"timepicker"!=l){var n=b(this);if(!n.is(":focus")||f&&"change"==f.type){f=n.data("timepicker-settings");var t=z(this.value,f);if(null===t)return void n.trigger("timeFormatError");var x=!1;if(null!==f.minTime&&null!==f.maxTime&&
(t<f.minTime||t>f.maxTime)&&(x=!0),b.each(f.disableTimeRanges,function(){return t>=this[0]&&t<this[1]?(x=!0,!1):void 0}),f.forceRoundTime){var C=f.roundingFunction(t,f);C!=t&&(t=C,l=null)}f=D(t,f);x?q(n,f,"error")&&n.trigger("timeRangeError"):q(n,f,l)}}}function y(f){return f.is("input")?f.val():f.data("ui-timepicker-value")}function q(f,l,n){if(f.is("input")){f.val(l);var t=f.data("timepicker-settings");t.useSelect&&"select"!=n&&"initial"!=n&&f.data("timepicker-list").val(g(z(l),t))}return f.data("ui-timepicker-value")!=
l?(f.data("ui-timepicker-value",l),"select"==n?f.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(n)&&f.trigger("changeTime"),!0):(f.trigger("selectTime"),!1)}function u(f){switch(f.keyCode){case 13:case 9:break;default:f.preventDefault()}}function v(f){var l=b(this),n=l.data("timepicker-list");if(!n||!a(n)){if(40!=f.keyCode)return!0;A.show.call(l.get(0));n=l.data("timepicker-list");h(l)||l.focus()}switch(f.keyCode){case 13:return B(l)&&(r.call(l.get(0),
{type:"change"}),A.hide.apply(this)),f.preventDefault(),!1;case 38:var t=n.find(".ui-timepicker-selected");return t.length?t.is(":first-child")||(t.removeClass("ui-timepicker-selected"),t.prev().addClass("ui-timepicker-selected"),t.prev().position().top<t.outerHeight()&&n.scrollTop(n.scrollTop()-t.outerHeight())):(n.find("li").each(function(x,C){return 0<b(C).position().top?(t=b(C),!1):void 0}),t.addClass("ui-timepicker-selected")),!1;case 40:return t=n.find(".ui-timepicker-selected"),0===t.length?
(n.find("li").each(function(x,C){return 0<b(C).position().top?(t=b(C),!1):void 0}),t.addClass("ui-timepicker-selected")):t.is(":last-child")||(t.removeClass("ui-timepicker-selected"),t.next().addClass("ui-timepicker-selected"),t.next().position().top+2*t.outerHeight()>n.outerHeight()&&n.scrollTop(n.scrollTop()+t.outerHeight())),!1;case 27:n.find("li").removeClass("ui-timepicker-selected");A.hide();break;case 9:A.hide();break;default:return!0}}function w(f){var l=b(this),n=l.data("timepicker-list"),
t=l.data("timepicker-settings");if(!n||!a(n)||t.disableTextInput)return!0;switch(f.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:t.typeaheadHighlight?p(l,n):n.hide()}}function B(f){var l=f.data("timepicker-settings"),n=null,t=f.data("timepicker-list").find(".ui-timepicker-selected");return t.hasClass("ui-timepicker-disabled")?
!1:(t.length&&(n=t.data("time")),null!==n&&("string"!=typeof n&&(n=D(n,l)),q(f,n,"select")),!0)}function G(f,l){f=Math.abs(f);var n,t;f=Math.round(f/60);var x=[];return 60>f?x=[f,E.mins]:(n=Math.floor(f/60),t=f%60,30==l&&30==t&&(n+=E.decimal+5),x.push(n),x.push(1==n?E.hr:E.hrs),30!=l&&t&&(x.push(t),x.push(E.mins))),x.join(" ")}function D(f,l){if("number"!=typeof f)return null;var n=parseInt(f%60),t=parseInt(f/60%60),x=parseInt(f/3600%24);x=new Date(1970,0,2,x,t,n,0);if(isNaN(x.getTime()))return null;
if("function"===b.type(l.timeFormat))return l.timeFormat(x);for(var C="",H=0;H<l.timeFormat.length;H++)switch(n=l.timeFormat.charAt(H)){case "a":C+=11<x.getHours()?E.pm:E.am;break;case "A":C+=11<x.getHours()?E.PM:E.AM;break;case "g":n=x.getHours()%12;C+=0===n?"12":n;break;case "G":n=x.getHours();f===F&&(n=l.show2400?24:0);C+=n;break;case "h":n=x.getHours()%12;0!==n&&10>n&&(n="0"+n);C+=0===n?"12":n;break;case "H":n=x.getHours();f===F&&(n=l.show2400?24:0);C+=9<n?n:"0"+n;break;case "i":t=x.getMinutes();
C+=9<t?t:"0"+t;break;case "s":n=x.getSeconds();C+=9<n?n:"0"+n;break;case "\\":H++;C+=l.timeFormat.charAt(H);break;default:C+=n}return C}function z(f,l){if(""===f||null===f)return null;if("object"==typeof f)return 3600*f.getHours()+60*f.getMinutes()+f.getSeconds();if("string"!=typeof f)return f;f=f.toLowerCase().replace(/[\s\.]/g,"");"a"!=f.slice(-1)&&"p"!=f.slice(-1)||(f+="m");var n="("+E.am.replace(".","")+"|"+E.pm.replace(".","")+"|"+E.AM.replace(".","")+"|"+E.PM.replace(".","")+")?",t=f.match(new RegExp("^"+
n+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+n+"$"));if(!t)return null;f=parseInt(1*t[2],10);if(24<f){if(l&&!1===l.wrapHours)return null;f%=24}n=t[1]||t[5];var x=f;12>=f&&n&&(x=n==E.pm||n==E.PM,x=12==f?x?12:0:f+(x?12:0));t=3600*x+60*(1*t[3]||0)+(1*t[4]||0);12>f&&!n&&l&&l._twelveHourTime&&l.scrollDefault&&(l=t-l.scrollDefault(),0>l&&l>=F/-2&&(t=(t+F/2)%F));return t}var F=86400,E={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},A={init:function(f){return this.each(function(){var l=
b(this),n=[],t;for(t in b.fn.timepicker.defaults)l.data(t)&&(n[t]=l.data(t));n=b.extend({},b.fn.timepicker.defaults,n,f);if(n.lang&&(E=b.extend(E,n.lang)),n=c(n),l.data("timepicker-settings",n),l.addClass("ui-timepicker-input"),n.useSelect)e(l);else{if(l.prop("autocomplete","off"),n.showOn)for(var x in n.showOn)l.on(n.showOn[x]+".timepicker",A.show);l.on("change.timepicker",r);l.on("keydown.timepicker",v);l.on("keyup.timepicker",w);n.disableTextInput&&l.on("keydown.timepicker",u);r.call(l.get(0),
null,"initial")}})},show:function(f){var l=b(this),n=l.data("timepicker-settings");if(f&&f.preventDefault(),n.useSelect)return void l.data("timepicker-list").focus();h(l)&&l.blur();f=l.data("timepicker-list");if(!l.prop("readonly")&&(f&&0!==f.length&&"function"!=typeof n.durationTime||(e(l),f=l.data("timepicker-list")),!a(f))){l.data("ui-timepicker-value",l.val());p(l,f);A.hide();f.show();var t={};n.orientation.match(/r/)?t.left=l.offset().left+l.outerWidth()-f.outerWidth()+parseInt(f.css("marginLeft").replace("px",
""),10):t.left=l.offset().left+parseInt(f.css("marginLeft").replace("px",""),10);"t"==(n.orientation.match(/t/)?"t":n.orientation.match(/b/)?"b":l.offset().top+l.outerHeight(!0)+f.outerHeight()>b(window).height()+b(window).scrollTop()?"t":"b")?(f.addClass("ui-timepicker-positioned-top"),t.top=l.offset().top-f.outerHeight()+parseInt(f.css("marginTop").replace("px",""),10)):(f.removeClass("ui-timepicker-positioned-top"),t.top=l.offset().top+l.outerHeight()+parseInt(f.css("marginTop").replace("px",""),
10));f.offset(t);t=f.find(".ui-timepicker-selected");if(!t.length){var x=z(y(l));null!==x?t=k(l,f,x):n.scrollDefault&&(t=k(l,f,n.scrollDefault()))}t&&t.length?(t=f.scrollTop()+t.position().top-t.outerHeight(),f.scrollTop(t)):f.scrollTop(0);return n.stopScrollPropagation&&b(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(C){C.preventDefault();var H=b(this).scrollTop();b(this).scrollTop(H+C.originalEvent.deltaY)}),b(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
m),b(window).on("resize.ui-timepicker",m),n.closeOnWindowScroll&&b(document).on("scroll.ui-timepicker",m),l.trigger("showTimepicker"),this}},hide:function(f){f=b(this);var l=f.data("timepicker-settings");return l&&l.useSelect&&f.blur(),b(".ui-timepicker-wrapper").each(function(){var n=b(this);if(a(n)){var t=n.data("timepicker-input"),x=t.data("timepicker-settings");x&&x.selectOnBlur&&B(t);n.hide();t.trigger("hideTimepicker")}}),this},option:function(f,l){return"string"==typeof f&&"undefined"==typeof l?
b(this).data("timepicker-settings")[f]:this.each(function(){var n=b(this),t=n.data("timepicker-settings"),x=n.data("timepicker-list");"object"==typeof f?t=b.extend(t,f):"string"==typeof f&&(t[f]=l);t=c(t);n.data("timepicker-settings",t);x&&(x.remove(),n.data("timepicker-list",!1));t.useSelect&&e(n)})},getSecondsFromMidnight:function(){return z(y(this))},getTime:function(f){var l=y(this);if(!l)return null;l=z(l);if(null===l)return null;f||(f=new Date);f=new Date(f);return f.setHours(l/3600),f.setMinutes(l%
3600/60),f.setSeconds(l%60),f.setMilliseconds(0),f},isVisible:function(){var f=this.data("timepicker-list");return!(!f||!a(f))},setTime:function(f){var l=this.data("timepicker-settings"),n=l.forceRoundTime?g(z(f),l):D(z(f),l);return f&&null===n&&l.noneOption&&(n=f),q(this,n),this.data("timepicker-list")&&p(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var f=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),f.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};b.fn.timepicker=function(f){return this.length?A[f]?this.hasClass("ui-timepicker-input")?A[f].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof f&&f?void b.error("Method "+f+" does not exist on jQuery.timepicker"):A.init.apply(this,arguments):this};b.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(f,l){if(null===f)return null;if("number"!=typeof l.step)return f;var n=f%(60*l.step);return n>=30*l.step?f+=60*l.step-n:f-=n,f==F&&l.show2400?f:f%F},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(b){var a=function(c,e,d){var g=/[^\w\-\.:]/.test(c)?new Function(a.arg+",tmpl","var _e=tmpl.encode"+a.helper+",_s='"+c.replace(a.regexp,a.func)+"';return _s;"):d?a.cache[c]=a(a.load(c)):a.cache[c]=a.cache[c]||a(a.load(c));return e?g(e,a):function(m){return g(m,a)}};a.cache={};a.load=function(c){var e=document.getElementById(c),d=/<\\\/(\w+)/g;if(!e&&console)throw{message:"template with id="+c+" not found"};return e?("textarea"==e.tagName.toLowerCase()?e.value:document.getElementById(c).innerHTML).replace(d,
"</$1"):null};a.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;a.func=function(c,e,d,g,m,h){if(e)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[c]||"\\"+c;if(d)return"="===d?"'+_e("+g+")+'":"'+("+g+"||'')+'";if(m)return"';";if(h)return"_s+='"};a.encReg=/[<>&"'\x00]/g;a.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};a.encode=function(c){return String(c||"").replace(a.encReg,function(e){return a.encMap[e]||""})};a.arg="o";a.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return a}):b.tmpl=a})(this);(function(b){b.fn.lazyLoad=function(a,c){function e(){if(d.stopped)this.onscroll=null;else if(!d.stopped&&!d.loading&&h(m,g)<=d.distance){if(null!==d.hash){var k=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===d.hash.indexOf(k)){this.onscroll=null;return}}d.load()}}if("stop"==a){var d=this.data("lazyLoadSettings");d&&(d.stopped=!0)}else if("reload"==a){if(d=this.data("lazyLoadSettings"))d.stopped=!1,d.loading=!1,this.get(0).onscroll=null,this.lazyLoad(d)}else if("sleep"==a){if(d=this.data("lazyLoadSettings"))d.loading=
!0}else if("wake"==a){if(d=this.data("lazyLoadSettings"))d.loading=!1}else if("force"==a)(d=this.data("lazyLoadSettings"))&&(d.loading||d.load());else{if("get"===a)return d=this.data("lazyLoadSettings")||{},d[c];this.data("lazyLoadSettings",b.extend({distance:50,load:function(){},container:m,state:"wake",hash:location.hash.replace(/^[^#]*#\/*/,"").split("/")[0]||null,distanceBetweenBottoms:null},a||{}));d=this.data("lazyLoadSettings");d.loading=!1;d.stopped=!1;var g=b(window),m=d.container||b(this);
null===d.hash||b.isArray(d.hash)||(d.hash=[d.hash]);b.fn.lazyLoad.call(g,d.state);(function(){var k,p=setTimeout(k=function(){if(d.stopped)clearTimeout(p);else{if(null!==d.hash){var r=location.hash.replace(/^[^#]*#\/*/,"").split("/")[0];if(-1===d.hash.indexOf(r)){clearTimeout(p);return}}d.loading?p=setTimeout(k,350):(h(m,g),h(m,g)<=d.distance?(d.load(),p=setTimeout(k,350)):(g.get(0).onscroll=e,clearTimeout(p)))}},350)})();var h="function"===typeof d.distanceBetweenBottoms?d.distanceBetweenBottoms:
function(k,p,r){k="string"===typeof k?b(k):k;r=r||0;return k.position().top+k.outerHeight()-r-(p.scrollTop()+p.height())}}}})(jQuery);(function(b){b.storage=new b.store;b.orders={$wrapper:null,pre_search_hash:null,search_item_param:null,options:{view:"table"},init:function(a){var c=this,e=this;e.options=a;e.$wrapper=b("#s-content");"undefined"!=typeof b.History&&b.History.bind(function(){e.dispatch()});b.ajaxPrefilter(function(d,g,m){m.originalRequestOptions=g});b.wa.errorHandler=function(d){var g=d.originalRequestOptions||{};if(403===d.status||404===d.status){d=b(d.responseText);d=d.find(".dialog-content").length?b('<div class="box contentbox"></div>').append(d.find(".dialog-content")):
b('<div class="box contentbox"></div>').append(d.find(":not(style)"));var m="content";g=g.url||"";if(0<g.length){var h=g.indexOf("?");-1!==h&&(g=g.substr(h+1),g=b.shop.helper.parseParams(g)||{},"order"===g.module&&"table"!==g.view&&b("#s-order").length&&(m="order"))}"order"===m?b("#s-order").empty().append(d):(b("#s-content").empty().append(d),b.order_list&&b.order_list.finit());return!1}return!0};(a=window.location.hash)&&"#/orders/"!==a||(a="/orders/"+this.getFiltersHashStorage());"#/"!==a&&a?b.wa.setHash(a):
this.dispatch();this.initEventsVisibilityFilters();this.initDropdown();b(document).bind("wa.appcount",function(d,g){g=g||{};d=parseInt(g.shop,10);(g=document.title.match(/\(\d+\) /))?document.title=document.title.replace(g[0],d?"("+d+") ":""):d&&(document.title="("+d+") "+document.title)});b(function(){b("#maincontent").on("click",".s-alert-close",function(d){d.preventDefault();d=b.storage.get("shop/alerts");var g=b(this).parent();d||(d=[]);d.push(g.data("alert"));d=d.filter(function(m,h,k){return null!=
m&&h==k.indexOf(m)});b.storage.set("shop/alerts",d);g.remove()})});this.checkAlerts();this.ordersNavDetach();this.initWaLoading();this.$wrapper.on("wa_init_orders_nav_before",function(d,g){["orders/all","orders/state_id=new|processing|auth|paid"].includes(c.hash)&&c.setFiltersHashStorage(c.hash)});this.$wrapper.on("wa_init_orders_nav_after",function(d,g){c.initSearch(g.filter_params_extended);c.hasFiltersInUrl()&&"split"===g.view&&c.visibilityFilters(!0)})},initEventsVisibilityFilters:function(){var a=
this;b(document).on("click",".js-orders-show-filters",function(){a.visibilityFilters(!0);a.clearFilters()});b(document).on("click",".js-orders-hide-filters",function(){a.visibilityFilters(!1);a.clearFilters()})},initSearch:function(a){var c=this,e=b("#s-orders-search"),d=[],g=null,m=function(q){c.pre_search_hash||(c.pre_search_hash=window.location.hash,b.order_list.options&&"split"===b.order_list.options.view&&c.clearFilters());switch(q.autocomplete_item_type){case "order":c.search_item_param=null;
b.wa.setHash("#/order/"+q.id+"/");e.val(q.value);break;case "contact":c.search_item_param="contact_id="+q.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");e.val(q.value);break;case "product":c.search_item_param="product_id="+q.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");e.val(q.value);break;case "coupon":c.search_item_param="coupon_id="+q.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "tracking_number":c.search_item_param="tracking_number="+q.value;b.wa.setHash("#/orders/"+
c.search_item_param+"/");break;case "shipping":c.search_item_param="shipping_id="+q.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "payment":c.search_item_param="payment_id="+q.id;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "city":c.search_item_param="city="+q.value;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "region":c.search_item_param="region="+((q.value||"").split(":")[1]||"");b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "country":c.search_item_param=
"country="+q.value;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;case "item_code":c.search_item_param="item_code="+q.value;b.wa.setHash("#/orders/"+c.search_item_param+"/");break;default:c.pre_search_hash=null}};e.unbind("keydown").bind("keydown",function(q){if(13==q.keyCode||10==q.keyCode){if(g)return!1;var u=b(this);if(!b(this).val())return location.hash="#/orders/all/",u.autocomplete("close"),!1;if(d&&b.isArray(d)&&d.length)return m(d[0]),setTimeout(function(){u.autocomplete("close")},
150),!1}});e.autocomplete({minLength:1,delay:300,html:!0,select:function(q,u){m(u.item);return!1},source:function(q,u){g&&g.abort();b.orders.waLoadingBeforeLoad();g=b.getJSON("?action=autocomplete&type=order",q,function(v){d=v;u(v);b.orders.waLoadingLoaded()}).always(function(){g=null})}});var h=b(".js-orders-search"),k=function(){h.hasClass("js-orders-search-split-and-mobile")?b(".js-orders-search-show").removeClass("hidden"):b(".js-orders-search-show").addClass("hidden")},p=function(){b(".js-orders-search-show").removeClass("hidden");
h.removeClass("show");h.removeClass("hide");h.addClass("hidden")};if(a&&"object"===typeof a)if(Array.isArray(a))e.val(""),p();else{var r=c.pre_search_hash||window.location.hash,y;for(y in a){a=a[y];c.search_item_param=y+"="+a.id;c.pre_search_hash=r.replace("/"+c.search_item_param,"");k();e.val(a.name);h.addClass("show").removeClass("hidden");break}}b(document).on("click",".js-orders-search-show",function(q){q.preventDefault();k();h.removeClass("hidden");setTimeout(function(){h.addClass("show");e.focus()},
5)});b(document).on("click",".js-orders-search-hide",function(q){q.preventDefault();if(!h.hasClass("show"))return!1;h.addClass("hide");e.val("");setTimeout(function(){return p()},180);c.pre_search_hash&&c.search_item_param&&(q=c.pre_search_hash,b.order_list.options.view&&q.includes("view=")&&(q=q.replace(/view=(split|table|kanban)/,"view="+b.order_list.options.view)),q.includes(c.search_item_param)&&(q="#/orders/"),b.wa.setHash(q),c.search_item_param=null,c.pre_search_hash=null)})},initDropdown:function(){var a=
this,c=this,e=["params.","state_id=","courier_contact_id="],d=function(k){k.$button.css({background:"var(--highlighted-blue)"})},g=function(k){return k&&"/"===k.slice(-1)?k.slice(0,-1):k},m=function(k){return k.every(function(p){return!e.some(function(r){return p.startsWith(r)})})},h=!1;b(".js-orders-dropdown").waDropdown({hover:!1,items:".menu > li > a",ready:function(k){var p=g(window.location.hash);if(!p||!p.includes("hash=search")){var r=decodeURIComponent(c.getFiltersHashStorage());r&&(p=r)}if(p){var y=
decodeURIComponent(p).replace(/#(\/?)orders(\/?)|hash=search\/$/g,"").split("&").filter(Boolean);if(y.length){if(h||m(y))return h=!0,!1;r=k.$menu.find(".js-orders-link");r.length&&r.each(function(){var q=b(this);y.some(function(u){return u==q.data("param")})&&(k.$button.html(q.html()),d(k));y.some(function(u){return decodeURIComponent(q.attr("href")).includes(u)})&&(k.$button.html(q.html()),d(k))})}b(".js-remove-filters-link").toggleClass("hidden",!p.includes("hash=search"))}p=k.$menu.find('[href="'+
p+'"]');p.length&&k.$button.html(p.html())},change:function(k,p,r){k=b(p);var y=["params.storefront","params.sales_channel"],q=g(window.location.hash),u=k.data("param");p=!1;q.includes("hash=search")&&!u&&(u=decodeURIComponent(k.attr("href").replace(/#\/orders\/withoutSearch|\/$/g,"")));if(u){"string"===typeof q&&q.includes(c.search_item_param)&&(q=q.replace(c.search_item_param,""),c.pre_search_hash=c.search_item_param=null,b(".js-orders-search-hide").trigger("click"));var v=decodeURIComponent(q).replace(/#(\/?)orders(\/?)|hash=search\/|&id=\d+|$/g,
"").split("&").filter(Boolean);p=v.findIndex(function(z){return"state_id=new|processing|auth|paid"===z});-1!==p&&v.splice(p,1);p=$jscomp.makeIterator(u.split("="));var w=p.next().value;q=p.next().value;var B=v.findIndex(function(z){return z.includes(w)});if(p="all"===w){var G=!1;q.split("|").forEach(function(z){v.forEach(function(F,E){F.startsWith(z)&&(G=!0,v.splice(E,1))})});c.clearFilter(r.$wrapper);r.$before&&r.$before.parent().removeClass("selected");if(!G)return!1}else-1!==B?v[B]=w+"="+q:v.push(u),
b(".js-remove-filters-link").toggleClass("hidden",!1),b(".js-order-nav-brick").each(function(){b(this).removeClass("selected")});u=-1;"courier_contact_id"===w?u=v.findIndex(function(z){return z.includes("params.courier_id")}):"params.courier_id"===w&&(u=v.findIndex(function(z){return z.includes("courier_contact_id")}));-1!==u&&v.splice(u,1);v.reduceRight(function(z,F,E){y.some(function(A){return F.includes(A)})&&(null!==z?v.splice(E,1):z=E);return z},null);var D=[];B=v.filter(function(z){if(/^sort\[\d+\]/.test(z))return!0;
e.some(function(F){return z.startsWith(F)})&&D.push(z);return!1});u=D.join("&");D.length&&(u="&"+u);u=encodeURIComponent(u);q="";B.length&&(q="&"+B.join("&"));B="";m(D)?(B+="all/",c.clearFilters()):B+="hash=search/"+u+q+"/";c.setFiltersHashStorage(B);b.wa.setHash("/orders/"+B)}else location.replace(k.attr("href"));p||(d(r),r.$button.html(k.html()))}});b(".js-remove-filters-link").on("click",function(){a.clearFilters()})},visibilityFilters:function(a){var c=b(".js-order-nav-block-secondary");a?c.show():
c.hide()},clearFilter:function(a){$btn=a.find(".dropdown-toggle").removeAttr("style");(a=$btn.data("text"))&&$btn.text(a)},clearFilters:function(){var a=this;b(".js-orders-dropdown").each(function(c,e){a.clearFilter(b(e))});b(".js-remove-filters-link").addClass("hidden")},prevHash:null,hash:null,skipDispatch:0,stopDispatch:function(a){this.skipDispatch=a},forceHash:function(a){location.hash!=a&&(this.skipDispatch++,b.wa.setHash(a))},dispatch:function(a){if(0<this.skipDispatch)return this.skipDispatch--,
!1;if(void 0===a||null===a)a=window.location.hash;a=a.replace(/(^[^#]*#\/*|\/$)/g,"");null!==this.hash&&(this.prevHash=this.hash);this.hash=a;var c=new b.Event("wa_before_dispatched");b(window).trigger(c);if(a)if(a=a.split("/"),a[0]){c="";var e,d=null,g=null;for(e=0;e<a.length;e++){var m=a[e];if(2>e){if(0===e)c=m;else if(parseInt(m,10)!=m&&-1==m.indexOf("="))c+=m.substr(0,1).toUpperCase()+m.substr(1);else break;"function"==typeof this[c+"Action"]&&(d=c,g=e+1)}else break}"function"!==typeof this[c+
"Action"]&&d&&(c=d,e=g);a=a.slice(e);this.preExecute(c);"function"==typeof this[c+"Action"]?(b.shop.trace("$.orders.dispatch",[c+"Action",a]),this[c+"Action"].apply(this,a)):b.shop.error("Invalid action name:",c+"Action");this.postExecute(c)}else this.preExecute(),this.defaultAction(),this.postExecute();else this.preExecute(),this.defaultAction(),this.postExecute()},back:function(){var a=b.orders.prevHash||"";location.hash=a?a+"/":""},preExecute:function(a,c){},postExecute:function(a,c){this.actionName=
a},defaultAction:function(){this.ordersAction()},couponsAction:function(){b.order_list&&b.order_list.finit();this.load("?module=coupons")},ordersEditAction:function(a){this.load("?module=order&action=edit&id="+a,function(){b.order_list&&b.order_list.finit()})},ordersNewAction:function(a){this.load("?module=order&action=edit"+(a?"&"+a:""),function(){b.order_list&&b.order_list.finit()})},ordersAction:function(a){var c=this;a||(arguments=this.argsLastFilters(),"all"===arguments[0]&&(arguments=[],a="all"));
var e=!0;if("hash"===a)a={hash:Array.prototype.slice.call(arguments,1).join("/")};else{var d="";"search"===a&&(d=Array.prototype.slice.call(arguments,1));1<arguments.length&&(a=Array.prototype.join.call(arguments,"/"));if(!a)a="state_id=new|processing|auth|paid";else if("all"===a||"all&view=split"===a)a="";a=b.shop.helper.parseParams(a||"");a.view||(a.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",a.view);b.order_edit&&b.order_edit.slideBack();d&&(a.search=
d)}e=a&&"new|processing|auth|paid"!==a.state_id;"orders"===this.actionName&&b.order_list?b.order_list.dispatch(a):(b.order_list&&b.order_list.finit(),this.load("?module=orders&"+this.buildOrdersUrlComponent(a),function(){b(window).trigger("wa_loaded",[["table","kanban"]]);b.order_list&&b.order_list.dispatch(a);c.visibilityFilters(e)}))},orderAction:function(a,c){c=b.shop.helper.parseParams(c||"");c.view||(c.view=b.storage.get("shop/orders/view")||this.options.view);b.storage.set("shop/orders/view",
c.view);b.order_edit&&b.order_edit.slideBack();this.load("?module=order&id="+encodeURIComponent(a)+"&"+this.buildOrdersUrlComponent(c),function(){var e=b("#s-content").find("#s-order-title a.back.order-list");e.show();var d=b("#s-all-orders");d.length&&d.hasClass("shadowed")&&(d=d.find("a:first"),d.length&&e.attr("href",d.attr("href")))});b.order_list&&b.order_list.finit()},buildOrdersUrlComponent:function(a){var c="",e;for(e in a)a.hasOwnProperty(e)&&"view"!==e&&(c+="&"+e+"="+a[e]);return"view="+
(a.view||this.options.view)+c},load:function(a,c,e){function d(){var h=b(".js-orders-sort"),k=b("#s-order-nav").length;h.length&&(k?h.removeClass("hidden"):h.addClass("hidden"))}"function"===typeof c?(e=c,c={}):c=c||{};var g=Math.random();this.random=g;var m=this;return b.ajax({method:"GET",url:a,global:!1,cache:!1,xhr:function(){var h=new window.XMLHttpRequest;h.addEventListener("progress",function(k){m.$wrapper.trigger("wa_loading.wa_loading",k)},!1);h.addEventListener("abort",function(k){m.$wrapper.trigger("wa_abort.wa_loading")},
!1);return h}}).done(function(h){if("undefined"!==typeof c.check&&!c.check||m.random==g){(c.content||b("#s-content")).removeClass("bordered-left").html(h);"function"===typeof e&&e.call(this);var k=b(window);setTimeout(function(){k.trigger("scroll")},250);d();m.checkAlerts();m.waLoadingLoaded()}}).fail(function(h){h.responseText&&(403===h.status?b.wa.errorHandler(h):console.error(h.responseText));m.$wrapper.trigger("wa_load_fail.wa_loading")})},checkAlerts:function(){var a=b.storage.get("shop/alerts");
b.shop.trace("checkAlerts",a);b(".s-alert").each(function(){-1==b.inArray(b(this).data("alert"),a)&&b(this).show()})},ordersNavDetach:function(){void 0===window.ordersNav&&(window.ordersNav=b("#s-order-nav").detach())},initWaLoading:function(){var a=b.waLoading(),c=b("#wa");this.$wrapper.on("wa_before_load.wa_loading",function(){a.show();a.animate(1E4,95,!1);c.addClass("is-locked")}).on("wa_loading.wa_loading",function(e,d){a.set(d.loaded/d.total*100)}).on("wa_abort.wa_loading",function(){a.abort();
c.removeClass("is-locked")}).on("wa_loaded.wa_loading",function(){a.done();c.removeClass("is-locked")})},waLoadingBeforeLoad:function(){this.$wrapper.trigger("wa_before_load.wa_loading")},waLoadingLoaded:function(){this.$wrapper.trigger("wa_loaded.wa_loading",[["waLoading"]])},hasFiltersInUrl:function(){return window.location.hash?window.location.hash.includes("hash=search"):!1},setFiltersHashStorage:function(a){a&&b.storage.set("shop/orders/filters_hash",a.replace("orders/",""))},getFiltersHashStorage:function(){var a=
b.storage.get("shop/orders/filters_hash");return a?a.replace("orders/",""):""},argsLastFilters:function(){var a=[],c=this.getFiltersHashStorage();c&&(a=c.split("/").filter(Boolean),b.wa.setHash("/orders/"+c));return a},orderNav:function(){var a=b("#s-order-nav");return{hide:function(){a.addClass("hidden")},show:function(){a.removeClass("hidden")}}}}})(jQuery);(function(b){b.order_list={id:0,options:{},container:null,$selectionMenu:null,$search_form:null,sidebar:null,select_all_input:null,plugin_hash:"",filter_params:{},filter_params_str:"",filter_params_extended:[],params:null,timer_id:0,lazy_load_win:null,all_printforms:null,sort:["create_datetime","desc"],xhrs:{lazy_load:null,update_load:null,printforms:null},templates:{},init:function(a){this.options=a=a||{};this.plugin_hash=a.plugin_hash||"";this.filter_params=a.filter_params||{};this.filter_params_str=
a.filter_params_str||"";this.container=b("#order-list");this.templates=a.templates||{};"table"==a.view&&(this.container=b("#order-list").find("tbody:first"),this.$selectionMenu=this.options.$selectionMenu)&&(this.select_all_input=this.$selectionMenu.find(".s-order-list-select-all"),this.select_all_input.attr("checked",!1),b(".js-selection-dropdown").waDropdown({hide:!1}));this.is_view_pos=!1;if("split"==a.view){this.is_view_pos=this.filter_params&&this.filter_params.viewpos;var c=b("#s-orders"),e=
b("#s-order"),d=function(m){m=e.find(".back.order-list");m.addClass("js-order-hide mobile-only").show().attr("href","javascript:void(0);");m.off().on("click",function(){e.addClass("desktop-and-tablet-only");c.removeClass("desktop-and-tablet-only");b(window).off("hashchange")});setTimeout(function(){});b(window).unbind("hashchange");b(window).on("hashchange",function(){})};this.container.off().on("wa_order_mobile_loaded",function(m,h){b.order_list.isMobile()&&h&&b.order_list.id&&d(h)});this.container.on("click",
"li[data-order-id]",function(m){b("#skeleton_split").removeClass("desktop-and-tablet-only");e.removeClass("desktop-and-tablet-only");c.addClass("desktop-and-tablet-only");var h=b(this),k=(b.order_list.params?b.order_list.params.id:null)||b.order_list.id;k==h.data("order-id")&&(m.preventDefault(),d(k))});this.container.on("click","[data-order-id]:not(.selected) a",function(){b.skeletonLoader.repeatShow()})}this.options.all_order_state_ids=this.options.all_order_state_ids||null;this.sidebar=b("#s-sidebar");
this.id=a.id||0;this.container.on("append_order_list",function(){b("#s-orders [data-wa-tooltip-content]").waTooltip()});if(a.orders&&a.orders.length&&a.view){try{this.container.append(tmpl("template-order-list-"+this.options.view,{orders:a.orders,states:a.state_names||{},state_counters:a.state_counters||{},state_icons:a.state_icons||{}},!0)),this.container.trigger("append_order_list",[a.orders])}catch(m){if(b("#template-order-list-kanban").length)return b.shop.notification({class:"danger",content:"Error: "+
m.message}),console&&console.log(m.stack),this;b.storage.set("shop/orders/view","table")}delete a.orders;delete this.options.orders}a.lazy_loading&&this.initLazyLoad(a.lazy_loading);a.counters&&this.updateCounters(a.counters);a.update_process&&this.updateProcess("run",a.update_process);b.orders.$wrapper.trigger("wa_init_orders_nav_before",[a]);if(/order\/\d+/.test(b.orders.hash))b.orders.orderNav().hide();else{b.orders.orderNav().show();this.ordersNavTeleport();this.selectionMenuTeleport();if(a.sort&&
a.sort[0]){a.sort[0]=""+a.sort[0];var g=b(".js-orders-sort .s-sort").map(function(){var m=b(this).data("sort")||"";return m?m:!1}).toArray();0>g.indexOf(a.sort[0])&&(a.sort[0]=g[0]);a.sort[1]=a.sort[1]||"";a.sort[1]="desc"===a.sort[1].toLowerCase()?"desc":"asc";this.sort=a.sort}this.initSortMenu();b.orders.$wrapper.trigger("wa_init_orders_nav_after",[a])}a.total_processing&&this.updateTotalProcessing(a.total_processing);this.initView()},initLazyLoad:function(a){function c(){var k=e.container.find(".order:last");
if(k=parseInt(k.attr("data-order-id"),10))b(".lazyloading-link").hide(),b(".lazyloading-progress").show(),b.getJSON(e.buildLoadListUrl(k),function(p){if("ok"==p.status){try{e.container.append(tmpl("template-order-list-"+e.options.view,{orders:p.data.orders,states:e.options.state_names||{},state_counters:e.options.state_counters||{},state_icons:e.options.state_icons||{},check_all:"table"==e.options.view?e.select_all_input.attr("checked"):!1})),e.container.trigger("append_order_list",[p.data.orders]),
e.container.find("[data-order-id="+e.options.id+"]").length&&(e.container.find(".selected").removeClass("selected"),e.container.find("[data-order-id="+e.options.id+"]").addClass("selected"))}catch(r){console&&console.log(r.stack);return}h&&m.unobserve(h);b(".lazyloading-progress-string").text(p.data.progress.loaded+" "+p.data.progress.of);b(".lazyloading-progress").hide();b(".lazyloading-chunk").text(p.data.progress.chunk);p.data.loaded>=p.data.total_count?b(".lazyloading-link").hide():(b(".lazyloading-link").show(),
(h=e.container.find(".order:last").get(0))&&m.observe(h))}else console&&console.log("Error when loading orders: "+p.errors)}).error(function(p){console&&(p&&p.errors?console.log("Error when loading orders: "+p.errors):p?console.log(p):console.log("Error when loading orders"))})}if("kanban"!==this.options.view){var e=this,d=e.options.count,g=e.options.total_count,m=null,h=null;a=b("#s-orders");a.on("touchstart",function(){b("body").css({overflow:"hidden"});b(this).children(".sidebar-body").css({overflow:"overlay"});
setTimeout(function(){b("body").css({overflow:"auto"})})});a.off("click",".lazyloading-link").on("click",".lazyloading-link",function(){c();return!1});(function(){m=new IntersectionObserver(function(k){0>=k[0].intersectionRatio||d<g&&c()});(h=e.container.find(".order:last").get(0))&&m.observe(h)})()}},initView:function(){function a(m){var h=b.order_list.getSelectedOrders(),k=function(){c.$selectionMenu.addClass("disabled");c.$selectionMenu.find(".js-selection-menu-loading").show();c.select_all_input.attr("disabled",
!0);g(m,h,function(){c.$selectionMenu.removeClass("disabled");c.$selectionMenu.find(".js-selection-menu-loading").hide();c.select_all_input.removeAttr("disabled");c.select_all_input.trigger("select",!1);b.orders.dispatch()})};h.all?confirm($_("Perform action to all selected orders?"))&&k():k()}var c=this;this.initSidebar();"table"===this.options.view&&c.$selectionMenu&&c.$selectionMenu.length?this.initSelecting():"split"===this.options.view&&this.options.id&&this.loadOrder(this.options.id);var e=
b("#s-orders-views"),d=b("#s-order-nav");e.find("li.selected").removeClass("selected");e.find('li[data-view="'+this.options.view+'"]').addClass("selected");"split"==this.options.view&&(this.is_view_pos?e.find("li.selected:not(.js-view-pos)").removeClass("selected"):e.find("li.selected.js-view-pos").removeClass("selected"));d.attr("data-view-mode",this.options.view);e.find("li a").each(function(){var m=b(this),h=b(this).parents("li:first"),k="";h.hasClass("js-view-pos")?k="&viewpos=1":b.order_list.options.filter_params_str&&
(k="&"+b.order_list.options.filter_params_str,k=k.replace(/viewpos=[0-9-]*/,"").replace("&&","&").replace(/&$/,""));m.attr("href","#/orders/view="+h.attr("data-view")+k+"/")});var g=function(m,h,k){var p=function(){var v=b(window),w=b.Deferred();if(!h.all||!c.options.lazy_loading||v.lazyLoad("get","stopped"))return w.resolve(),w;c.container.one("append_order_list.ensureOrderListChunkLoaded",function(){w.resolve()});setTimeout(function(){c.container.off("append_order_list.ensureOrderListChunkLoaded");
w.resolve()},2E3);v.lazyLoad("force");return w},r=function(v){var w=b.Deferred();if(b.isEmptyObject(v.data.orders))return w.resolve(),w;c.container.one("append_order_list.updateOrderListChunk",function(){w.resolve()});setTimeout(function(){c.container.off("append_order_list.updateOrderListChunk");w.resolve()},1E3);c.updateListItems(v.data.orders);return w},y=function(v){var w=b.Deferred(),B=function(){c.container.find(".order:not(:hidden):first").length||b("#s-content").html(c.templates.dummy_no_orders_body)},
G=[],D=c.filter_params;if(!b.isEmptyObject(v.data.orders))for(var z=0,F=v.data.orders.length;z<F;z++)!b.isEmptyObject(D)&&D.state_id&&("string"===b.type(D.state_id)&&D.state_id!==v.data.orders[z].state_id?G.push(v.data.orders[z].id):"array"===b.type(D.state_id)&&-1===D.state_id.indexOf(v.data.orders[z].state_id)&&G.push(v.data.orders[z].id));b.isEmptyObject(G)?(B(),w.resolve()):(c.hideListItems(G).done(function(){B();w.resolve()}),setTimeout(function(){w.resolve()},1E3));return w},q=function(v){var w=
b.Deferred();p().done(function(){r(v).done(function(){y(v).done(function(){b.order_list.updateCounters({state_counters:v.data.state_counters,common_counters:{pending:v.data.pending_count}});w.resolve()})})});return w},u=function(v,w){b.shop.jsonPost("?module=orders&action=performAction&id="+m+"&offset="+(v||0)+"&"+c.options.filter_params_str,h,function(B){"ok"===B.status?q(B).done(function(){B.data.offset<B.data.total_count?u(B.data.offset,w):w(B)}):w(B)})};u(0,k)};if(c.$selectionMenu)c.$selectionMenu.off("click.order_list",
".js-wf-action-item").on("click.order_list",".js-wf-action-item",function(){var m=b(this),h=m.data("action-id");if(!m.hasClass("disabled"))return h&&a(h),!1})},loadOrder:function(a){this.container.find(".selected").removeClass("selected");this.container.find("[data-order-id="+a+"]").addClass("selected");var c=null,e=null;b.order&&(c=b.order.id,e=b.order.$wrapper.find("[data-state-id]").data("state-id"));b.orders.load("?module=order&id= "+a+"&"+this.filter_params_str,{content:b("#s-order")},function(){this.id=
a;b(window).trigger("wa_loaded",[["split"]]);b("#order-list").trigger("wa_order_mobile_loaded",[a]);setTimeout(function(){b.order&&b.orders_sales&&c===b.order.id&&e!==b.order.$wrapper.find("[data-state-id]").data("state-id")&&b.orders_sales.reload()},100)})},getSelectedOrders:function(a){a=a||!1;var c={count:0,all:!1};if(this.select_all_input.attr("checked")){c.all=!0;var e=b.order_list.filter_params;a?(c.serialized=[],b.isEmptyObject(e)?c.serialized.push({name:"filter_params",value:""}):b.each(e,
function(d,g){b.isArray(g)?b.each(g,function(m,h){c.serialized.push({name:"filter_params["+d+"]["+m+"]",value:h})}):c.serialized.push({name:"filter_params["+d+"]",value:g})})):c.filter_params=b.isEmptyObject(e)?"":e;c.count=this.options.total_count}else a?c.serialized=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return{name:"order_id[]",value:b(this).attr("data-order-id")}}).toArray():c.order_id=b.order_list.container.find(".order.selected").map(function(){c.count+=1;return b(this).attr("data-order-id")}).toArray();
return c},initSortMenu:function(){var a=this,c=b(".js-orders-sort"),e=c.find(".js-sort-dropdown-skeleton");c=c.find(".js-sort-dropdown");var d;d||c.waDropdown({hover:!1,items:".menu > li > a",ready:function(g){d=g;var m=a.sort[0]?a.sort[0]:"create_datetime",h=a.sort[1]?a.sort[1]:"desc";d.$button.data("sort")||(g.$wrapper.find(".count").addClass("hidden"),g.$button.find("."+h).removeClass("hidden"),g.$menu.find('a[data-sort="'+m+'"]').find("."+h).removeClass("hidden"));d.$button.data("sort",m);d.$button.data("order",
h)},change:function(g,m,h){g=b(m);var k=h.$button.data();m=k.sort;k=k.order;g.data("sort")===m?k="desc"===k?"asc":"desc":(m=g.data("sort"),k="desc");h.$menu.find(".count").addClass("hidden");g.find("."+k).removeClass("hidden");h.$button.find("."+k).removeClass("hidden").siblings(".count").addClass("hidden");g=$jscomp.makeIterator([m,k]);h=g.next().value;g=g.next().value;d.$button.data("sort",h).data("order",g);m=window.location.hash||"";m=m.replace(/(^[^#]*#\/*|\/$)/g,"");m.split("/")[1]||(m="#/orders/state_id=new|processing|auth|paid");
m=m.replace(/(&*sort\[[01]\]=.*?[&\/]|&*sort\[[01]\]=.*?$)/g,"");(k=0<m.indexOf("=")||m.includes("all"))&&(m=m.replace(/[\/&]$/,""));b.wa.setHash(m+((k?"&":"")+"sort[0]="+h+"&sort[1]="+g+"/"))}});c.removeClass("hidden");e.addClass("hidden")},initSidebar:function(){var a=b("#s-order-nav");this.is_view_pos?a.removeClass("is-not-view-pos").addClass("is-view-pos"):a.removeClass("is-view-pos").addClass("is-not-view-pos");var c=a.find(".selected").removeClass("selected");this.filter_params.state_id?b.isArray(this.filter_params.state_id)&&
1<this.filter_params.state_id.length?(b("#s-pending-orders").addClass("selected"),b(".js-pending-orders").parent().addClass("selected")):a.find('[data-state-id="'+this.filter_params.state_id+'"]').addClass("selected"):this.filter_params.contact_id?a.find("[data-contact-id="+this.filter_params.contact_id+"]").addClass("selected"):this.filter_params.storefront?(c=decodeURIComponent(this.filter_params.storefront),"/"===c.slice(-1)&&(c=c.slice(0,-1)),a.find('[data-storefront="'+c+'"]').addClass("selected")):
b.order_list.filter_params_str?a.find('[href="'+window.location.hash+'"]:first').closest("li").addClass("selected").length||c.addClass("selected"):b("#s-all-orders").addClass("selected");a.find(".js-orders-link").unbind("click.order_list").bind("click.order_list",function(){a.find(".selected").removeClass("selected");b(this).hasClass("js-order-nav-brick")?b(this).addClass("selected"):b(this).closest("li").addClass("selected");if(b(this).attr("href").replace(/(^[^#]*#\/*|\/$)/g,"")==b.orders.hash){var e=
b.orders.hash.replace("orders/","");e!==b.orders.hash&&b.orders.ordersAction.apply(b.orders,e.split("/"))}})},updateSelectionMenuActionItemsByStates:function(a){var c=[];if("string"===typeof a)c.push(a);else if(b.isArray(a))c=[].concat(a);else return;a=this.$selectionMenu.find(".wf-actions .js-wf-action-item");a.addClass("disabled");var e={};a.each(function(){var g=b(this),m=g.data("actionId");g=g.data("availableForStates").split(",");for(var h=0;h<c.length;h++){var k=c[h];k=""+k;-1!==g.indexOf(k)&&
(e[k]=e[k]||[],e[k].push(m))}});var d=b.shop.intersectArrays(b.shop.getValues(e),!0);0<d.length&&a.filter(function(){return-1<b.inArray(b(this).data("actionId"),d)}).removeClass("disabled")},enableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").removeClass("disabled")},disableAllSelectionMenuActionItems:function(){this.$selectionMenu.find(".wf-actions .js-wf-action-item").addClass("disabled")},initSelecting:function(){var a=this,c=this.container,e=
this.select_all_input;a.filter_params&&a.filter_params.state_id&&e.is(":checked")&&a.updateSelectionMenuActionItemsByStates(a.filter_params.state_id);e.click(function(){b(this).trigger("select",this.checked)});b(window).one("wa_before_dispatched",function(k){a.$selectionMenu.hide()});a.xhrs.printforms=null;var d=function(k){k=tmpl("template-order-list-printforms-menu-items",k);var p=a.$selectionMenu.find(".wf-actions");p.find(".s-printform-item,.s-printform-item-sep,.s-printform-item-button").remove();
p.append(k)};b(document).keydown(function(k){16!=k.keyCode||b(k.target).closest(".redactor-box").length||(document.body.onselectstart=function(){return!1})}).keyup(function(k){16==k.keyCode&&(document.body.onselectstart=null)});var g=function(){var k=b("#order-list"),p=e.attr("checked");k=k.find(".order.selected:first").length;p||k?(a.$selectionMenu.show(),a.$search_form&&a.$search_form.hide(),k=null,k=p?a.options.all_order_state_ids?a.options.all_order_state_ids:a.filter_params&&a.filter_params.state_id?
a.filter_params.state_id:null:a.container.find(".order.selected").map(function(){return b(this).data("stateId")}).toArray(),null!==k?(k=b.shop.getUniqueValues(k),a.updateSelectionMenuActionItemsByStates(k)):a.enableAllSelectionMenuActionItems()):(a.$selectionMenu.hide(),a.$search_form&&a.$search_form.show())};c.off("select",".order").on("select",".order",function(k,p){(void 0!==p?p:1)?b(this).addClass("selected").find("input:first").attr("checked",!0).prop("checked",!0):(b(this).removeClass("selected").find("input:first").attr("checked",
!1).prop("checked",!1),e.is(":checked")&&e.attr("checked",!1).prop("checked",!1));g();return!1});var m=function(){a.xhrs.printforms&&a.xhrs.printforms.abort();d({printforms:[]});a.xhrs.printforms=null;e.is(":checked")&&null!==b.order_list.all_printforms?d({printforms:b.order_list.all_printforms}):a.xhrs.printforms=b.shop.getJSON("?module=orders&action=printforms",a.getSelectedOrders(),function(k){b.isEmptyObject(k.data.printforms)||(e.is(":checked")&&(b.order_list.all_printforms=k.data.printforms),
d(k.data),a.xhrs.printforms=null)})};e.unbind("select").bind("select",function(k,p){p=void 0!==p?p:!0;k=b(this);p?(k.attr("checked",!0),c.find(".order").trigger("select",!0,!1)):(k.attr("checked",!1),c.find(".order").trigger("select",!1,!1));m()});c.off("click",".order input").on("click",".order input",function(k){var p=k.shiftKey;k=this.checked;var r=b(this).parents(".order:first");k?r.addClass("selected"):(e.is(":checked")&&e.attr("checked",!1),r.removeClass("selected"));if(p&&k){(p=c.data("last_checked"))||
(p=c.find(".order:first").trigger("select",!0));var y=r.prevAll(".selected[data-order-id="+p.attr("data-order-id")+"]");if(y.length){var q=r.prev();for(p=p.get(0);q.length&&p!=q.get(0);)q.addClass("selected").find("input").attr("checked",!0),q=q.prev()}else if(y=r.nextAll(".selected[data-order-id="+p.attr("data-order-id")+"]"),y.length)for(q=r.next(),p=p.get(0);q.length&&p!=q.get(0);)q.addClass("selected").find("input").attr("checked",!0),q=q.next();c.data("last_checked")||y.length||p.trigger("selected",
!1)}k&&c.data("last_checked",r);g();m()});var h=function(k,p){if(100<p.count)alert($_("Maximum of %d orders is allowed for bulk form printing.").replace("%d",100));else{var r="?module=orders&action=printformsDisplay";p=b.map(p.serialized,function(y){return y.name+"="+y.value}).join("&");k=b.map(k,function(y){return"form[]="+y}).join("&");r+="&"+p+"&"+k;b.order_list.plugin_hash&&(r+="&hash="+b.order_list.plugin_hash);k=(""+Math.random()).slice(2);window.open(r,k)}};a.$selectionMenu.off("click.printforms").on("click.printforms",
".s-printform-item-button",function(k){k.preventDefault();a.xhrs.printforms&&a.xhrs.printforms.abort();a.xhrs.printforms=null;k=a.$selectionMenu.find(".s-printform-item :checkbox").map(function(){var r=b(this);return r.is(":checked")?r.data("id"):!1}).toArray();if(k.length){var p=a.getSelectedOrders(!0);if(!(0>=p.count))return h(k,p),!1}})},updateTitle:function(a,c){c=parseInt(c,10)||0;var e="";this.options.state_names&&(this.filter_params.state_id?"string"===typeof this.filter_params.state_id?e=
this.options.state_names[this.filter_params.state_id].name:b.isArray(this.filter_params.state_id)&&(e=$_("Processing")):e=$_("All orders"));document.title=c?"("+c+") "+e+(a||""):e+a},updateCounters:function(a){switch(this.options.view){case "split":a.all_count&&b(".js-all-counter").text(a.all_count);break;case "kanban":var c=b(".s-kanban__list__count");for(d in a.state_counters)a.state_counters.hasOwnProperty(d)&&c.filter('[data-status-id="'+d+'"]').text(a.state_counters[d])}a.total_processing&&this.updateTotalProcessing(a.total_processing);
(c=this.sidebar)||(c=b("#s-sidebar"));for(var e in a)if(a.hasOwnProperty(e)){var d=a[e];for(var g in d)if(d.hasOwnProperty(g)){var m="common_counters"==e?b(".js-"+g+"-counter"):"storefront_counters"===e?c.find("li[data-"+e.replace("_counters","")+'="'+g+'"] .count'):c.find("li[data-"+e.replace("_counters","")+"-id="+g+"] .count");if("new"===g||m&&m.length){var h=parseInt(m.text(),10)||0;d[g]=""+d[g];"+"==d[g].substr(0,1)?h+=parseInt(d[g].substr(1),10)||0:"-"==d[g].substr(0,1)?(h-=parseInt(d[g].substr(1),
10)||0,h=0>h?0:h):h=parseInt(d[g],10)||0;m.text(h);"new"===g&&(b.shop.updateAppCounter(h),this.updateTitle(this.options.title_suffix,parseInt(h,10)),b(document).find(".js-new-order-counter").text("+"+h))}}}},updateListItems:function(a){var c="template-order-list-"+this.options.view;if(document.getElementById(c)){var e=this.container;b.isArray(a)||(a=[a]);c=b("<div></div>").append(tmpl(c,{orders:a,states:this.options.state_names,state_counters:this.options.state_counters||{},state_icons:this.options.state_icons||
{},check_all:"table"==this.options.view?this.select_all_input.attr("checked"):!1}));var d=b(".order",e);b(".order",c).each(function(){var g=b(this);d.filter("[data-order-id="+g.attr("data-order-id")+"]").replaceWith(g)});c.remove();this.container.trigger("append_order_list",[a]);this.getAndUpdateCounters()}},getAndUpdateCounters:function(){var a=this,c=parseInt(this.container.find(".order:first").attr("data-order-id"),10)||0;b.getJSON(this.buildLoadListUrl(c,!0,!0),function(e){var d;"ok"===e.status&&
(null==e?0:null==(d=e.data)?0:d.counters)&&a.updateCounters(e.data.counters)})},updateTotalProcessing:function(a){a&&b(".js-total_processing-counter").html(a.replace(",","."))},hideListItems:function(a){var c=b.Deferred();setTimeout(function(){if(b.order_list&&b.order_list.container&&b.order_list.container.length){if(b.isArray(a)){var e=b.order_list.container.find(".order");m=b();for(var d=0;d<a.length;d++){var g=e.filter("[data-order-id="+a[d]+"]");m=m.add(g)}}else var m=b.order_list.container.find(".order[data-order-id="+
a+"]");var h=m.length,k=0;m.slideUp(450,function(){k++;k>=h&&c.resolve()})}},1E3);return c.promise()},dispatch:function(a,c){"string"===typeof a&&(a=b.shop.helper.parseParams(a));var e={list:function(){b.orders.waLoadingBeforeLoad();b.order_list.finit();b.orders.load("?module=orders&"+b.orders.buildOrdersUrlComponent(a),function(){b.order_list.dispatch(a);b(window).trigger("wa_loaded",[["table","kanban"]])})},order:function(){b.order_list.loadOrder(a.id)}};null===this.params?(this.params=a,c&&e.list()):
a.id&&(c||a.id!=this.params.id)?(e.order(),this.params=a):(c||this.diff(a,this.params)||this.diff(this.params,a))&&e.list()},diff:function(a,c){for(var e in a)if(a.hasOwnProperty(e)&&"id"!=e&&a[e]!==c[e])return!0;return!1},buildLoadListUrl:function(a,c,e,d,g,m){d=void 0===d?null:d;g=void 0===g?null:g;m=void 0===m?null:m;d&&this.filter_params_str&&this.filter_params_str.includes("hash")&&(this.filter_params_str+=encodeURIComponent("&update_datetime>="+d),d=null);g=g||this.sort;"kanban"===this.options.view&&
"state_id=new|processing|auth|paid"===this.filter_params_str&&(this.filter_params_str=null);return"?module=orders&action=loadList"+(m?"&state_id="+m:"")+"&id="+a+(this.filter_params_str?"&"+this.filter_params_str:"")+(c?"&lt=1":"")+(e?"&counters=1":"")+(e?"&prev_pending="+b(".js-pending-counter:first").text()||"0":"")+(this.options.view?"&view="+this.options.view:"")+(d?"&search=update_datetime>="+d:"")+("&sort[0]="+g[0]+"&sort[1]="+g[1])},updateProcess:function(a,c){var e=this;a=a||"run";c=c||{};
timeout=c.timeout||6E4;var d=this,g=function(){null!==d.timer_id&&(clearTimeout(d.timer_id),d.timer_id=null);null!==d.xhrs.update_load&&(d.xhrs.update_load.abort(),d.xhrs.update_load=null)};g();if("run"==a){var m=function(r,y){var q=d.container.find(".order:first");q=parseInt(q.attr("data-order-id"),10)||0;var u=k(c.last_update_datetime),v;(null==(v=d.options)?0:v.view)&&"kanban"===d.options.view&&(q=0,v=Array.from(document.querySelectorAll("#order-list [data-order-id]")).map(function(w){return w.getAttribute("data-order-id")}),
v.length&&(q=Math.max.apply(Math,$jscomp.arrayFromIterable(v))));return b.getJSON(d.buildLoadListUrl(q,!0,!0,u),function(w){if("ok"==w.status){h(w);b.isEmptyObject(w.data.counters)||d.updateCounters(w.data.counters);if(w.data.count)try{if("kanban"===d.options.view){var B=d.container.find('[data-kanban-list-status-id="new"]');if(B.length){w.data.orders.reverse();var G,D,z,F,E,A;w.data.orders.forEach(function(f){return B.prepend(tmpl("template-order-list-kanban-card",{order:f,state:"new",state_name:(null==
(G=d.options)?void 0:null==(D=G.state_names["new"])?void 0:D.name)||"",state_color:(null==(z=d.options)?void 0:null==(F=z.state_names["new"])?void 0:null==(E=F.options)?void 0:null==(A=E.style)?void 0:A.color)||""}))})}}else d.container.prepend(tmpl("template-order-list-"+d.options.view,{orders:w.data.orders,states:d.options.state_names||{},state_counters:d.options.state_counters||{},state_icons:d.options.state_icons||{},check_all:"table"==d.options.view?d.select_all_input.attr("checked"):!1})),b(".lazyloading-progress-string").text(w.data.progress.loaded+
" "+w.data.progress.of),d.container.trigger("append_order_list",[w.data.orders])}catch(f){console&&(console.log("Error: "+f.message),y());return}"function"===typeof r&&r(w)}else console&&console.log("Error when loading new orders: "+w.errors),"function"===typeof y&&y()}).error(function(w){console&&(w&&w.errors?console.log("Error when loading new orders: "+w.errors):console.log(["Error when loading new orders",w]));"function"===typeof y&&y()})},h=function(r){if(!b.isEmptyObject(r.data.updated_orders))try{for(var y=
[],q={},u=$jscomp.makeIterator(r.data.updated_orders),v=u.next();!v.done;q={$jscomp$loop$prop$order$4:q.$jscomp$loop$prop$order$4,$jscomp$loop$prop$newStateId$8:q.$jscomp$loop$prop$newStateId$8,$jscomp$loop$prop$orderElem$10:q.$jscomp$loop$prop$orderElem$10,$jscomp$loop$prop$oldStateId$7:q.$jscomp$loop$prop$oldStateId$7,$jscomp$loop$prop$hashStateIds$9:q.$jscomp$loop$prop$hashStateIds$9,$jscomp$loop$prop$targetColumn$11:q.$jscomp$loop$prop$targetColumn$11},v=u.next()){q.$jscomp$loop$prop$order$4=
v.value;q.$jscomp$loop$prop$orderElem$10=d.container.find("[data-order-id="+q.$jscomp$loop$prop$order$4.id+"]");var w=q.$jscomp$loop$prop$orderElem$10.hasClass("selected");if(q.$jscomp$loop$prop$orderElem$10.length){q.$jscomp$loop$prop$oldStateId$7=q.$jscomp$loop$prop$orderElem$10.data("state-id");q.$jscomp$loop$prop$newStateId$8=q.$jscomp$loop$prop$order$4.state_id;var B=decodeURIComponent(window.location.hash),G=void 0,D=void 0,z=void 0;q.$jscomp$loop$prop$hashStateIds$9=(null==(G=/state_id=([\w|]+)/.exec(B))?
void 0:null==(D=G[1])?void 0:null==(z=D.replace(/\|{1,2}/g,","))?void 0:z.split(","))||[];var F=function(A){return function(f){var l={states:d.options.state_names||{}},n="";if("kanban"===d.options.view){n="-card";A.$jscomp$loop$prop$order$4.order_icon=A.$jscomp$loop$prop$order$4.contact.photo_50x50;l.order=A.$jscomp$loop$prop$order$4;l.state=A.$jscomp$loop$prop$newStateId$8;var t;l.state_name=null==(t=l.states[l.state])?void 0:t.name;var x;l.state_color=(null==(x=l.states[l.state])?void 0:x.options.style.color)||
"#fff";l.isUpdated=!0}else l.orders=[A.$jscomp$loop$prop$order$4],l.state_counters=d.options.state_counters||{},l.state_icons=d.options.state_icons||{},l.check_all="table"==d.options.view?d.select_all_input.attr("checked"):!1;A.$jscomp$loop$prop$orderElem$10.after(tmpl("template-order-list-"+d.options.view+n,l)).remove();f&&d.loadOrder(A.$jscomp$loop$prop$order$4.id)}}(q);if(function(A){return function(){if(A.$jscomp$loop$prop$oldStateId$7!==A.$jscomp$loop$prop$newStateId$8){if(A.$jscomp$loop$prop$hashStateIds$9.some(function(l){return A.$jscomp$loop$prop$newStateId$8.includes(l)})||
"kanban"===e.options.view)return!0;var f=A.$jscomp$loop$prop$orderElem$10.next();f.length&&d.loadOrder(f.data("order-id"));A.$jscomp$loop$prop$orderElem$10.remove();return!1}return!0}}(q)()){if(F(w),q.$jscomp$loop$prop$oldStateId$7!==q.$jscomp$loop$prop$newStateId$8){var E=d.container.find('[data-order-id="'+q.$jscomp$loop$prop$order$4.id+'"]');q.$jscomp$loop$prop$targetColumn$11=d.container.find('[data-kanban-list-status-id="'+q.$jscomp$loop$prop$newStateId$8+'"]');E.slideToggle("normal",function(A){return function(){b(this).prependTo(A.$jscomp$loop$prop$targetColumn$11).slideToggle("normal")}}(q))}}else q.$jscomp$loop$prop$orderElem$10.remove();
y.push(q.$jscomp$loop$prop$order$4.update_datetime)}}k(y.sort()[y.length-1]);d.container.trigger("append_order_list",[r.data.updated_orders])}catch(A){console&&console.log("Error: "+A.message)}},k=function(r){function y(u){return u.toISOString().replace("T"," ").substring(0,19)}r||(r=new Date,r.setDate(r.getDate()-1),r=y(r));r=new Date(r+"Z");var q=y(r);r.setTime(r.getTime()+timeout);c.last_update_datetime=y(r);return q},p=function(){d.timer_id=setTimeout(function(){null===d.xhrs.lazy_load?d.xhrs.update_load=
m(p,g):d.xhrs.lazy_load.then(function(){d.xhrs.update_load=m(p,g)})},timeout)};p()}},finit:function(a){a=this.xhrs;var c=this.lazy_load_win,e;for(e in a)a.hasOwnProperty(e)&&null!==a[e]&&a[e].abort();this.updateProcess("kill");c&&c.lazyLoad("stop");this.params=null},ordersNavTeleport:function(){var a=window.ordersNav;a&&b.orders&&(a.show(),"split"===this.options.view?b("#s-orders").find(".sidebar-header").prepend(a):b("#s-content").before(a),b.orders.initDropdown(),"split"===this.options.view||this.isMobile()?
(a=b(".js-orders-search").detach(),a.addClass("js-orders-search-split-and-mobile"),b("#s-order-nav .js-order-nav-view").after(a)):(a=b(".js-orders-search-split-and-mobile"),a.length&&(a.removeClass("js-orders-search-split-and-mobile"),b("#s-order-nav .s-order-nav-search").append(a.detach()))))},selectionMenuTeleport:function(){if(this.$selectionMenu&&(this.$search_form=b(".js-sidebar-search-form"),this.$search_form.length)){var a=this.$selectionMenu.detach();this.$search_form.after(a)}},isMobile:function(){return b("#js-media-mobile").is(":visible")}}})(jQuery);$.order_edit={id:0,container:null,form:null,customer_form:null,$storefront_selector:null,stocks:[],slide_on:!1,options:{},locales:{},init:function(b){this.options=b;b.id&&(this.id=b.id);this.container="string"===typeof b.container?$(b.container):b.container;this.form="string"===typeof b.form?$(b.form):b.form;this.$storefront_selector=$("#order-storefront");b.stocks.sort(function(a,c){return a.sort-c.sort});this.stocks=b.stocks;b.title&&(document.title=title);b.float_delimeter||(b.float_delimeter=
".");b.locales&&(this.locales=b.locales);this.float_delimeter=b.float_delimeter;this.prev_ship_method=null;this.container.trigger("order_edit_init");this.initView();this.initShippingControl();this.initDiscountControl();this.initCouponControl();this.initCustomerSourceControl(b.customer_sources);$.orders.orderNav().hide()},initCustomerForm:function(b){this.customer_form=new ShopBackendOrderEditorCustomerForm($("#s-order-edit-customer"),this,b)},initView:function(){var b=this,a=b.options;this.initStorefrontSelector();
var c=function(h){var k=h.find(".s-orders-sku-stock-select").find("option:selected"),p=h.find(".s-orders-skus").find("input[type=radio]:checked").parents("li:first");h.find(".s-orders-stock-icon-aggregate").show();h.find(".s-orders-stock-icon").html("").hide();p=p.length?p:h;k.attr("data-icon")&&(p.find(".s-orders-stock-icon-aggregate").hide(),p.find(".s-orders-stock-icon").html(k.attr("data-icon")).show(),h.find(".s-orders-stock-icon .s-stock-left-text").show(),p.find(".s-orders-stock-icon .s-stock-left-text").hide())};
$.order_edit.slide(!0,"add"==a.mode);this.container.find(".back").click(function(){$.order_edit.id?$.order_edit.slide(!1):$.order_edit.slide(!1,!0);$.orders.back();return!1});this.getOrderItems(this.container,!0);$(".s-order-item").each(function(){var h=$(this);c(h)});$("#order-currency").change(function(){$("#order-items .currency").html($(this).val());$.order_edit.options.currency=$(this).val()});var e=a.price_edit||!1,d=$("#orders-add-autocomplete");d.autocomplete({source:"?action=autocomplete&with_counts=1",
minLength:3,delay:300,select:function(h,k){$(".s-order-errors").empty();h="?module=orders&action=getProduct&product_id="+k.item.id+"&order_id="+$.order_edit.id+"&currency="+$.order_edit.options.currency;(k=b.getStorefront())&&(h+="&storefront="+k);$.getJSON(h,function(p){var r=$("#order-items"),y=parseInt(r.find(".s-order-item:last").attr("data-index"),10)+1||0;r=p.data.product;r.sku_id&&r.skus[r.sku_id]&&(r.skus[r.sku_id].checked=!0);1===$("#subtotal.hidden").length&&($("#productless-subtotal").addClass("hidden").prop("disabled",
!0).hide(),$("#subtotal").removeClass("hidden").show());$("#order-currency").length&&!$("#order-currency").attr("disabled")&&($('<input type="hidden" name="currency">').val($("#order-currency").val()).insertAfter($("#order-currency")),$("#order-currency").attr("disabled","disabled"));var q=$("#s-orders-add-row");q.before(tmpl("template-order",{data:p.data,options:{index:y,currency:$.order_edit.options.currency,stocks:$.order_edit.stocks,price_edit:e}}));p=q.prev();y=r.skus[r.sku_id];$.order_edit.initQuantity({$wrapper:p.find("#js-quantity-section").removeAttr("id"),
denominator:r.order_multiplicity_factor,step:y.order_count_step||r.order_count_step,min:y.order_count_min||r.order_count_min});$("#s-order-comment-edit").show();$.order_edit.updateTotal();c(p)});d.val("");return!1}});this.container.off("change",".s-orders-skus input[type=radio]").on("change",".s-orders-skus input[type=radio]",function(){var h=$(this),k=h.parents("tr:first"),p=h.closest("li"),r=this.value,y=k.attr("data-product-id"),q=k.attr("data-index"),u=null;"edit"==($.order_edit.id?"edit":"add")&&
(u=parseInt(h.attr("name").replace("sku[edit][",""),10));h="?module=orders&action=getProduct&product_id="+y+"&sku_id="+r+"&currency="+$.order_edit.options.currency;(r=b.getStorefront())&&(h+="&storefront="+r);$.getJSON(h,function(v){var w=-1!==k.find("input:first").attr("name").indexOf("add")?"add":"edit";k.find(".s-orders-services").replaceWith(tmpl("template-order-services-"+w,{services:v.data.sku.services,service_ids:v.data.service_ids,product_id:y,options:{price_edit:e,index:q,currency:$.order_edit.options.currency,
stocks:$.order_edit.stocks}}));k.find(".s-orders-product-price").find("input").val(v.data.sku.price);k.find(".s-orders-sku-stock-place").empty();p.find(".s-orders-sku-stock-place").html(tmpl("template-order-stocks-"+w,{sku:v.data.sku,index:q,stocks:$.order_edit.stocks,item_id:u}));var B=k.find(".js-order_count_min");if(B.length){w=v.data.sku;B=B.find(".js-value");var G=v.data.sku.order_count_min?parseFloat(v.data.sku.order_count_min):parseFloat(v.data.product.order_count_min);B.text(G);B=parseFloat(w.count);
G=k.find(".s-orders-sku-stock-select");if(G.length&&w.stock){var D=G.val();D&&w.stock[D]&&(B=parseFloat(w.stock[D]));G.data("stock",w.stock)}G=k.find(".js-quantity-field").data("controller");G.update({min:w.order_count_min?parseFloat(w.order_count_min):parseFloat(v.data.product.order_count_min),max:B});console.log(G)}c(k);$.order_edit.updateTotal()})});this.container.off("change",".s-orders-sku-stock-select").on("change",".s-orders-sku-stock-select",function(){var h=$(this).parents("tr.s-order-item:first"),
k=h.find(".s-orders-sku-stock-select");if(k.length){var p=k.val();k=k.data("stock");if(p&&k&&k[p]){var r=h.find(".js-quantity-field").data("controller");r.update({max:parseFloat(k[p])});console.log(r)}}c(h)});var g=function(h,k,p){var r=h.attr("data-price");h=h.attr("data-percent-price");p&&k.val(r);k.attr("data-price",r);k.attr("data-percent-price",h)};this.container.off("change",".s-orders-service-variant").on("change",".s-orders-service-variant",function(){var h=$(this),k=h.find("option:selected");
h=h.parents("li:first");g(k,h.find(".s-orders-service-price"),!0)});this.container.find(".s-orders-service-variant").each(function(){var h=$(this),k=h.find("option:selected");h=h.parents("li:first");g(k,h.find(".s-orders-service-price"),!1)});this.container.off("click",".s-order-item-delete").on("click",".s-order-item-delete",function(){$(this).parents("tr:first").remove();$("table#order-items").find("tr.s-order-item:first").length||$("#s-order-comment-edit").hide();$.order_edit.updateTotal();return!1});
this.container.off("change",".s-orders-services input").on("change",".s-orders-services input",$.order_edit.updateTotal);this.container.off("change",".s-orders-product-price input").on("change",".s-orders-product-price input",function(){var h=$(this).parents("tr:first");$.order_edit.updateServicePriceInPercent(h);$.order_edit.updateTotal()});this.container.off("change",".s-orders-services .s-orders-service-variant").on("change",".s-orders-services .s-orders-service-variant",$.order_edit.updateTotal);
$("#payment_methods").change(function(){$(this).val();$("#payment-info > div").hide();$.order_edit.updateTotal()});$("#productless-subtotal").on("change",function(){$.order_edit.updateTotal()});this.container.off("keydown",".s-orders-quantity").on("keydown",".s-orders-quantity",function(){var h=$(this),k=h.data("timer_id");k&&clearTimeout(k);h.data("timer_id",setTimeout(function(){$.order_edit.updateTotal()},450))});if(this.form&&this.form.length){var m=function(){var h=$(this);if(m.xhr)return!1;
$.order_edit.showValidateErrors();$('.s-orders-services input[name^="service"][type="checkbox"]:not(:checked),.s-orders-services input.js-fake-service-selected[type="checkbox"]:not(:checked)',this.form).each(function(){$(this).closest("li").find(":input").attr("disabled",!0)});if(!$.order_edit.container.find(".error").length){$.order_edit.switchSubmitButton("disable");var k=function(){m.xhr=null;$.order_edit.switchSubmitButton();$(".s-orders-services input:disabled",h).attr("disabled",!1)};m.xhr=
$.order_edit.id?$.order_edit.saveSubmit(k,"edit"):$.order_edit.saveSubmit(k,"add")}return!1};this.form.unbind("sumbit").bind("submit",m)}$("#subtotal").text(this.roundFloat($("#subtotal").text()));$("#total").text(this.roundFloat($("#total").text()));$("#discount").val(this.roundFloat($("#discount").val()));$("#tax").text(this.roundFloat($("#tax").text()));this.container.trigger("order_edit_init_view")},initShippingControl:function(){var b=this;b.prev_ship_method=$("#shipping_methods").val();$("#shipping-custom").on("change",
":input",function(a){$.shop.trace("#shipping-custom change",[a,this]);a.originalEvent&&$(this).data("affects-rate")&&$.order_edit.updateTotal()});b.setShippingInfo();$("#shipping_methods").change(function(){var a=$("#shipping_methods option:selected"),c=a.data("rate")||0,e=$("#shipping-rate");e.data("shipping")&&a.val()==b.prev_ship_method||(e.val($.order_edit.formatFloat(c)),e.data("shipping",!1),b.prev_ship_method=a.val());b.setShippingInfo();$.order_edit.updateTotal()});$("#shipping-rate").change(function(){var a=
$(this);if(0>a.val())return alert($.order_edit.locales.wrong_cost),a.val(0),!1;$("#shipping-rate").data("shipping",$(this).val());$.order_edit.updateTotal()});this.container.trigger("order_edit_init_shipping")},initDiscountControl:function(){function b(){0<$.order_edit.parseFloat(a.val())?g.stop().show():g.stop().hide();var h=25;g.is(":visible")&&g.finish().fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+=50).fadeOut(h+=50).fadeIn(h+50)}var a=$("#discount"),c=$("#discount-description"),
e=$("#update-discount"),d=$("#edit-discount"),g=$("#discount-tooltip-icon");g.tooltip({showURL:!1,bodyHandler:function(){return c.val()||c.data("updated-manually-msg")}});e.tooltip({showURL:!1,bodyHandler:function(){return e.data("description")||c.data("updated-manually-msg")}});d.length?g.show():g.hide();$("#order-edit-form").on("order_total_updated",function(h,k){a.show();a.parent().find("span.js-order-discount:first").hide();d.hide();e.data("description",k.discount_description);if(k.discount){e.data("value",
k.discount).data("description",k.discount_description).data("items_discount",k.items_discount);if("calculate"===e.data("discount")){c.val(e.data("description"));h=e.data("items_discount")||[];for(var p=0;p<h.length;p++)if(h[p]){var r="#order-items span.js-item-total-discount";r+='[data-discount-id="'+h[p].selector+'"]';r=$(r);r.length&&r.html(h[p].html).show()}b()}"calculate"===e.data("discount")?$.order_edit.parseFloat(k.discount)!==$.order_edit.parseFloat(a.val())&&e.click():e.show()}});var m=function(){a.show();
a.parent().find("span.js-order-discount:first").hide();d.hide();$(".js-item-total-discount").hide()};d.click(function(){m();c.val("");return!1});e.click(function(){m();a.val(e.data("value")||0).change();c.val(e.data("description"));a.attr("title",c.data("edit-manually-msg"));e.hide().data("discount","calculate");$.order_edit.updateTotal();b();return!1});a.on("change",function(){d.click();c.val("");$("#order-items .js-item-total-discount").hide();a.attr("title",null);e.show().data("discount",$(this).val());
$.order_edit.updateTotal();b()});this.container.trigger("order_edit_init_discount")},initCouponControl:function(){function b(){r.show();r.css("padding-right",$(".coupon-controls").width()+4+"px")}var a=$("#coupon_id"),c=$("#coupon-code"),e=$(".coupon-code-label"),d=$(".js-no-coupon-text"),g=$(".js-coupon-icon"),m=$(".js-edit-coupon"),h=$(".js-close-coupon"),k=$(".js-delete-coupon"),p=$("#update-discount"),r=$("#js-coupon-invalid-msg");m.on("click",function(){$(this).add(d).add(g).add(e).hide();c.data("value",
c.val());c.val("").show();h.show()});h.click(function(){c.val(c.data("value"));m.show();""===a.val()?d.show():g.add(e).show();$(this).add(c).add(r).hide()});k.click(function(){$(this).add(c).add(g).add(e).add(m).add(h).add(r).hide();a.val("");p.click();d.add(m).show()});$(".disabled-link").click(function(y){y.preventDefault()});c.autocomplete({source:function(y,q){$.ajax({type:"POST",url:"?module=marketing&action=CouponsAutocomplete",data:{term:c.val(),products:$('input[name^="product["]').serializeArray()},
success:function(u){q(u);u.length?r.hide():b()},error:function(){q([])}})},minLength:1,delay:300,select:function(y,q){q.item.data.valid?(c.val(q.item.label).hide(),a.val(q.item.value),e.html(q.item.label).show(),m.add(g).add(k).show(),q.item.data.right?($(".s-order-edit-coupon").attr("href",$(".s-order-edit-coupon").data("href")+q.item.value),0!=q.item.value.length&&(p.click(),$(".s-order-edit-coupon").removeClass("disabled-link"))):0!=q.item.value.length&&p.click(),h.hide()):(c.val(q.item.label),
b());return!1}})},initCustomerSourceControl:function(b){var a=$("#customer-source");a.autocomplete({delay:0,minLength:0,appendTo:"#order-edit-form",source:function(c,e){var d=b.filter(function(g){return g&&g.indexOf&&0<=g.indexOf(c.term)}).slice(0,10);1==d.length&&d[0]==c.term?e([]):e(d)}}).on("focus",function(){a.autocomplete("search")})},initUpdateServicePrice:function(){this.container.find(".s-order-item").each(function(){$.order_edit.updateServicePriceInPercent($(this))})},initQuantity:function(b){function a(e,
d){var g=d="string"===typeof d?d:""+d;switch(e){case "float":e=parseFloat(d);0<=e&&(g=1*e.toFixed(3));break;case "number":var m="0123456789.,".split(""),h=[],k=!1;$.each(d.split(""),function(p,r){"."===r||","===r?k||(k=!0,h.push(".")):0<=m.indexOf(r)&&h.push(r)});g=h.join("");break;case "integer":m="0123456789".split(""),h=[],$.each(d.split(""),function(p,r){0<=m.indexOf(r)&&h.push(r)}),g=h.join("")}return g}var c=function(e){c=function(d){this.$wrapper=d.$wrapper;this.$field=this.$wrapper.find(".js-quantity-field");
this.denominator="undefined"!==typeof d.denominator?a("float",d.denominator):1;this.denominator=0<this.denominator?this.denominator:1;this.min="undefined"!==typeof d.min?a("float",d.min):this.denominator;this.min=0<this.min?this.min:1;this.max="undefined"!==typeof d.max?a("float",d.max):0;this.max=0<=this.max?this.max:0;this.step="undefined"!==typeof d.step?a("float",d.step):1;this.step=0<this.step?this.step:1;d=this.$field.val();0<parseFloat(d)||0===parseFloat(d)||(this.$field.val(this.min),d=this.min);
this.value=this.validate(d);this.init()};c.prototype.init=function(){function d(m){var h="0123456789.".split(""),k=[],p=!1;m=m.replace(/,/g,".");e.each(m.split(""),function(r,y){"."===y?p||(p=!0,k.push(y)):0<=h.indexOf(y)&&k.push(y)});return k.join("")}var g=this;g.$field.data("controller",g);g.$wrapper.data("controller",g);g.$field.on("input",function(){var m=g.$field.val();var h=d("string"===typeof m?m:""+m);h!==m&&g.$field.val(h)});g.$field.on("change",function(){g.set(g.$field.val())})};c.prototype.set=
function(d,g){d=this.validate(d);this.$field.val(d);this.value=d;this.$wrapper.trigger("quantity.changed",[this.value,this])};c.prototype.validate=function(d){d="number"!==typeof d?parseFloat(d):d;d=parseFloat(d.toFixed(3));0<d?.001>d?d=.001:this.max&&.001<this.max&&d>this.max&&(d=this.max):0!==d&&(d=.001);return a("float",d)};c.prototype.update=function(d){var g="undefined"!==typeof d.min?a("float",d.min):this.min,m="undefined"!==typeof d.max?0<=parseFloat(d.max)?a("float",d.max):0:this.max,h="undefined"!==
typeof d.step?a("float",d.step):this.step;d="undefined"!==typeof d.value?this.validate(d.value):this.value;0<g&&g!==this.min&&(this.min=g);0<=m&&m!==this.max&&(this.max=m);0<h&&h!==this.step&&(this.step=h);0<d&&d!==this.value&&(this.value=d);this.set(this.value)};return c}($);return new c(b)},updateServicePriceInPercent:function(b){var a=b.find(".js-order-edit-item-price").val();if("undefined"===typeof a)return null;b.find('[data-currency="%"]').each(function(){var c=$(this),e=a*(c.data("percentPrice")/
100);e=$.order_edit.roundFloat(e);c.val($.order_edit.formatFloat(e));c.attr("data-price",e)})},setShippingInfo:function(){var b=$("#shipping_methods"),a=b.children(":selected"),c=$("#shipping-rate"),e=$("#shipping-info"),d=b.val(),g=b.data("_shipping_id"),m=$.order_edit.checkSelectedAddressFields(),h=[];a.length?(a.data("error")&&!m&&h.push('<span class="error">'+a.data("error")+"</span>"),a.data("est_delivery")&&h.push('<span class="hint est_delivery">'+a.data("est_delivery")+"</span>"),$("#shipping-custom > div").hide(),
null!==d&&(d=(""+d).replace(/\..+$/,""),$("#shipping-custom-"+d).length&&$("#shipping-custom-"+d).show()),a.data("comment")&&h.push('<span class="hint">'+a.data("comment")+"</span>"),h?(a.data("error")&&!m?(c.addClass("error"),b.addClass("error")):(c.removeClass("error"),b.removeClass("error")),e.html(h.join("<br>")).show()):(c.removeClass("error"),e.empty().hide())):b.addClass("error");$.shop.trace("check shipping_methods id",[g,d,a])},checkSelectedAddressFields:function(){var b=$('[name="customer[address.shipping][city]"]'),
a=$('[name="customer[address.shipping][region]"]');b=[{exists:0<b.length,selected:""!=b.val()},{exists:0<a.length,selected:""!=a.val()}];var c=a=0,e;for(e in b){var d=b[e];d.exists&&a++;d.exists&&d.selected&&c++}return a==c},getOrderItems:function(b){var a=[],c=[];b.find(".s-order-item").each(function(){var e=$(this),d=e.find('input[name^="product"]').val(),g=[],m=$.order_edit.parseFloat(e.find(".s-orders-product-price input").val()),h=$.order_edit.parseFloat(e.find("input.s-orders-quantity").val()),
k=e.find("select.s-orders-sku-stock-select").val(),p=e.data("item-id"),r=e.find("input[name^=sku]:not(:radio)").add(e.find("input[name^=sku]:checked")).first().val()||0,y={product_id:d,sku_id:r,services:[]};e.find(".s-orders-services").length&&e.find(".s-orders-services input:checkbox:checked").each(function(){var q=$(this).closest("li"),u=$.order_edit.parseFloat(q.find("input.s-orders-service-price").val()),v=$(this).val();q=q.find(':input[name^="variant["]').val();g.push({id:v,price:u,variant_id:q});
y.services.push(v)});y.services.sort();y.services=y.services.join("_");a.push({id:p,product_id:d,quantity:h,price:m,sku_id:r,services:g,stock_id:k});c.push(y)});c=this.reduceOrderContent(c);b.data("order-content",c);return a},reduceOrderContent:function(b){b.sort(function(a,c){var e=a.product_id-c.product_id;0===e&&(e=a.sku_id-c.sku_id);0===e&&(e=a.services.localeCompare(c.services));return e});return b.map(function(a){return"*"+a.product_id+":"+a.sku_id+":"+a.services}).join(";")},updateTotal:function(){function b(){a=
null;$.order_edit.realUpdateTotal()}var a=null;return function(){a?(clearTimeout(a),a=setTimeout(b,250)):a=setTimeout(b,500)}}(),realUpdateTotal:function(){var b=$.order_edit.container,a=$("#subtotal"),c=$("#total"),e=$("#tax");if(b.find(".s-order-item").length){var d=this;$.order_edit.switchSubmitButton("disable");$.order_edit.showValidateErrors();for(var g={},m=$("#s-order-edit-customer").find('[name^="customer["]').serializeArray(),h=0;h<m.length;h++)g[m[h].name]=m[h].value;g.storefront=d.getStorefront();
1===$("#subtotal.hidden").length?g.items=[{quantity:1,price:$("#productless-subtotal").val()}]:g.items=$.order_edit.getOrderItems(b);var k=$("#update-discount").data("discount");void 0!==k&&("calculate"!==k&&(k=$.order_edit.parseFloat(k)),g.discount=k);$.order_edit.id?g.order_id=$.order_edit.id:g.currency=$("#order-edit-form input[name=currency]").val();b=$("#shipping_methods").val();m=$("#payment_methods").val();h=$("#coupon_id").val();$("#shipping-rate").data("shipping")&&(g.shipping=$("#shipping-rate").data("shipping"));
g.params={shipping_id:b,coupon_id:h,payment_id:m};g["customer[id]"]=g.contact_id=$("#s-customer-id").val();g.tax="calculate";b&&(b=parseInt(b.split(".")[0]),0<b&&$("#shipping-custom").find(">#shipping-custom-"+b+" :input").each(function(){g[this.name]=this.value}));$.ajax({type:"POST",url:"?module=order&action=total",data:g,success:function(p){function r(t){var x=$("#payment_methods"),C=$("#payment-info"),H=x.val();x.html("");C.html("");x.append("<option value=''></option>");x.val("");t.length&&$.each(t,
function(L,I){x.append('<option value="'+I.id+'" '+(I.is_truncated?'title="'+I.name+'"':"")+">"+I.truncated_name+"</option>");I.id===H&&(x.val(H),I.custom_html&&$("<div />",{id:"payment-custom-"+I.id,class:"fields form"}).html(I.custom_html).appendTo(C))})}if(p&&"ok"===p.status){var y=$("#shipping-rate"),q=$("#shipping_methods"),u=$.trim(q.val())||"",v=u.replace(/\W.+$/,"");p.data&&(p.data=$.order_edit.parseTotalResponse(p.data));q.empty();q.prepend('<option value=""></option>');if(0<p.data.shipping_method_ids.length){var w=
$("#shipping-custom");w.empty();var B=p.data.shipping_method_ids,G=p.data.shipping_methods,D=!1,z=!1;-1!==B.indexOf(u)&&(D=!0);D||-1===B.indexOf(Number(v))||(z=D=!0);w.find(">div.fields.form").hide();for(var F=0;F<B.length;F+=1){var E=""+B[F],A=G[E],f=E.replace(/\W.+$/,""),l=$("<option></option>");l.html(A.truncated_name).attr("value",E).data("rate",A.rate);l.data("error",A.error||void 0);l.data("est_delivery",A.est_delivery||void 0);l.data("comment",A.comment||void 0);l.data("external",A.external||
!1);A.is_truncated&&l.attr("title",A.name);q.append(l);u||0!==F||$("#shipping-rate").val($.order_edit.formatFloat(A.rate));if(v==f){if(A.custom_data)for(var n in A.custom_data)A.custom_data.hasOwnProperty(n)&&l.data(n,A.custom_data[n]);A.custom_html&&(l=w.find("#shipping-custom-"+f),l.length||(l=w.append('<div id="shipping-custom-'+f+'" class="fields form"></div>'),l=w.find("#shipping-custom-"+f)),l.html(A.custom_html))}if(!D&&(A=(""+E).split("."),f=u.split("."),""!==f[0]&&void 0!==A[0]&&void 0!==
f[0]&&A[0]==f[0])){u=E;q.val(u);$.order_edit.setShippingInfo();$.order_edit.realUpdateTotal();return}}q.val(u);z&&q.val(v);q.data("_shipping_id",v);$.shop.trace("set shipping_methods id",[v,u])}r(p.data.payment_methods);""!=k&&$("#discount").val(p.data.discount);y.val(p.data.shipping);$("#order-edit-form").trigger("order_total_updated",p.data);a.text(p.data.subtotal);c.text(p.data.total);e.text(p.data.tax);$.order_edit.showValidateErrors(p.data.errors);d.setShippingInfo()}$.order_edit.switchSubmitButton()},
dataType:"json"})}else a.text(0),c.text(0),$.order_edit.checkSelectedAddressFields()&&($("#shipping_methods, #shipping-rate").removeClass("error"),$("#shipping-info").empty().hide())},saveSubmit:function(b,a){var c=this.form,e=c.serializeArray();"calculate"===$("#update-discount").data("discount")?$(e).each(function(){"discount"==this.name&&(this.value="calculate")}):void 0===$("#update-discount").data("discount")&&(e=e.filter(function(g){return"discount"!==g.name}),0<$("#discount").val()?e.discount_description=
$("#edit-discount").val():e=e.filter(function(g){return"discount_description"!==g.name}));success="add"==a?function(g){$.order_edit.container.trigger("order_edit_save_success",{data:g.data,is_new:!0});$.order_edit.slide(!1,!0)&&($.orders.setFiltersHashStorage("state_id=new|processing|auth|paid"),location.href="#/orders/state_id=new|processing|auth|paid&view=split&id="+g.data.order.id+"/")}:function(g){$.order_edit.container.trigger("order_edit_save_success",{data:g.data,is_new:!1});$.order_edit.container.find(".back").click()};
if(1===$("#subtotal.hidden").length){var d=[{name:"quantity[edit][0][product]",value:1},{name:"product[edit][0]",value:0},{name:"sku[edit][0]",value:0},{name:"name[edit][0]",value:$.order_edit.locales.noproduct_item_name},{name:"item[edit][0]",value:0},{name:"currency",value:$("#order-currency").val()}];e=[].concat($jscomp.arrayFromIterable(e),$jscomp.arrayFromIterable(d))}this.container.trigger("order_edit_save",e);return $.shop.jsonPost(c.attr("action"),e,success,function(g){$.shop.trace(a,g);g&&
g.errors&&!$.isEmptyObject(g.errors)&&$.order_edit.showValidateErrors(g.errors)},b)},parseTotalResponse:function(b){["total","discount","shipping","tax","subtotal"].forEach(function(a){if("number"===typeof b[a]||"string"===typeof b[a])b[a]=$.order_edit.roundFloat(parseFloat((+b[a]).toFixed(2)))});return b},roundFloat:function(b){return b?this.formatFloat(Math.round(100*b)/100):0},formatFloat:function(b){return","===this.float_delimeter?(""+b).replace(".",","):""+b},parseFloat:function(b){return b?
parseFloat((""+b).replace(",",".")):0},slideBack:function(){this.slide(!1,"add"==this.options.mode)},slide:function(b,a,c){if(0==arguments.length)this.slide(!0,"add"==this.options.mode);else{b="undefined"===typeof b?!0:b;a="undefined"===typeof a?!1:a;var e=this.options.duration||200,d=this.options.view,g=[];return!this.slide_on&&b?(g.push($("#s-sidebar").animate({width:0},e,function(){$(this).hide()})),$(".s-level2").hide(),g.push($("#maincontent").animate({"margin-top":45},e)),g.push($("#s-content").animate({"margin-left":0},
e)),g.push($("#s-orders").animate({width:0},e,function(){$(this).hide()})),g.push($("#s-order").animate({"margin-left":0},e).find(">div:first").removeClass("double-padded, bordered-left").find("h1 .back.order-list").hide().end().find("h1 .back.read-mode").show()),this.slide_on=!0,$(".s-order-readable").hide(),$(".s-order-editable").show(),$.when(g).done(function(){$.order_list&&$.order_list.lazy_load_win&&$.order_list.lazy_load_win.lazyLoad("sleep");"function"===typeof c&&c.call(this)}),!0):this.slide_on&&
!b?(g.push($("#s-order").animate({"margin-left":"table"==d||a?200:300},e).find(">div:first").addClass("double-padded, bordered-left").find("h1 .back.order-list").show().end().find("h1 .back.read-mode").hide()),g.push($("#s-orders").animate({width:300},e).show()),g.push($("#maincontent").animate({"margin-top":84},e)),$(".s-level2").show(),g.push($("#s-sidebar").animate({width:200},e).show()),this.slide_on=!1,$(".s-order-editable").hide(),$(".s-order-readable").show(),$.when(g).done(function(){$.order_list.lazy_load_win&&
$.order_list.lazy_load_win.lazyLoad("wake");"function"===typeof c&&c.call(this)}),!0):!1}},switchSubmitButton:function(b){var a=this.form,c=$(a).find(".s-order-items-edit td.save i.loading");a=$(a).find("[type=submit]");"disable"===b?(c.css("display","inline-block"),a.attr("disabled",!0)):(c.css("display","none"),a.attr("disabled",!1))},showValidateErrors:function(b){var a=[];$.shop.trace("showValidateErrors",b);$("#shipping-info").find(".error").empty();$(".error").removeClass("error");$("#s-order-edit-customer .errormsg").empty();
this.customer_form&&this.customer_form.showValidateErrors(b?b.customer:{});$(".s-order-errors").empty();if(b&&b.order){if(!$.isEmptyObject(b.order.items))for(var c in b.order.items){var e=$(".s-order-item[data-index="+c+"]"),d=b.order.items[c],g;for(g in d){var m=e.find(".s-error-item-"+g);m.length?m.text(d[g]):a.push(d[g])}delete b.order.items[c]}if(!$.isEmptyObject(b.order.product)){var h=b.order.product,k;for(k in h)h.hasOwnProperty(k)&&"quantity"in h[k]&&$(".s-order-item[data-product-id="+k+"]").each(function(){$(this).find("ul.s-orders-skus input:radio:checked").val()!=
""+h[k].sku_id&&$(this).find("ul.s-orders-skus").length||($(this).find(".s-orders-quantity").addClass("error"),a.push(h[k].quantity))})}b.order.common&&a.push(b.order.common);b.order.discount&&($("#discount").addClass("error"),a.push(b.order.discount));a.length&&$(".s-order-errors").html(a.join("<br>"))}},getSelectedStorefront:function(b){var a=this.$storefront_selector,c=$.trim(a.val());return b?{storefront:c,data:a.find(":selected").data()}:c},getStorefrontSelector:function(){return this.$storefront_selector},
getStorefront:function(){return this.getStorefrontSelector().val()},initStorefrontSelector:function(){var b=this;b.$storefront_selector.on("change",function(){b.customer_form&&b.customer_form.isEnabled()&&b.customer_form.reloadForm()})},filterStorefrontSelector:function(b){var a=this.$storefront_selector;a.find("option").each(function(){var c=$(this),e=c.val(),d=c.data();c.show();!d.orderStorefront&&e&&b&&!d[b]&&(c.hide(),c.is(":selected")&&a.val(""))})},getPercentSymbol:function(){return"%"}};var ShopBackendCustomerForm=function(b){ShopBackendCustomerForm=function(a,c){this.options=c||{};this.$wrapper=a;this.dom_ns=this.$wrapper.attr("id");this.namespace=c.namespace||null;this.locales=c.locales;this.fields_config=c.fields_config||{};this.$wrapper.data("ShopBackendCustomerForm",this);b.contains(document,this.$wrapper.get(0))&&this.activate()};ShopBackendCustomerForm.prototype.activate=function(){this.$wrapper.off("."+this.dom_ns);this.initConfirmedCheckboxes();this.initContactTypeSelector();
this.initShippingAddress();this.initBillingAddress();this.initAdditionalAddressSubfields();this.fixStyles()};ShopBackendCustomerForm.prototype.deactivate=function(){this.$wrapper.off("."+this.dom_ns);this.unbindAll()};ShopBackendCustomerForm.prototype.getOptions=function(){return this.options||{}};ShopBackendCustomerForm.prototype.setOptions=function(a){this.options=a||{}};ShopBackendCustomerForm.prototype.getContact=function(a){var c=this.options.contact||{};return a?b.extend({},c,!0):c};ShopBackendCustomerForm.prototype.initConfirmedCheckboxes=
function(){var a=this.$wrapper,c=a.find(".field-email:eq(0)"),e=a.find(".field-phone:eq(0)"),d=a.find(".s-customer-email-confirmed-control");a=a.find(".s-customer-phone-confirmed-control");c.find(".value").children().first().after(d);e.find(".value").children().first().after(a)};ShopBackendCustomerForm.prototype.initContactTypeSelector=function(){var a=this;a.$wrapper.on("click."+a.dom_ns,".s-order-form-contact-type-selector-wrapper :radio",function(){var c=b(this),e=a.$wrapper.find(".s-order-form-contact-type-selector-wrapper .loading");
c=b.trim(c.val());e.show();a.reloadForm({type:c},{afterReload:function(){e.hide()}})})};ShopBackendCustomerForm.prototype.initAdditionalAddressSubfields=function(){var a=this.fields_config,c=this.$wrapper,e=function(){return".s-customer-more-address-subfields-control"},d=function(){return".s-address-block"};c.find(d()).each(function(){var g=b(this),m=g.closest(".field-address"),h="";m.hasClass("field-address-shipping")?h="shipping":m.hasClass("field-address-billing")&&(h="billing");if(h){var k=g.find(".field").hide(),
p=b(),r=0;b.each(a["address."+h].fields||{},function(y){p=k.filter(".field-address-"+y).show();r++});r!=k.length&&p.after(c.find(e()).first().clone())}});c.on("click",e(),function(){var g=b(this);g.siblings(d()).length?g.siblings(".field, input").appendTo(g.siblings(d())).show():g.closest(d()).find(".field").show();g.remove()})};ShopBackendCustomerForm.prototype.initShippingAddress=function(){var a=this,c=a.$wrapper,e=function(){return c.find(".field-address-shipping").find(".value").children()},
d=function(){return".s-customer-more-shipping-addresses-control"};e().each(function(h){var k=b(this);h=0<h?a.locales.extra_shipping_address:a.locales.main_shipping_address;h=b("<span />").addClass("s-block-header bold").text(h);k.addClass("s-address-block").prepend(h)});var g=1<e().length,m=0<e().not(":first").find(".errormsg,.error").length;g&&!m&&(e().not(":first").hide(),e().first().after(c.find(d())));c.on("click",d()+" .js-toggle-button",function(h){h.preventDefault();e().not(":first").show();
c.find(d()).hide()})};ShopBackendCustomerForm.prototype.initBillingAddress=function(){var a=this,c=a.$wrapper,e=function(){return c.find(".field-address-billing").find(".value").children()},d=function(){return".s-customer-more-billing-addresses-control"};e().each(function(h){var k=b(this);h=0<h?a.locales.extra_billing_address:a.locales.main_billing_address;h=b("<span />").addClass("s-block-header bold").text(h);k.addClass("s-address-block").prepend(h)});var g=1<e().length,m=0<e().not(":first").find(".errormsg,.error").length;
g&&!m&&(e().not(":first").hide(),e().first().after(c.find(d())));c.on("click",d()+" .js-toggle-button",function(h){h.preventDefault();e().not(":first").show();c.find(d()).hide()})};ShopBackendCustomerForm.prototype.fixStyles=function(){this.$wrapper.find('.field-birthday input[name="'+this.namespace+'[birthday][year]"]').css({width:"",minWidth:""})};ShopBackendCustomerForm.prototype.updateInnerHtml=function(a){var c=this.$wrapper;a=b("<div>").hide().appendTo("body").html(a);var e=a.find(".s-customer-form-wrapper");
e=ShopBackendCustomerForm.getInstance(e);this.setOptions(e.getOptions());c.html(a.children(0).html());a.remove()};ShopBackendCustomerForm.prototype.reloadForm=function(a,c){var e=this,d=e.$wrapper;c=c||{};var g=b.extend({},a||{});g.type||(g.type=e.getContact().type);var m=d.find(".loading").show();c.beforeReload&&c.beforeReload(g);d.trigger("beforeReload",[g]);if(!a["new"]){a=d.find(":input:not(:disabled)").serializeArray();var h=["shipping","billing"];b.each(a,function(k,p){if(p.name.indexOf(e.namespace)){k=
$jscomp.makeIterator(h);for(var r=k.next();!r.done;r=k.next()){r=r.value;var y=b('[name="'+e.namespace+"[address."+r+'][region]"]');0<y.length&&""!=y.data("country")&&(g[e.namespace+"[address."+r+"][data][country]"]=y.data("country"))}}g[p.name]=p.value})}b.post("?action=customerForm",g,function(k){e.updateInnerHtml(k);m.hide();k=e.getContact(!0);c.afterReload&&c.afterReload(k);d.trigger("afterReload",[k])})};ShopBackendCustomerForm.prototype.bind=function(a,c){this.$wrapper.on(a+".custom"+this.dom_ns,
c)};ShopBackendCustomerForm.prototype.unbindAll=function(){this.$wrapper.off(event+".custom"+this.dom_ns)};ShopBackendCustomerForm.getInstance=function(a){return a.data("ShopBackendCustomerForm")instanceof ShopBackendCustomerForm?a.data("ShopBackendCustomerForm"):null};return ShopBackendCustomerForm}(jQuery);var ShopBackendOrderEditorCustomerForm=function(b){ShopBackendOrderEditorCustomerForm=function(a,c,e){this.options=e||{};this.$wrapper=a&&0<a.length?a:b("#s-order-edit-customer");this.editor=c;this.$customer_inputs=this.$wrapper.find(":input");this.initial_values={};this.$customer_form_wrapper=this.$wrapper.find(".s-customer-form-wrapper");(this.customer_form=ShopBackendCustomerForm.getInstance(this.$customer_form_wrapper))||console.error("There is not ShopBackendCustomerForm instance");this.$autocomplete=
b("#customer-autocomplete");this.$customer_id=b("#s-customer-id");this.$new_customer_link=b("#s-order-new-customer");this.contact=e.contact||{};this.init()};ShopBackendOrderEditorCustomerForm.prototype.init=function(){this.initForm();this.rememberInitialValues();this.initAutocomplete()};ShopBackendOrderEditorCustomerForm.prototype.rememberInitialValues=function(){var a=this;a.$customer_inputs.each(function(){var c=b(this),e=c.attr("name"),d=c.val();c.is(":radio")?c.is(":checked")&&(a.initial_values[e]=
d):c.is(":checkbox")?a.initial_values[e]=c.is(":checked"):a.initial_values[e]=d})};ShopBackendOrderEditorCustomerForm.prototype.resetInputValues=function(){var a=this;a.$customer_inputs.each(function(){var c=b(this),e=c.attr("name"),d=c.val();e=a.initial_values[e]||"";c.is(":radio")?d===e&&c.attr("checked","checked"):c.is(":checkbox")?c.is(":checked")?c.attr("checked","checked"):c.attr("checked",""):c.val()})};ShopBackendOrderEditorCustomerForm.prototype.disable=function(a){var c=this.$customer_id,
e=this.$wrapper;a="undefined"===typeof a?!0:a;c.attr("disabled",a);a?e.addClass("s-opaque"):e.removeClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isDisabled=function(){return this.$wrapper.hasClass("s-opaque")};ShopBackendOrderEditorCustomerForm.prototype.isEnabled=function(){return!this.isDisabled()};ShopBackendOrderEditorCustomerForm.prototype.activate=function(a){var c=this.$new_customer_link,e=this.$autocomplete;"undefined"===typeof a||a?(this.disable(!1),e.val("").closest(".flexbox").hide(200),
c.hide(200)):(this.disable(),e.val("").show(),c.show())};ShopBackendOrderEditorCustomerForm.prototype.focusFirstEmptyInput=function(){var a=this.$customer_inputs,c=!1;a.filter("input[type=text], textarea").each(function(){var e=b(this);if(e.is(":not(:hidden)")&&!this.value)return c=!0,e.focus(),!1});c||a.first().focus()};ShopBackendOrderEditorCustomerForm.prototype.initAutocomplete=function(){var a=this,c=function(d){var g=a.inputName;var m=parseInt(d,10)||"+"==d.substr(0,1)||-1!==d.indexOf("(");
g="[name="+g.call(a,m?"phone":-1!==d.indexOf("@")?"email":"firstname")+"]";a.$customer_inputs.filter(g).val(d)},e="";a.$autocomplete.autocomplete({source:function(d,g){e=d.term;b.getJSON(a.options.autocomplete_url,d,function(m){(m=m||[]).push({label:$_("New customer"),name:$_("New customer"),value:0});g(m)})},delay:300,minLength:3,select:function(d,g){d=g.item;if(0<d.value)return a.reloadForm({id:d.value,"new":!0}),!1;if(a.editor.getSelectedStorefront())return a.reloadForm({},{afterReload:function(){c(e)}}),
!1;c(e);a.$customer_id.val(0);a.activate();setTimeout(function(){a.focusFirstEmptyInput()},200);return!1},focus:function(d,g){this.value=g.item.name;return!1}})};ShopBackendOrderEditorCustomerForm.prototype.reloadForm=function(a,c){var e=this,d=e.customer_form;c=c||{};e.disable(!0);a=a||{};d.reloadForm(a,{afterReload:function(g){e.$customer_inputs=e.$wrapper.find(":input");e.contact=g||{};e.$customer_id.val(g.id);e.activate();setTimeout(function(){e.focusFirstEmptyInput()},200);e.editor.updateTotal();
c.afterReload&&c.afterReload(g)}})};ShopBackendOrderEditorCustomerForm.prototype.initForm=function(){for(var a=this,c=a.customer_form,e=a.editor,d=a.$wrapper,g=["firstname","middlename","lastname"],m=0,h=g.length;m<h;m+=1)a.$customer_inputs.filter("[name="+a.inputName(g[m])+"]").addClass("s-error-customer-name");d.find(".s-error-customer-name:last").after('<em class="errormsg s-error-customer-name"></em>');a.$new_customer_link.on("click",function(){if(0<a.$customer_id.val())return!1;e.filterStorefrontSelector(a.getContact().type);
e.getSelectedStorefront()?a.reloadForm():(a.activate(),a.$customer_inputs.first().focus());return!1});0<a.getContact().id?a.activate():a.activate(!1);d.off("focus",":input").on("focus",":input",function(){a.disable(!1)});c.bind("beforeReload",function(k,p){"undefined"===typeof p.id&&(p.id=a.getContact().id);p.storefront=e.getSelectedStorefront()});c.bind("afterReload",function(k,p){e.filterStorefrontSelector(p.type)});e.filterStorefrontSelector(a.getContact().type);d.on("change",':input[name*="[address.shipping]"]',
function(k){k.originalEvent&&(b.shop.trace("Update total if customer address edit",[this,k]),e.updateTotal())});e.form.submit(function(){a.disable(!1)})};ShopBackendOrderEditorCustomerForm.prototype.showValidateErrors=function(a){a=b.extend({},a||{});if(!b.isEmptyObject(a)){var c=this.customer_form;a=b.trim(a.html);0<a.length&&c.updateInnerHtml(a)}};ShopBackendOrderEditorCustomerForm.prototype.inputName=function(a){return'"customer['+a+']"'};ShopBackendOrderEditorCustomerForm.prototype.getContact=
function(){return this.contact=this.contact||{}};return ShopBackendOrderEditorCustomerForm}(jQuery);
//# sourceMappingURL=order.min.js.map