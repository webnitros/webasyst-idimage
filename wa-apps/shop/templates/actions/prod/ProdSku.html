{strip}

{$_settings_url = "{$wa_app_url}?action=settings#/typefeat/"}
{if !empty($product["type_id"])}
    {$_settings_url = "{$_settings_url}{$product["type_id"]}/"}
{/if}

{$_sprite_url = "`$wa_url`wa-apps/shop/img/backend/products/product/icons.svg?v=`$wa->version()`"}
{$_view_types = [
    "thin" => [
        "id" => "thin",
        "html" => "<i class='icon'><svg><use xlink:href='{$_sprite_url}#toggle-thin'></use></svg></i>",
        "render_skus" => false,
        "expanded_sku" => false
    ],
    "half" => [
        "id" => "half",
        "html" => "<i class='icon'><svg><use xlink:href='{$_sprite_url}#toggle-half'></use></svg></i>",
        "render_skus" => true,
        "expanded_sku" => false
    ],
    "full" => [
        "id" => "full",
        "html" => "<i class='icon'><svg><use xlink:href='{$_sprite_url}#toggle-full'></use></svg></i>",
        "render_skus" => true,
        "expanded_sku" => true
    ]
]}

{$_active_view_type_id = "full"}
{$_active_view_type = $_view_types[$_active_view_type_id]}

{$formatted_product["view_types"] = $_view_types}
{$formatted_product["view_type_id"] = $_active_view_type["id"]}

{foreach $formatted_product.skus as $_sku_index => $_sku}
    {$formatted_product.skus[$_sku_index]["expanded"] = $_active_view_type["expanded_sku"]}
    {$formatted_product.skus[$_sku_index]["render_skus"] = $_active_view_type["render_skus"]}
{/foreach}

{* ШАБЛОНЫ *}

{$_templates = []}

{capture assign="_feature_select_dialog"}{include file="./dialogs/feature_select.html" inline}{/capture}
{$_templates["dialog_feature_select"] = $_feature_select_dialog}

{capture assign="_sku_delete_dialog"}{include file="./dialogs/sku_delete_dialog.html" inline}{/capture}
{$_templates["dialog_sku_delete"] = $_sku_delete_dialog}

{capture assign="_sku_delete_photo"}{include file="./dialogs/sku_delete_photo.html" inline}{/capture}
{$_templates["dialog_sku_delete_photo"] = $_sku_delete_photo}

{capture assign="_photo_manager_dialog"}{include file="./ProdSkuImageDialog.html" inline}{/capture}
{$_templates["dialog_photo_manager"] = $_photo_manager_dialog}

{capture assign="_mass_sku_generation"}{include file="./dialogs/mass_sku_generation.html" inline}{/capture}
{$_templates["dialog_mass_sku_generation"] = $_mass_sku_generation}

{* Диалог показывающий какие значения характеристики используются в модификациях *}
{capture assign="_feature_used_values"}{include file="./dialogs/feature_used_values.html" inline}{/capture}
{$_templates["dialog_feature_used_values"] = $_feature_used_values}

{capture assign="_minimal_mode_message"}{include file="./dialogs/minimal_mode_message.html" inline}{/capture}
{$_templates["dialog_minimal_mode_message"] = $_minimal_mode_message}

{capture assign="_locked_mode_message"}{include file="./dialogs/locked_mode_message.html" inline}{/capture}
{$_templates["dialog_locked_mode_message"] = $_locked_mode_message}

{* КОМПОНЕНТЫ *}
{* Они могут добавляться внутри шаблонов через globals. Не удалять. *}

{$_components = []}

{capture assign="_component_fractional_section"}{include file="./components/component_fractional_section.html" inline}{/capture}
{$_components["component-fractional-section"] = $_component_fractional_section|strip}

{$_globals_components = $wa->globals("components")}
{if !empty($_globals_components)}
    {$_components = array_merge($_components, $_globals_components)}
{/if}

{* LOCALE *}

{$_locales = [
    "file_type" => _w("Unsupported image type. Use PNG, GIF, WEBP and JPEG image files only."),
    "sku_required" => _w("An SKU code is required for grouping."),
    "stock_title" => _w("The quantity on this virtual stock is the sum of quantities on physical stocks — %s. You can change the list of stocks in “Settings” section."),
    "total_sku_mods" => _w("Total: %s."),
    "not_defined" => _w("Not defined"),
    "main_sku_visibility" => _w("The main SKU variant cannot be hidden. Either select another variant as main or enable visibility in the storefront for the main variant."),
    "sku_generation_sku_forms" => [
        _w("%d SKU with %s each.", "%d SKUs with %s each.", 1, false),
        _w("%d SKU with %s each.", "%d SKUs with %s each.", 2, false),
        _w("%d SKU with %s each.", "%d SKUs with %s each.", 5, false)
    ],
    "sku_generation_sku_mod_forms" => [
        _w("%d variant", "%d variants", 1, false),
        _w("%d variant", "%d variants", 2, false),
        _w("%d variant", "%d variants", 5, false)
    ],
    "features_hidden_on_front_forms" => [
        _w("%d product variant is not displayed in the storefront because of an error.", "%d product variants are not displayed in the storefront because of an error.", 1, false),
        _w("%d product variant is not displayed in the storefront because of an error.", "%d product variants are not displayed in the storefront because of an error.", 2, false),
        _w("%d product variant is not displayed in the storefront because of an error.", "%d product variants are not displayed in the storefront because of an error.", 5, false)
    ],
    "value_invalid" => _w("Invalid value"),
    "value_required" => _w("This field is required.")
]}

{$_globals_locales = $wa->globals("locales")}
{if !empty($_globals_locales)}
    {$_locales = array_merge($_locales, $_globals_locales)}
{/if}

{* ПОДСКАЗКИ *}

{$_tooltips = [
    "price-error" => [
        "id" => "price-error",
        "html" => sprintf(_w("Enter a number between 0 and %s99,999,999,999.9999%s with max. 4 decimal digits."), '<span class="nowrap">', "</span>"),
        "width" => "16rem"
    ],
    "product-sku-1" => [
        "id" => "product-sku-1",
        "html" => _w("Move by one SKU up")|escape,
        "class" => "inline"
    ],
    "product-sku-2" => [
        "id" => "product-sku-2",
        "html" => _w("Move by one SKU down")|escape,
        "class" => "inline"
    ],
    "product-sku-3" => [
        "id" => "product-sku-3",
        "html" => _w("Copy the SKU with all its variants")|escape
    ],
    "product-sku-4" => [
        "id" => "product-sku-4",
        "html" => _w("Delete the SKU with all its variants")|escape
    ],
    "product-sku-5" => [
        "id" => "product-sku-5",
        "html" => _w("You cannot delete the last product SKU.")|escape
    ],
    "product-sku-6" => [
        "id" => "product-sku-6",
        "html" => _w("Drag to change the variants’ sort order.")|escape
    ],
    "product-sku-7" => [
        "id" => "product-sku-7",
        "html" => _w("You cannot move the last variant away from an SKU.")|escape
    ],
    "product-sku-8" => [
        "id" => "product-sku-8",
        "html" => _w("Change image")|escape,
        "class" => "inline"
    ],
    "product-sku-9" => [
        "id" => "product-sku-9",
        "html" => _w("Delete image")|escape,
        "class" => "inline"
    ],
    "product-sku-10" => [
        "id" => "product-sku-10",
        "html" => _w("Copy variant")|escape,
        "class" => "inline"
    ],
    "product-sku-11" => [
        "id" => "product-sku-11",
        "html" => _w("Delete variant")|escape,
        "class" => "inline"
    ],
    "product-sku-12" => [
        "id" => "product-sku-12",
        "html" => _w("You cannot delete the last SKU variant.")|escape
    ],
    "product-sku-13" => [
        "id" => "product-sku-13",
        "html" => _w("Main product SKU")|escape
    ],
    "product-sku-14" => [
        "id" => "product-sku-14",
        "html" => _w("Make the main product SKU")|escape,
        "class" => "inline"
    ],
    "product-sku-15" => [
        "id" => "product-sku-15",
        "html" => _w("Main product variant")|escape,
        "class" => "inline"
    ],
    "product-sku-16" => [
        "id" => "product-sku-16",
        "html" => _w("Make the main product variant")|escape
    ],
    "product-sku-17" => [
        "id" => "product-sku-17",
        "html" => _w("The variant is available for purchase.")|escape
    ],
    "product-sku-18" => [
        "id" => "product-sku-18",
        "html" => _w("The variant is unavailable for purchase.")|escape
    ],
    "product-sku-19" => [
        "id" => "product-sku-19",
        "html" => _w("Collapse SKU variants")|escape,
        "class" => "inline"
    ],
    "product-sku-20" => [
        "id" => "product-sku-20",
        "html" => _w("Expand SKU variants")|escape,
        "class" => "inline"
    ],
    "product-sku-21" => [
        "id" => "product-sku-21",
        "html" => _w("The SKU is not available for purchase.")|escape
    ],
    "product-sku-22" => [
        "id" => "product-sku-22",
        "html" => _w("Some SKU variants are available for purchase.")|escape
    ],
    "product-sku-23" => [
        "id" => "product-sku-23",
        "html" => _w("The SKU is available for purchase.")|escape
    ],
    "product-sku-24" => [
        "id" => "product-sku-24"
    ],
    "product-sku-front-features-1" => [
        "id" => "product-sku-front-features-1",
        "html" => _w("Add here the product features whose values customers should select to buy a corresponding product variety.")|escape
    ],
    "product-sku-front-features-2" => [
        "id" => "product-sku-front-features-2",
        "html" => _w("The selectable features mode is enabled for this product. In this mode, you need to pick at least one feature for customers to select the variants of this product in the storefront.")|escape
    ],
    "product-mass-sku-generation" => [
        "id" => "product-mass-sku-generation",
        "html" => _w("Automatically create product SKUs matching all selected feature settings.")|escape,
        "position" => "top"
    ],
    "product-image-dialog-1" => [
        "id" => "product-image-dialog-1",
        "html" => _w("Drag & drop image files here or click this area to upload files.")|escape,
        "position" => "top"
    ],
    "product-sku-features-hidden-on-front" => [
        "id" => "product-sku-features-hidden-on-front",
        "html" => _w("In the product variants’ properties must be specified the values of all selectable product features. You cannot select default values of such features for the entire product.")|escape
    ],
    "product-sku-feature-hidden-on-front" => [
        "id" => "product-sku-feature-hidden-on-front",
        "html" => _w("This product variant is not displayed in the storefront. To make it displayed, specify the values of all selectable features in its properties.")|escape
    ],
    "product-feature-used-on-front" => [
        "id" => "product-feature-used-on-front",
        "html" => _w("This feature is used to select product variants in the storefront. Its values can be selected only for individual SKUs.")|escape,
        "position" => "top"
    ],
    "sku_full_required" => [
        "id" => "sku_full_required",
        "html" => _w("Enter an SKU code or name, or both of these values. The “code + name” combination must be unique for every SKU of this product.")|escape
    ],
    "sku_full_unique" => [
        "id" => "sku_full_unique",
        "html" => _w("This product has SKUs with the same “code + name” combination. It must be unique for all SKUs within a product.")|escape
    ],
    "sku_mod_features_name_error_1" => [
        "id" => "sku_mod_features_name_error_1",
        "html" => _w("To distinguish between SKU variants, determine features for product variants selection and set their values in the variants’ properties.")|escape
    ],
    "sku_mod_features_name_error_2" => [
        "id" => "sku_mod_features_name_error_2",
        "html" => _w("This product has SKU variants with equal names. A variant name consists of the SKU name and the set values of features used for product variants selection. Either change the variant name or delete variants with equal names.")|escape
    ],
    "sku_mod_features_values_error_1" => [
        "id" => "sku_mod_features_values_error_1",
        "html" => _w("For this product, variant selection mode by feature values is enabled. In this mode, determine at least one feature by whose values customers will be able to select product variants in the storefront.")|escape
    ],
    "sku_mod_features_values_error_2" => [
        "id" => "sku_mod_features_values_error_2",
        "html" => _w("This product has SKU variants with equal values of the features used for product variants selection in the storefront. Either change those values or delete variants with equal values.")|escape
    ],
    "product-feature-type-select" => [
        "id" => "product-feature-type-select",
        "html" => _w("You cannot select default values for features with the “Multiple values selection from a list” format. Select this feature’s values in product variants’ properties.")|escape
    ]
]}

{capture assign="_tooltip_visible_in_storefront"}
    <p>[`The heading is visible in the storefront.`]</p>
    <p>{sprintf_wp("You can change this setting in <a href=\"%s\" target=\"_blank\">product types and features</a> setup section.", $_settings_url)}</p>
{/capture}
{$_tooltips["visible_in_storefront"] = [
    "id" => "visible_in_storefront",
    "html" => $_tooltip_visible_in_storefront|strip,
    "width" => "15rem"
]}

{$_globals_tooltips = $wa->globals("tooltips")}
{if !empty($_globals_tooltips)}
    {$_tooltips = array_merge($_tooltips, $_globals_tooltips)}
{/if}

{* ЛОКАЛЬНЫЕ КОМПОНЕНТЫ *}

{capture assign="_component_feature"}
    <div class="s-feature-component" v-bind:data-type="feature.render_type">
        <template v-if="feature.render_type == 'divider'">
            <div class="tablebox space-8">
                <div class="s-column-icon">

                    <template v-if="feature.visible_in_frontend">
                        <div class="wa-tooltip custom js-show-tooltip-on-hover">
                            <span class="s-icon text-gray"><i class="fas fa-eye"></i></span>
                            <div class="tooltip-text" style="width: 15rem;">
                                <p>[`The heading is visible in the storefront.`]</p>
                                <p>{sprintf_wp("You can change this setting in <a href=\"%s\" target=\"_blank\">product types and features</a> setup section.", $_settings_url)}</p>
                            </div>
                        </div>
                    </template>
                    <template v-else>
                        <div class="wa-tooltip custom js-show-tooltip-on-hover">
                            <span class="s-icon is-inactive"><i class="fas fa-eye-slash"></i></span>
                            <div class="tooltip-text" style="width: 15rem;">
                                <p>[`The heading is hidden from the storefront.`]</p>
                                <p>{sprintf_wp("You can change this setting in <a href=\"%s\" target=\"_blank\">product types and features</a> setup section.", $_settings_url)}</p>
                            </div>
                        </div>
                    </template>

                </div>
                <div class="s-column-name wide">
                    <div class="s-divider-title">{ { feature.name } }</div>
                </div>
            </div>
        </template>

        {literal}
        <template v-else-if="feature.render_type == 'field'">
            <div class="s-fields-list flexbox wrap space-12" v-bind:class="{ 'is-triple': feature.options.length === 3, 'is-double': feature.options.length === 2 }">
                <template v-if="feature.available_for_sku && !vertical && product.normal_mode_switch">
                    <component-feature_default_tooltip v-bind:feature="feature"></component-feature_default_tooltip>
                </template>

                <template v-if="isLockedFeature(feature)">
                    <template v-for="(option, index) in feature.options">
                        <div class="s-field-wrapper nowrap"
                                data-tooltip-id="product-feature-used-on-front"
                                v-bind:class="{ 'with-divider': (index + 1 < feature.options.length) }">
                            <input class="small size-short is-disabled" type="text"
                                    v-bind:class="{ 'is-number' : (feature.type === 'double' || (feature.units && feature.units.length)) }"
                                    readonly>
                            <span class="s-divider" v-if="index + 1 < feature.options.length">×</span>
                        </div>
                    </template>

                    <template v-if="feature.units && feature.units.length">
                        <dropdown-units
                            data-tooltip-id="product-feature-used-on-front"
                            v-bind:key="feature.id"
                            v-bind:units="feature.units"
                            v-bind:default_value="feature.active_unit.value"
                            v-bind:disabled="true"></dropdown-units>
                    </template>
                </template>
                <template v-else>
                    <template v-for="(option, index) in feature.options">
                        <div class="s-field-wrapper nowrap" v-bind:class="{ 'with-divider': (index + 1 < feature.options.length) }">
                            <input class="small size-short" type="text"
                                    v-bind:class="{ 'is-number' : (feature.type === 'double' || (feature.units && feature.units.length)) }"
                                    v-model="option.value">
                            <span class="s-divider" v-if="index + 1 < feature.options.length">×</span>
                        </div>
                    </template>

                    <template v-if="feature.units && feature.units.length">
                        <dropdown-units v-bind:key="feature.id" v-bind:units="feature.units" v-bind:default_value="feature.active_unit.value" v-on:change="onChange" v-on:change_unit="feature.active_unit = $event"></dropdown-units>
                    </template>
                </template>
            </div>

            <template v-if="product.normal_mode_switch && feature.available_for_sku && !vertical">
                <component-feature_values_in_modifications v-bind:feature="feature"></component-feature_values_in_modifications>
            </template>
        </template>
        {/literal}

        <template v-else-if="feature.render_type == 'select'">
            <div class="flexbox wrap middle space-12">
                <template v-if="feature.available_for_sku && !vertical && product.normal_mode_switch">
                    <component-feature_default_tooltip v-bind:feature="feature"></component-feature_default_tooltip>
                </template>

                <template v-if="isLockedFeature(feature)">
                    <dropdown-feature-options data-tooltip-id="product-feature-used-on-front" v-bind:feature="feature" v-bind:columns="columns" v-bind:disabled="true"></dropdown-feature-options>
                </template>
                <template v-else>
                    <dropdown-feature-options v-bind:feature="feature" v-bind:columns="columns" v-on:change="onChange"></dropdown-feature-options>

                    <template v-if="feature.can_add_value && feature.show_form">
                        <component-feature-value-form v-bind:feature="feature"></component-feature-value-form>
                    </template>
                </template>
            </div>

            <template v-if="product.normal_mode_switch && feature.available_for_sku && !vertical">
                <component-feature_values_in_modifications v-bind:feature="feature"></component-feature_values_in_modifications>
            </template>
        </template>

        <template v-else-if="feature.render_type == 'checkbox'">
            <div class="flexbox space-12 s-small-text">
                <template v-if="feature.available_for_sku && !vertical && product.normal_mode_switch">
                    <component-feature_default_tooltip v-bind:feature="feature"></component-feature_default_tooltip>
                </template>

                <template v-if="isLockedFeature(feature)">
                    <button class="button is-disabled light-gray small text-blue" data-tooltip-id="product-feature-used-on-front">
                        <span class="s-icon"><i class="fas fa-pen"></i></span>
                        &nbsp;
                        <span class="s-name">[`Select`]</span>
                    </button>
                </template>
                <template v-else-if="product.normal_mode_switch && feature.available_for_sku">
                    <button class="button light-gray small text-blue" data-tooltip-id="product-feature-type-select">
                        <span class="s-icon"><i class="fas fa-pen"></i></span>
                        &nbsp;
                        <span class="s-name">[`Select`]</span>
                    </button>
                </template>
                <template v-else>
                    <div class="s-checkbox-group wide inlinebox space-12">
                        <template v-if="feature.options.filter(option => option.active).length">
                            <template v-for="(option, index) in feature.options">
                                <div class="s-option-wrapper" v-if="option.active">
                                <span class="s-icon" v-if="option.code">
                                    <span class="icon size-16 rounded bordered shift-2" v-bind:style="{ 'background-color': option.code }"></span>
                                    &nbsp;
                                </span>
                                    <span class="s-name">{ { option.name } }</span>
                                </div>
                            </template>
                        </template>
                        <button class="button rounded light-gray small text-blue" v-on:click.prevent="changeFeatureValues(feature)">
                            <span class="s-icon"><i class="fas fa-pen"></i></span>
                            &nbsp;
                            <span class="s-name">[`Select`]</span>
                        </button>

                        <template v-if="feature.options.filter(option => option.active).length > 0">
                            <button class="button rounded light-gray small text-red" v-on:click.prevent="resetFeatureValues(feature)">
                                <span class="s-icon"><i class="fas fa-times"></i></span>
                                &nbsp;
                                <span class="s-name">[`Remove`]</span>
                            </button>
                        </template>
                    </div>
                </template>
            </div>

            <template v-if="product.normal_mode_switch && feature.available_for_sku && !vertical">
                <component-feature_values_in_modifications v-bind:feature="feature"></component-feature_values_in_modifications>
            </template>
        </template>

        <template v-else-if="feature.render_type == 'textarea'">
            <div class="flexbox space-12">
                <template v-if="feature.available_for_sku && !vertical && product.normal_mode_switch">
                    <component-feature_default_tooltip v-bind:feature="feature"></component-feature_default_tooltip>
                </template>

                <div class="s-textarea-wrapper wide">
                    <template v-if="isLockedFeature(feature)">
                        <textarea class="full-width small is-disabled" data-tooltip-id="product-feature-used-on-front" readonly></textarea>
                    </template>
                    <template v-else>
                        <textarea class="full-width small" v-model="feature.value"></textarea>
                    </template>
                </div>
            </div>

            <template v-if="product.normal_mode_switch && feature.available_for_sku && !vertical">
                <component-feature_values_in_modifications v-bind:feature="feature"></component-feature_values_in_modifications>
            </template>
        </template>

        <template v-else-if="feature.render_type == 'range'">
            <div class="flexbox wrap space-12">
                <template v-if="feature.available_for_sku && !vertical && product.normal_mode_switch">
                    <component-feature_default_tooltip v-bind:feature="feature"></component-feature_default_tooltip>
                </template>

                <template v-for="(option, index) in feature.options">
                    <div class="s-field-wrapper" v-bind:class="{ 'with-divider': (index + 1 < feature.options.length) }">
                        <input class="small size-short is-number" type="text" v-model="option.value">
                        <span class="s-divider" v-if="index + 1 < feature.options.length">—</span>
                    </div>
                </template>

                <template v-if="feature.units && feature.units.length">
                    <dropdown-units v-bind:key="feature.id" v-bind:units="feature.units" v-bind:default_value="feature.active_unit.value" v-on:change_unit="feature.active_unit = $event"></dropdown-units>
                </template>
            </div>

            <template v-if="product.normal_mode_switch && feature.available_for_sku && !vertical">
                <component-feature_values_in_modifications v-bind:feature="feature"></component-feature_values_in_modifications>
            </template>
        </template>

        <template v-else-if="feature.render_type == 'range.date'">
            <div class="flexbox wrap space-12">
                <template v-if="feature.available_for_sku && !vertical && product.normal_mode_switch">
                    <component-feature_default_tooltip v-bind:feature="feature"></component-feature_default_tooltip>
                </template>

                <template v-for="(option, index) in feature.options">
                    <div class="s-field-wrapper" v-bind:class="{ 'with-divider': (index + 1 < feature.options.length) }">
                        <date-picker v-model="option.value" v-on:change="onChange"></date-picker>
                        <span class="s-divider" v-if="index + 1 < feature.options.length">—</span>
                    </div>
                </template>
            </div>

            <template v-if="product.normal_mode_switch && feature.available_for_sku && !vertical">
                <component-feature_values_in_modifications v-bind:feature="feature"></component-feature_values_in_modifications>
            </template>
        </template>

        <template v-else-if="feature.render_type == 'field.date'">
            <div class="flexbox wrap space-12">
                <template v-if="feature.available_for_sku && !vertical && product.normal_mode_switch">
                    <component-feature_default_tooltip v-bind:feature="feature"></component-feature_default_tooltip>
                </template>

                <template v-if="isLockedFeature(feature)">
                    <date-picker data-tooltip-id="product-feature-used-on-front" v-bind:disabled="true"></date-picker>
                </template>
                <template v-else>
                    <date-picker v-model="feature.options[0].value" v-on:change="onChange"></date-picker>
                </template>
            </div>

            <template v-if="product.normal_mode_switch && feature.available_for_sku && !vertical">
                <component-feature_values_in_modifications v-bind:feature="feature"></component-feature_values_in_modifications>
            </template>
        </template>

        <template v-else-if="feature.render_type == 'color'">
            <div class="flexbox wrap space-12">
                <template v-if="feature.available_for_sku && !vertical && product.normal_mode_switch">
                    <component-feature_default_tooltip v-bind:feature="feature"></component-feature_default_tooltip>
                </template>


                <template v-if="isLockedFeature(feature)">
                    <div class="s-field-wrapper" data-tooltip-id="product-feature-used-on-front">
                        <input type="text" placeholder="[`Value`]" class="small size-short is-disabled" readonly>
                    </div>
                    <div class="vue-component-color-picker is-disabled" data-tooltip-id="product-feature-used-on-front">
                        <div class="inlinebox space-6 middle nowrap">
                            <input type="text" class="small size-color" readonly>
                            <span class="s-icon"><span class="icon size-20 rounded s-color-toggle"></span></span>
                        </div>
                    </div>
                </template>
                <template v-else>
                    <component-feature-color v-bind:feature="feature" v-bind:vertical="vertical" v-on:change="onChange"></component-feature-color>
                </template>
            </div>

            <template v-if="product.normal_mode_switch && feature.available_for_sku && !vertical">
                <component-feature_values_in_modifications v-bind:feature="feature"></component-feature_values_in_modifications>
            </template>
        </template>
    </div>
{/capture}
{$_templates["component-feature"] = $_component_feature|strip}

{capture assign="_component_feature_color"}
{literal}
    <div class="flexbox wrap space-12">
        <div class="s-field-wrapper">
            <input
                class="small size-short"
                type="text"
                v-model="feature.options[0].value"
                v-on:input="colorNameChange"
                placeholder="[`Value`]">
        </div>

        <component-feature-color-picker
            v-bind:data="feature.options[0]"
            v-bind:property="'code'"
            v-on:input="colorChange"></component-feature-color-picker>
    </div>
{/literal}
{/capture}
{$_templates["component-feature-color"] = $_component_feature_color}

{capture assign="_component_feature_default_tooltip"}
    <div class="s-feature-default-tooltip" v-bind:class="{ 'middle' : ['textarea', 'checkbox'].indexOf(feature.render_type) < 0 }">
        <span class="s-label">[`By default`]</span>

        <div class="wa-tooltip custom top">
            <i class="fas fa-question-circle s-icon gray"></i>
            <div class="tooltip-text">
                [`Default values are applied to SKU variants if other values have not been saved in variants’ properties.`]
            </div>
        </div>
    </div>
{/capture}
{$_templates["component-feature_default_tooltip"] = $_component_feature_default_tooltip}

{capture assign="_component_feature_values_in_modifications"}
    <div class="s-feature-values-in-modifications">
        <span class="s-label">[`In variants`]</span>
        <span class="cursor-pointer link" v-on:click.prevent="showFeatureUsedValuesDialog(feature)">[`Show values`]</span>
    </div>
{/capture}
{$_templates["component-feature_values_in_modifications"] = $_component_feature_values_in_modifications}

{capture assign="_component_features"}
    <div class="s-features-list fields space-24" v-bind:class="{ 'vertical': vertical, 'two-columns': columns }">
        <div class="s-feature-wrapper field" v-for="(feature, key) in features" v-bind:data-id="feature.id">
            <div class="name" v-if="feature.render_type !== 'divider'" v-bind:class="{ 'unshifted': ['divider', 'checkbox'].indexOf(feature.render_type) < 0 }">

                <div class="s-feature-details tablebox space-8">
                    <template v-if="!vertical">
                        <div class="s-column-icon" v-if="feature.internal">
                            <template v-if="vertical">
                                <template v-if="feature.visible_in_frontend">
                                    <span class="s-icon"><i class="fas fa-eye"></i></span>
                                </template>
                                <template v-else>
                                    <span class="s-icon is-inactive"><i class="fas fa-eye-slash"></i></span>
                                </template>
                            </template>

                            <template v-else>
                                <template v-if="feature.visible_in_frontend">
                                    <div class="wa-tooltip custom js-show-tooltip-on-hover">
                                        <span class="s-icon"><i class="fas fa-eye"></i></span>
                                        <div class="tooltip-text" style="width: 15rem;">
                                            <p>[`The feature is visible in the storefront.`]</p>
                                            <p>{sprintf_wp("You can change this setting in <a href=\"%s\" target=\"_blank\">product types and features</a> setup section.", $_settings_url)}</p>
                                        </div>
                                    </div>
                                </template>
                                <template v-else>
                                    <div class="wa-tooltip custom js-show-tooltip-on-hover">
                                        <span class="s-icon is-inactive"><i class="fas fa-eye-slash"></i></span>
                                        <div class="tooltip-text" style="width: 15rem;">
                                            <p>[`The feature is hidden from the storefront.`]</p>
                                            <p>{sprintf_wp("You can change this setting in <a href=\"%s\" target=\"_blank\">product types and features</a> setup section.", $_settings_url)}</p>
                                        </div>
                                    </div>
                                </template>
                            </template>
                        </div>
                        <div class="s-column-icon" v-else>

                            <div class="wa-tooltip custom js-show-tooltip-on-hover">
                                <span class="s-icon text-orange"><i class="fas fa-exclamation-triangle"></i></span>
                                <div class="tooltip-text" style="width: 15rem;">
                                    <p>[`This feature is not visible in the storefront because it is not selected for the product type to which this product belongs. Delete this feature value if you want to remove it from this product.`]</p>
                                    <p>{sprintf_wp("You can change this setting in <a href=\"%s\" target=\"_blank\">product types and features</a> setup section.", $_settings_url)}</p>
                                </div>
                            </div>

                        </div>
                    </template>
                    <div class="s-column-icon">

                        <template v-if="vertical">
                            <template v-if="feature.available_for_sku">
                                <span class="s-icon icon"><svg><use xlink:href='{$_sprite_url}#sitemap'></use></svg></span>
                            </template>
                            <template v-else>
                                <span class="s-icon icon is-inactive"><svg><use xlink:href='{$_sprite_url}#sitemap-slash'></use></svg></span>
                            </template>
                        </template>

                        <template v-else>
                            <template v-if="feature.available_for_sku">
                                <div class="wa-tooltip custom js-show-tooltip-on-hover">
                                    <span class="s-icon icon"><svg><use xlink:href='{$_sprite_url}#sitemap'></use></svg></span>
                                    <div class="tooltip-text" style="width: 15rem;">
                                        <p>[`You can save this feature’s values for SKU variants. If no value has been saved for a variant, then a default value specified here is used.`]</p>
                                        <p>{sprintf_wp("You can change this setting in <a href=\"%s\" target=\"_blank\">product types and features</a> setup section.", $_settings_url)}</p>
                                    </div>
                                </div>
                            </template>
                            <template v-else>
                                <div class="wa-tooltip custom js-show-tooltip-on-hover">
                                    <span class="s-icon icon is-inactive"><svg><use xlink:href='{$_sprite_url}#sitemap-slash'></use></svg></span>
                                    <div class="tooltip-text" style="width: 15rem;">
                                        <p>[`A feature value for entire product.`]</p>
                                        <p>{sprintf_wp("You can change this setting in <a href=\"%s\" target=\"_blank\">product types and features</a> setup section.", $_settings_url)}</p>
                                    </div>
                                </div>
                            </template>
                        </template>

                    </div>
                    <div class="s-column-name wide">
                        <span class="s-counter" v-if="columns">{ { key + 1 } }.</span>
                        <span class="s-name">{ { feature.name } }</span>
                    </div>
                </div>

            </div>
            <div class="value">

                <div class="s-feature-component-wrapper">
                    <component-feature v-bind:product="product" v-bind:feature="feature" v-bind:value="111" v-bind:vertical="vertical" v-bind:columns="columns" v-on:change="onChange" v-bind:key="feature.id"></component-feature>
                </div>

            </div>
        </div>
    </div>
{/capture}
{$_templates["component-features"] = $_component_features|strip}

{capture assign="_dropdown_currency"}
{literal}
    <div class="dropdown" v-bind:class="{ 'wide': prop_wide }">
        <button class="button dropdown-toggle light-gray small" type="button">{ { currency_code } }</button>
        <div class="dropdown-body right" style="width: 6rem;">
            <div class="dropdown-item"
                v-for="currency in currencies"
                v-bind:key="currency.code"
                v-bind:data-id="currency.code"
                v-bind:class="{ 'selected': currency.code === currency_code }"
                v-bind:title="currency.title">{ { currency.code } }</div>
        </div>
    </div>
{/literal}
{/capture}
{$_templates["component-dropdown-currency"] = $_dropdown_currency}

{capture assign="_dropdown_feature_options"}
    <div class="dropdown s-dropdown-feature-options" v-bind:class="{ 'wide': columns, 'is-disabled' : prop_disabled }" v-show="!feature.show_form">
        <button type="button" class="button dropdown-toggle light-gray small">
            <span class="s-icon">
                <template v-if="feature.active_option.code">
                    <span class="icon size-12 rounded bordered shift-2" v-bind:style="{ 'background-color': feature.active_option.code }"></span>
                </template>
            </span>
            &nbsp;
            <span class="s-name">{ { prop_disabled ? {_w("Not defined")|json_encode}: feature.active_option.name } }</span>
        </button>
        <div class="dropdown-body">
            <div class="dropdown-filter js-dropdown-filter" v-show="feature.options.length > 5">
                <div class="s-actions left">
                    <div class="s-action js-apply"><i class="fas fa-search"></i></div>
                </div>
                <input class="s-field js-field" type="text" value="">
            </div>

            <template v-for="option in feature.options" v-bind:key="option.code">
                <div class="dropdown-item js-set-dropdown-item" v-bind:class="{ 'selected': option.value === feature.active_option.value }" v-bind:data-value="option.value">
                    <span class="s-icon" v-if="option.code">
                        <span class="icon size-12 rounded bordered shift-2" v-bind:style="{ 'background-color': option.code }"></span>
                    </span>
                    &nbsp;
                    <span class="s-name">{ { option.name } }</span>
                </div>
            </template>
            <div class="dropdown-item" v-if="feature.can_add_value" v-on:click.prevent="feature.show_form = true">[`Add a new value`]</div>
            <div class="dropdown-item" v-if="!feature.can_add_value && feature.type !== 'boolean'" style="cursor: default;">
                <span class="hint">[`A new value can be specified in the common feature list at the page bottom.`]</span>
            </div>
        </div>
    </div>
{/capture}
{$_templates["dropdown-feature-options"] = $_dropdown_feature_options}

{capture assign="_component_date_picker"}
    <div class="vue-component-date-picker" v-bind:class="{ 'is-disabled': disabled }">
        <input class="s-field small size-short js-date-picker" type="text" value="" v-bind:readonly="prop_disabled">
        <span class="s-icon"><i class="fas fa-calendar-alt"></i></span>
        <input name="" type="hidden" value="">
    </div>
{/capture}
{$_templates["component-date-picker"] = $_component_date_picker|strip}

{capture assign="_component_feature_color_picker"}
    <div class="vue-component-color-picker" v-bind:class="{ 'is-extended': extended }">
        <div class="inlinebox space-6 middle nowrap">
            <input class="small size-color js-color-field" type="text" placeholder="#000000" v-bind:value="data[property]">
            <span class="s-icon"><span class="icon size-20 rounded s-color-toggle js-color-toggle" v-bind:style="{ 'background-color': data[property] }"></span></span>
        </div>
        <div class="s-color-picker js-color-picker" v-show="extended"></div>
    </div>
{/capture}
{$_templates["component-feature-color-picker"] = $_component_feature_color_picker|strip}

{capture assign="_component_switch"}
    <div class="switch small">
        <input type="checkbox" v-bind:id="prop_id" v-bind:checked="prop_checked" v-bind:disabled="prop_disabled">
    </div>
{/capture}
{$_templates["component-switch"] = $_component_switch|strip}

{capture assign="_component_dropdown_units"}
    <div class="dropdown s-dropdown-units" v-bind:class="{ 'is-disabled' : prop_disabled }">
        <button class="button dropdown-toggle light-gray small" type="button">{ { prop_disabled ? "{_w("Not defined")|escape}" : active_unit.name } }</button>
        <div class="dropdown-body right" style="width: 6rem;">
            <template v-for="unit in units" v-bind:key="unit.id">
                <div class="dropdown-item" v-bind:class="{ 'selected': unit.value === active_unit.value }" v-bind:data-value="unit.value" v-bind:title="unit.name">{ { unit.name } }</div>
            </template>
        </div>
    </div>
{/capture}
{$_templates["component-dropdown-units"] = $_component_dropdown_units|strip}

{capture assign="_component_feature_value_form"}
{literal}
    <div class="s-component-feature-value-form">
        <div class="flexbox middle space-8">
            <input class="small js-field" type="text"
                    v-bind:class="{ 'is-number' : (feature.units && feature.units.length) }"
                    v-model="feature.form.value" v-on:input="colorNameChange" placeholder="[`Value`]" required>

            <template v-if="feature.type === 'color'">
                <component-feature-color-picker v-bind:data="feature.form" v-bind:property="'code'" v-on:input="colorChange"></component-feature-color-picker>
            </template>

            <template v-if="feature.units && feature.units.length">
                <dropdown-units
                    v-bind:key="feature.id"
                    v-bind:units="feature.units"
                    v-bind:default_value="feature.default_unit"
                    v-on:change_unit="changeFormUnit"></dropdown-units>
            </template>

            <button class="small button js-submit-button" type="button" v-bind:disabled="is_locked" v-on:click.prevent="submitForm">

                <span class="s-icon icon top" v-show="!is_locked"><i class="fas fa-check"></i></span>
                <span class="s-icon icon top" v-show="is_locked"><i class="fas fa-spinner fa-spin"></i></span>
            </button>

            <button class="small button top gray js-cancel" type="button" v-on:click.prevent="closeForm">
                <span class="icon top"><i class="fas fa-times"></i></span>
            </button>
        </div>
    </div>
{/literal}
{/capture}
{$_templates["component-feature-value-form"] = $_component_feature_value_form|strip}

{capture assign="_add_feature_value_form"}
    <div class="s-add-feature-value-form js-add-feature-value-form">
        <div class="flexbox middle space-8">
            <input class="small js-field" type="text" placeholder="{_w("Enter a value")|escape}" required>
            <button class="small button js-submit-button" type="button">
                <span class="s-icon icon top"><i class="fas fa-check"></i></span>
            </button>
            <button class="small button top gray js-cancel" type="button">
                <span class="icon top"><i class="fas fa-times"></i></span>
            </button>
        </div>
    </div>
{/capture}
{$_templates["add-feature-value-form"] = $_add_feature_value_form|strip}

{capture assign="_component_file_manager"}
{literal}
    <div class="component-file-manager">
        <div class="s-load-wrapper" v-if="!sku_mod.file.id">
            <div class="s-button-wrapper" v-if="!files_to_upload.length">
                <button class="button smaller gray" type="button">
                    <span class="s-icon"><i class="fas fa-upload"></i></span>
                    &nbsp;
                    <span class="s-name">[`Upload file`]</span>
                </button>
                <input class="js-file-field cursor-pointer" type="file" v-on:change="onFileChange($event)" title="">
            </div>

            <div class="s-loading-wrapper" v-if="files_to_upload.length">
                <template v-for="file_to_upload in files_to_upload">
                    <component-loading-file v-bind:file="file_to_upload"
                                            v-bind:sku_mod="sku_mod"
                                            v-on:file_load_fail="onFileLoadFail"
                                            v-on:file_load_success="onFileLoadSuccess"></component-loading-file>
                </template>
            </div>

            <template v-if="errors.length">
                <div class="state-error-hint" v-for="error in errors">{ { error.text } }</div>
            </template>
        </div>

        <div class="s-file-wrapper flexbox middle space-16 wrap baseline" v-if="sku_mod.file.id">
            <a class="s-file-url" v-bind:href="file.url" target="_blank" download>
                <span class="s-icon"><i class="fas fa-download"></i></span>
                &nbsp;
                <span class="s-name" v-text="file.name"></span>
            </a>

            <div class="s-file-size" v-text="file.size"></div>

            <div class="s-file-delete small text-red" v-on:click.prevent="fileDelete">
                <span class="s-icon"><i class="fas fa-trash-alt"></i></span>
                &nbsp;
                <span class="s-name">[`Delete`]</span>
            </div>
        </div>

        <div class="s-hint-wrapper">
            <p class="hint">[`A link to download the file will be sent to a customer in an order notification and will be valid only after payment. A convenient delivery method for digital products.`]</p>
        </div>

        <div class="s-description-wrapper" v-if="sku_mod.file.id">
            <div class="s-title">[`Comment to attached file (optional):`]</div>
            <component-flex-textarea v-bind:class="'wide small'" v-model="sku_mod.file.description"></component-flex-textarea>
        </div>
    </div>
{/literal}
{/capture}
{$_templates["component-file-manager"] = $_component_file_manager|strip}

{capture assign="_sku_file_delete_confirm_dialog"}{include file="./dialogs/sku_file_delete_confirm.html" inline}{/capture}
{$_templates["sku-file-delete-confirm-dialog"] = $_sku_file_delete_confirm_dialog|strip}

{/strip}

{capture assign="_component_plugin_price"}
    <div class="field s-field-plugin-price"
         v-bind:class="field.css_class">
        <div class="name">
            <span class="s-name">{ { field.name } }</span>
            <span class="s-tooltip"
                  v-if="field.tooltip"
                  v-bind:data-tooltip-id="'plugin-tooltip-' + field.id"><i class="fas fa-question-circle text-light-gray"></i></span>
        </div>
        <div class="value">
            <input class="small is-number" type="text"
                   v-model="field.value"
                   v-bind:class="{ 'state-error' : error }"
                   v-on:input="onInput">

            <div class="state-error-hint" v-if="error">
                { { error.text } }
                <span class="s-tooltip-icon" data-tooltip-id="price-error">
                    <i class="fas fa-question-circle text-red"></i>
                </span>
            </div>
        </div>
    </div>
{/capture}
{$_templates["component-plugin-price"] = $_component_plugin_price|strip}

{capture assign="_component_plugin_field"}
    <div class="field s-field-plugin-field"
         v-bind:class="field.css_class">
        <div class="name">
            <span class="s-name">{ { field.name } }</span>
            <span class="s-tooltip"
                  v-if="field.tooltip"
                  v-bind:data-tooltip-id="'plugin-tooltip-' + field.id"><i class="fas fa-question-circle text-light-gray"></i></span>
        </div>
        <div class="value">

            <template v-if="field.render_type === 'custom_html'">
                <div v-html="field.value"></div>
            </template>
            <template v-if="field.render_type === 'field'">
                <input class="small size-short" type="text"
                       v-model="field.value"
                       v-bind:class="{ 'state-error' : error }"
                       v-on:input="validate">
            </template>
            <template v-else-if="field.render_type === 'textarea'">
                <component-plugin-textarea
                    class="small wide"
                    v-model="field.value"
                    v-bind:field="errors"
                    v-bind:class="{ 'state-error' : error }"
                    v-on:input="validate"></component-plugin-textarea>
            </template>
            <template v-else-if="field.render_type === 'select'">
                <component-plugin-dropdown
                    v-bind:field="field"
                    v-bind:sku_mod="sku_mod"
                    v-bind:errors="errors"
                    v-on:change="validate"></component-plugin-dropdown>
            </template>

            <div class="state-error-hint" v-if="error">{ { error.text } }</div>
        </div>
    </div>
{/capture}
{$_templates["component-plugin-field"] = $_component_plugin_field|strip}

{capture assign="_component_plugin_dropdown"}
    <div class="dropdown s-dropdown-units">
        <button class="button dropdown-toggle light-gray small" type="button"
                v-bind:class="{ 'state-error' : error }">{ { field.active_option ? (field.active_option.name || "&nbsp;") : "{_w("Not defined")|escape}" } }</button>
        <div class="dropdown-body">
            <template v-for="option in field.options">
                <div class="dropdown-item"
                     v-bind:class="{ 'selected': (field.active_option ? (field.active_option.value === option.value) : false) }"
                     v-bind:data-value="option.value">{ { option.name ? option.name : '&nbsp;' } }</div>
            </template>
        </div>
    </div>
{/capture}
{$_templates["component-plugin-dropdown"] = $_component_plugin_dropdown|strip}

<div id="js-product-sku-section-wrapper">
    <div class="s-product-sku-section js-product-sku-section article wider" style="visibility: hidden;">
        <!-- plugin hook: 'backend_prod_content.top' -->
        {* @event backend_prod_content.%plugin_id%.top *}
        {if !empty($backend_prod_content_event)}{foreach $backend_prod_content_event as $_}{ifset($_.top)}{/foreach}{/if}

        {* <div class="s-section-header"></div> *}
        <div class="s-section-body">
            {* PRODUCT OPTIONS *}
            <div class="s-fields-section" id="js-plugin-fields-place">
                <div class="fields space-24">
                    {* TYPE *}
                    <div class="field">
                        <div class="name">
                            <div class="wa-label">
                                <span class="s-name">[`Product type`]</span>
                                <span class="wa-tooltip right" data-title="{_w("Each product type; e.g., “TVs”, “Phones”, or “Clocks”, can have its own set of features. You can decide which product types to make visible in a storefront. Separate access rights to product types can be set up for store backend users and user groups.")|escape}">
                                    <i class="fas fa-question-circle s-icon gray"></i>
                                </span>
                            </div>
                        </div>
                        <div class="value">
                            <div class="s-product-type-section">
                                {if !empty($product_types[$product["type_id"]])}
                                    {$active_product_type = $product_types[$product["type_id"]]}

                                    {strip}
                                    <div class="s-name-wrapper">
                                        {if !empty($active_product_type.icon)}
                                            <span class="s-icon text-gray">{$wa->shop->getIcon($active_product_type.icon, 'box')}</span>
                                        {/if}
                                        <span class="s-name">{$active_product_type.name|escape}</span>
                                    </div>
                                    {/strip}

                                    <div class="hint">{_w("You can change the product type under the “Basic data” tab.")}</div>

                                {else}
                                    <div class="text-red">[`Error: product type does not exist.`]</div>
                                {/if}
                            </div>

                        </div>
                    </div>

                    {* PLUGIN PLACE *}

                    <!-- plugin hook: 'backend_prod_content.form_top' -->
                    {* @event backend_prod_content.%plugin_id%.form_top *}
                    {if !empty($backend_prod_content_event)}{foreach $backend_prod_content_event as $_}{ifset($_.form_top)}{/foreach}{/if}

                    <!-- plugin hook: 'backend_prod_content.form_bottom' -->
                    {* @event backend_prod_content.%plugin_id%.form_bottom *}
                    {if !empty($backend_prod_content_event)}{foreach $backend_prod_content_event as $_}{ifset($_.form_bottom)}{/foreach}{/if}

                    {* SKU ADVANCE MODE *}
                    <div class="field">
                        <div class="name unshifted">

                            <div class="wa-label">
                                <span class="s-name">[`The product contains several SKUs or variants`]</span>
                                <span class="wa-tooltip right" data-title="{_w("Enable to offer customers several versions of the product.")|escape}">
                                    <i class="fas fa-question-circle s-icon gray"></i>
                                </span>
                            </div>

                        </div>
                        <div class="value s-small-text">

                            <div class="s-advanced-sku-mode-switch js-advanced-sku-mode-switch flexbox middle space-10">

                                <template v-if="has_features_values">
                                    <component-advanced-sku-mode
                                        v-bind:key="'switch-locked'"
                                        v-bind:input_id="'has_features_values'"
                                        v-bind:product="product"
                                        v-bind:locked="true"></component-advanced-sku-mode>
                                </template>
                                <template v-else>
                                    <component-advanced-sku-mode
                                        v-bind:key="'switch-active'"
                                        v-bind:input_id="'has_features_values'"
                                        v-bind:product="product"
                                        v-on:change="changeMinimalModeSwitch"></component-advanced-sku-mode>
                                </template>
                                <label for="has_features_values"><div class="s-status custom-ml-8">{ { product.normal_mode_switch ? {_w("Enabled")|json_encode} : {_w("Disabled")|json_encode} } }</div></label>
                            </div>
                        </div>
                    </div>

                    {* PRODUCT VARIANTS CHOISE *}
                    <div class="field" v-if="product.normal_mode_switch">
                        <div class="name">

                            <div class="wa-label">
                                <span class="s-name">[`Product variety selection in the storefront`]</span>
                                <span class="wa-tooltip right" data-title="{_w("How product varieties should be offered to customers in the storefront.")|escape}">
                                    <i class="fas fa-question-circle s-icon gray"></i>
                                </span>
                            </div>

                        </div>
                        <div class="value small shift-5">
                            <div class="wa-list space-8">
                                {foreach $product_sku_types as $_sku_type}
                                    <div class="s-list-item">
                                        <label>
                                            <span class="wa-radio baseline shift-2">
                                                <input type="radio" value="{$_sku_type.id|escape}" v-on:change="changeSkuType" v-model="product.sku_type">
                                                <span></span>
                                            </span>
                                            <span class="s-name">{$_sku_type.name|escape}</span>
                                        </label>
                                    </div>
                                {/foreach}
                            </div>

                        </div>
                    </div>

                    {* SKU FOR FRONT SELECT *}
                    <div class="field" v-if="product.normal_mode_switch">
                        <div class="name shift-6">

                            <div class="wa-label">
                                <span class="s-name" v-bind:class="{ 'text-red' : front_features_empty }">[`Features used for product variety selection in the storefront`]</span>
                                <span class="wa-tooltip right"
                                        v-bind:data-tooltip-id="(front_features_empty ? 'product-sku-front-features-2' : 'product-sku-front-features-1')">
                                    <span class="s-icon" v-bind:class="{ 'text-red' : front_features_empty, 'text-gray' : !front_features_empty }">
                                        <i class="fas fa-question-circle"></i>
                                    </span>
                                </span>
                            </div>
                            <div class="state-error-hint" v-if="errors['front_features_empty']"></div>

                        </div>
                        <div class="value s-small-text">

                            {strip}
                            <div class="s-selected-sku-features-section tablebox inline middle space-12">
                                <div class="s-features-wrapper inlinebox space-8" v-if="!front_features_empty">
                                    <span class="s-icon"><i class="fas fa-sitemap gray"></i></span>
                                    <div class="s-features-list inlinebox space-4">
                                        <template v-for="feature in selectable_features" v-bind:key="feature.id">
                                            <span class="s-feature" v-if="feature.active" v-bind:id="feature.id">{ { feature.name } }</span>
                                        </template>
                                    </div>
                                </div>

                                <div>
                                    <button class="button light-gray rounded" type="button" v-on:click.prevent="changeSelectableFeatures">
                                        <span class="s-icon" v-show="states.load.selectable_features">
                                            <i class="fas fa-spinner fa-spin"></i>
                                        </span>
                                            <span class="s-icon" v-show="!states.load.selectable_features">
                                            <i class="fas fa-pen text-blue"></i>
                                        </span>
                                        &nbsp;
                                        <span class="s-name" v-if="selectable_features.filter(feature => feature.active).length">[`Change`]</span>
                                        <span class="s-name" v-if="!selectable_features.filter(feature => feature.active).length">[`Add`]</span>
                                    </button>
                                </div>

                                {capture assign="_select_selectable_features_dialog"}{include file="./dialogs/select_sku_feature.html" inline}{/capture}
                                {$_templates["dialog_select_selectable_features"] = $_select_selectable_features_dialog|strip}
                            </div>
                            {/strip}

                        </div>
                    </div>
                </div>
            </div>

            {* SKU/MODIFICATIONS *}
            <div class="s-sku-modifications-section" id="js-sku-modifications-section">
                <div class="s-section-header tablebox middle custom-pb-0" v-if="product.normal_mode_switch">

                    <div class="column wide">
                        <button class="button light-gray rounded small" type="button"
                                v-on:click.prevent="addSKU">
                            <span class="s-icon text-green"><i class="fas fa-plus-circle"></i></span>
                            <span class="s-name">[`Add an SKU`]</span>
                        </button>

                        <button class="button light-gray rounded small" type="button"
                                data-tooltip-id="product-mass-sku-generation"
                                v-on:click="massSkuGeneration">
                            <span class="s-icon text-blue"><i class="fas fa-th"></i></span>
                            <span class="s-name">[`Generate multiple SKUs`]</span>
                        </button>
                    </div>
                    <div class="column">

                        <component-toggle v-bind:options="product.view_types" v-bind:active="product.view_type_id" v-on:change="changeViewType" v-once>
                            {capture assign="_component_toggle"}
                                <div class="toggle">
                                    <span v-for="option in options"
                                          v-bind:class="{ 'selected': (option.id === active) }"
                                          v-bind:data-id="option.id"
                                          v-html="option.html"></span>
                                </div>
                            {/capture}
                            {$_templates["component-toggle"] = $_component_toggle|strip}
                        </component-toggle>

                    </div>
                </div>

                <div class="s-section-body" v-if="product.skus.length">
                    <div class="fields vertical">
                        <div class="s-sku-section fields-group blank" v-for="(sku, sku_index) in product.skus"
                            v-bind:data-index="sku_index"
                            v-bind:data-view="product.view_type_id">

                           <div class="s-sku-wrapper" v-bind:class="{ 'is-highlighted' : sku.states.highlight, 'has-error' : (sku.states.error || !checkSku(sku)) }">

                               <div class="s-sku-table tablebox fixed">
                                   <div class="s-column-move-actions middle custom-pr-16 text-gray" v-if="product.normal_mode_switch">
                                       <span class="s-action"
                                             data-tooltip-id="product-sku-1"
                                             v-bind:class="{ 'disabled': (sku_index === 0), 'cursor-pointer': (sku_index !== 0) }"
                                             v-on:click.prevent="moveSKU(true, sku, sku_index)">
                                           <i class="icon size-20"><svg><use xlink:href='{$_sprite_url}#arrow-up'></use></svg></i>
                                       </span>
                                       <span class="s-action"
                                             data-tooltip-id="product-sku-2"
                                             v-bind:class="{ 'disabled': (sku_index === product.skus.length -1), 'cursor-pointer': (sku_index < product.skus.length - 1)}"
                                             v-on:click.prevent="moveSKU(false, sku, sku_index)">
                                           <i class="icon size-20"><svg><use xlink:href='{$_sprite_url}#arrow-down'></use></svg></i>
                                       </span>
                                   </div>

                                   <div class="s-column-view-actions middle custom-pr-24">
                                       {strip}
                                       <div class="s-actions nowrap">
                                           <template v-if="product.normal_mode_switch">
                                               <button class="button circle light-gray" v-on:click.prevent="skuMainToggle(sku, sku_index);"
                                                   v-bind:data-tooltip-id="(product.sku_id === sku.sku_id ? 'product-sku-13': 'product-sku-14')">

                                                   <span class="s-icon" v-bind:class="{ 'text-orange': product.sku_id === sku.sku_id, 'text-light-gray': product.sku_id !== sku.sku_id }"><i class="fas fa-check-circle"></i></span>
                                               </button>

                                               <template v-if="checkSku(sku)">
                                                   <button class="button circle light-gray" v-on:click.prevent="skuStatusToggle(sku, sku_index)"
                                                           v-on:click.prevent="skuStatusToggle(sku, sku_index)"
                                                           v-bind:title="getSkuModStatusTitle(sku, ['{_w("SKU is not visible in the storefront.")|escape}', '{_w("Some SKU variants are not visible in the storefront.")|escape}', '{_w("All SKU modifications are visible in the storefront.")|escape}'])">
                                                       <span class="s-icon text-blue" v-show="sku.modifications.filter(sku_mod => sku_mod.status).length"><i class="fas fa-eye"></i></span>
                                                       <span class="s-icon text-light-gray" v-show="!sku.modifications.filter(sku_mod => sku_mod.status).length"><i class="fas fa-eye-slash"></i></span>
                                                   </button>
                                               </template>
                                               <template v-else>
                                                   <button class="button circle light-gray" v-bind:data-tooltip-id="getSkuStatusTooltip(sku)">
                                                       <span class="s-icon text-red"><i class="fas fa-exclamation-circle"></i></span>
                                                   </button>
                                               </template>
                                           </template>
                                           <button class="button circle light-gray"
                                                   v-on:click.prevent="skuAvailableToggle(sku, sku_index)"
                                                   v-bind:data-tooltip-id="getSkuModAvailableTitle(sku, ['product-sku-21', 'product-sku-22', 'product-sku-23'])">

                                               <span class="s-icon icon top size-18 text-green" v-if="getSkuModAvailableState(sku, 'all')"><svg><use xlink:href='{$_sprite_url}#cart'></use></svg></span>
                                               <span class="s-icon icon top size-18 text-light-gray" v-if="getSkuModAvailableState(sku, 'part')"><svg><use xlink:href='{$_sprite_url}#cart'></use></svg></span>
                                               <span class="s-icon icon top size-18 text-light-gray" v-if="getSkuModAvailableState(sku, 'none')"><svg><use xlink:href='{$_sprite_url}#cart-slash'></use></svg></span>
                                           </button>
                                       </div>
                                       {/strip}
                                   </div>

                                   <div class="s-column-details">
                                       {strip}
                                       <div class="fields custom-columns vertical">
                                           <div class="field">
                                               <div class="name">
                                                   [`SKU code`]<span class="s-label-hint" v-if="!product.normal_mode_switch">&nbsp;([`optional`])</span>
                                               </div>
                                               <div class="value">
                                                   <input type="text" class="small"
                                                       v-model="sku.sku"
                                                       v-bind:class="{ 'state-error': !!sku.errors['sku.sku'] }"
                                                       v-on:change="changeSkuSku(sku, sku_index)">

                                                   <div class="s-errors-place" v-if="product.normal_mode_switch && (sku.errors['sku_required'] || sku.errors['sku_unique'])">
                                                       <div class="state-error-hint" v-if="sku.errors['sku_required']">{ { sku.errors['sku_required'].text } }</div>
                                                       <div class="state-error-hint" v-if="sku.errors['sku_unique']">{ { sku.errors['sku_unique'].text } }</div>
                                                   </div>
                                               </div>
                                           </div>
                                           <div class="field" v-if="product.normal_mode_switch">
                                               <div class="name">[`SKU name`]</div>
                                               <div class="value">

                                                   <component-sku-name-textarea v-bind:sku="sku" v-on:input="changeSkuName(sku, sku_index)">
                                                        {capture assign="_component_sku_name_textarea"}
                                                            {literal}
                                                            <textarea
                                                                v-model="sku.name"
                                                                rows="1"
                                                                class="full-width small js-toggle-height"
                                                                style="height: auto;"
                                                                v-on:change="$emit('change')"
                                                                v-on:input="$emit('input')"
                                                            ></textarea>
                                                           {/literal}
                                                        {/capture}
                                                        {$_templates["component-sku-name-textarea"] = $_component_sku_name_textarea}
                                                   </component-sku-name-textarea>

                                               </div>
                                           </div>
                                       </div>
                                       {/strip}
                                   </div>

                                   <div class="s-column-actions tablebox" v-if="product.normal_mode_switch">
                                       {strip}
                                       <div class="s-actions">
                                           <button class="button small light-gray text-gray" data-tooltip-id="product-sku-3" v-on:click.prevent="copySKU(sku, sku_index)">
                                               <span class="icon size-14"><i class="fas fa-copy"></i></span>
                                           </button>
                                           <button class="custom-mt-4 button small light-gray text-red"
                                               data-tooltip-id="product-sku-4"
                                               v-if="product.skus.length > 1"
                                               v-on:click.prevent="removeSKU($event, sku, sku_index)">
                                               <span class="s-icon icon size-16">
                                                   <svg><use xlink:href='{$_sprite_url}#trash-alt'></use></svg>
                                               </span>
                                           </button>
                                           <button class="custom-mt-4 button small light-gray text-gray disabled"
                                               data-tooltip-id="product-sku-5"
                                               v-if="product.skus.length <= 1">
                                               <span class="s-icon icon size-16 text-light-gray" style="opacity: .5">
                                                   <svg><use xlink:href='{$_sprite_url}#trash-alt-slash'></use></svg>
                                               </span>
                                           </button>
                                       </div>
                                       {/strip}
                                   </div>
                               </div>
                           </div>

                           <div class="s-modifications-section" v-if="sku.render_skus">
                               <div class="s-modifications-list" v-if="sku.expanded">

                                    <div class="s-modification-wrapper"
                                        v-for="(sku_mod, sku_mod_index) in sku.modifications"
                                        v-bind:key="sku_mod.id"
                                        v-bind:class="{ 'is-highlighted' : sku_mod.states.highlight, 'has-error' : (sku_mod.states.error || getSkuModFeaturesTooltip(sku_mod)) }"
                                        v-bind:data-id="sku_mod.id"
                                        v-bind:data-index="sku_mod_index">
                                        <div class="s-sku-table tablebox fixed space-16">
                                            <div class="s-column-move-actions" v-if="product.normal_mode_switch">
                                                <span class="s-action cursor-pointer js-modification-move-toggle text-gray" draggable="true"
                                                        data-tooltip-id="product-sku-6"
                                                        v-if="(sku.modifications.length > 1)">
                                                    <i class="icon size-20"><svg><use xlink:href='{$_sprite_url}#grip'></use></svg></i>
                                                </span>
                                                <span class="s-action disabled text-light-gray"
                                                        data-tooltip-id="product-sku-7"
                                                        v-if="(sku.modifications.length <= 1)">
                                                    <i class="icon size-20"><svg><use xlink:href='{$_sprite_url}#grip-slash'></use></svg></i>
                                                </span>

                                                <template v-if="getSkuModFeaturesTooltip(sku_mod)">
                                                    <span class="s-action" v-bind:data-tooltip-id="getSkuModFeaturesTooltip(sku_mod)">
                                                        <i class="fas fa-exclamation-circle text-red"></i>
                                                    </span>
                                                </template>
                                            </div>

                                            <div class="s-column-view-actions custom-pr-24">

                                                <div class="s-image-wrapper">
                                                    <div class="s-image-item"
                                                        data-tooltip-id="product-sku-8"
                                                        v-if="sku_mod.photo"
                                                        v-bind:style="{ 'background-image': 'url(' + sku_mod.photo.url + ')' }"
                                                        v-on:click.prevent="addProductPhoto($event, sku_mod)"></div>

                                                    <div class="s-image-item"
                                                        data-tooltip-id="product-sku-8"
                                                        v-if="!sku_mod.photo"
                                                        v-on:click.prevent="addProductPhoto($event, sku_mod)">

                                                        <div class="s-icon icon">
                                                            <svg><use xlink:href='{$_sprite_url}#empty-image'></use></svg>
                                                        </div>
                                                    </div>

                                                    <span class="s-action rounded"
                                                            data-tooltip-id="product-sku-9"
                                                            v-if="sku_mod.photo"
                                                            v-on:click.prevent="removeProductPhoto(sku_mod)">

                                                        <span class="icon top size-12 text-red"><i class="fas fa-trash-alt"></i></span>
                                                    </span>
                                                </div>

                                                {strip}
                                                <div class="s-actions nowrap" v-if="product.normal_mode_switch">
                                                    <button class="button circle light-gray" v-on:click.prevent="modificationMainToggle(sku_mod, sku)"
                                                            v-bind:data-tooltip-id="( sku.sku_id === sku_mod.id ? 'product-sku-15': 'product-sku-16')">
                                                        <span class="s-icon" v-bind:class="{ 'text-orange': sku.sku_id === sku_mod.id, 'text-light-gray': sku.sku_id !== sku_mod.id }"><i class="fas fa-check-circle"></i></span>
                                                    </button>

                                                    <template v-if="checkSkuModFrontFeatures(sku_mod)">
                                                        <button class="button circle light-gray" v-on:click.prevent="modificationStatusToggle(sku_mod, sku_mod_index, sku, sku_index)"
                                                                v-bind:title="( sku_mod.status ? '{_w("The SKU variant is visible in the storefront.")|escape}': '{_w("The SKU variant visible in the storefront.")|escape}')">
                                                            <span class="s-icon text-blue" v-show="(sku_mod.status)"><i class="fas fa-eye"></i></span>
                                                            <span class="s-icon text-light-gray" v-show="(!sku_mod.status)"><i class="fas fa-eye-slash"></i></span>
                                                        </button>
                                                    </template>
                                                    <template v-else>
                                                        <button class="button circle light-gray" data-tooltip-id="product-sku-feature-hidden-on-front">
                                                            <span class="s-icon text-yellow"><i class="fas fa-exclamation-triangle"></i></span>
                                                        </button>
                                                    </template>

                                                    <button class="button circle light-gray" v-on:click.prevent="modificationAvailableToggle(sku_mod, sku_mod_index, sku, sku_index)"
                                                            v-bind:data-tooltip-id="( sku_mod.available ? 'product-sku-17': 'product-sku-18')">
                                                        <span class="s-icon icon top size-18 text-green" v-if="sku_mod.available"><svg><use xlink:href='{$_sprite_url}#cart'></use></svg></span>
                                                        <span class="s-icon icon top size-18 text-light-gray" v-if="!sku_mod.available"><svg><use xlink:href='{$_sprite_url}#cart-slash'></use></svg></span>
                                                    </button>
                                                </div>
                                                {/strip}
                                            </div>

                                            <div class="s-column-details">
                                                <div class="s-selectable-features-list"
                                                    v-if="sku_mod.features_selectable.length">
                                                    <component-features v-bind:product="product"
                                                                        v-bind:features="sku_mod.features_selectable"
                                                                        v-bind:vertical="true"
                                                                        v-bind:columns="true"
                                                                        v-on:change="onChangeFrontFeature($event, sku_mod, sku)"
                                                                        v-on:input="onChangeFrontFeature($event, sku_mod, sku)"></component-features>
                                                </div>

                                                <div class="s-prices-wrapper fields vertical"
                                                    v-bind:class="{ 'is-custom': !!sku_mod.additional_prices.length, 'is-default': !sku_mod.additional_prices.length }">

                                                    <template v-if="sku_mod.additional_prices.length">
                                                        <component-plugin-price
                                                            v-bind:field="sku_mod.additional_prices[0]"
                                                            v-bind:errors="errors"
                                                            v-bind:sku_mod="sku_mod"></component-plugin-price>
                                                    </template>

                                                    <div class="field s-field-purchase-price">
                                                        <div class="name">[`Purchase price`]</div>
                                                        <div class="value">
                                                            <input class="small is-number" type="text"
                                                                    v-model="sku_mod.purchase_price"
                                                                    v-bind:class="{ 'state-error' : !!errors['product[skus][' + sku_mod.id + '][purchase_price]'] }"
                                                                    v-on:input="validate($event, 'price', sku_mod, 'purchase_price')">

                                                            <div class="state-error-hint" v-if="!!errors['product[skus][' + sku_mod.id + '][purchase_price]']">
                                                                {_w("Invalid value")|escape}
                                                                <span class="wa-tooltip" data-tooltip-id="price-error">
                                                                    <i class="fas fa-question-circle text-red"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="field s-field-compare-price">
                                                        <div class="name">[`Compare at price`]</div>
                                                        <div class="value">
                                                            <input class="small strike is-number" type="text"
                                                                    v-model="sku_mod.compare_price"
                                                                    v-bind:class="{ 'state-error' : !!errors['product[skus][' + sku_mod.id + '][compare_price]'] }"
                                                                    v-on:input="validate($event, 'price', sku_mod, 'compare_price')">

                                                            <div class="state-error-hint" v-if="!!errors['product[skus][' + sku_mod.id + '][compare_price]']">
                                                                {_w("Invalid value")|escape}
                                                                <span class="s-tooltip-icon" data-tooltip-id="price-error">
                                                                    <i class="fas fa-question-circle text-red"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="field s-field-price">
                                                        <div class="name">[`Price`]</div>
                                                        <div class="value">
                                                            <input class="small bold is-number" type="text"
                                                                    v-model="sku_mod.price"
                                                                    v-bind:class="{ 'state-error' : !!errors['product[skus][' + sku_mod.id + '][price]'] }"
                                                                    v-on:input="validate($event, 'price', sku_mod, 'price')">

                                                            <div class="state-error-hint" v-if="!!errors['product[skus][' + sku_mod.id + '][price]']">
                                                                {_w("Invalid value")|escape}
                                                                <span class="s-tooltip-icon" data-tooltip-id="price-error">
                                                                    <i class="fas fa-question-circle text-red"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="field s-field-currency">
                                                        <div class="name">&nbsp;</div>
                                                        <div class="value">
                                                            <component-dropdown-currency v-bind:currency_code="product.currency" v-bind:currencies="currencies" v-bind:wide="true" v-on:change="product.currency = $event"></component-dropdown-currency>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="s-custom-prices-wrapper fields vertical"
                                                            v-if="sku_mod.additional_prices.length > 1">
                                                    <template v-for="(field, index) in sku_mod.additional_prices">
                                                        <component-plugin-price
                                                            v-if="index > 0"
                                                            v-bind:field="field"
                                                            v-bind:errors="errors"
                                                            v-bind:sku_mod="sku_mod"></component-plugin-price>
                                                    </template>
                                                </div>

                                                <div class="s-extended-content">
                                                    <div class="s-visible-content">
                                                        <div class="s-toggle" v-on:click.prevent="changeModificationExpand(sku_mod, sku_mod_index, sku, sku_index)">
                                                            <span class="s-text">{ { product.normal_mode_switch ? "{_w("Variant parameters")|escape}" : "{_w("Details")|escape}" } }</span>
                                                            <span class="s-icon" v-show="!sku_mod.expanded"><i class="fas fa-angle-down"></i></span>
                                                            <span class="s-icon" v-show="sku_mod.expanded"><i class="fas fa-angle-up"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="s-hidden-content" v-if="sku_mod.expanded">
                                                        <div class="s-plugin-fields-list fields space-24 vertical"
                                                            v-if="sku_mod.additional_fields.length">
                                                            <template v-for="field in sku_mod.additional_fields">
                                                                <component-plugin-field
                                                                    v-if="field.placement === 'top'"
                                                                    v-bind:key="field.id"
                                                                    v-bind:field="field"
                                                                    v-bind:errors="errors"
                                                                    v-bind:sku_mod="sku_mod"></component-plugin-field>
                                                            </template>
                                                        </div>

                                                        <component-fractional-section v-bind:sku_mod="sku_mod"></component-fractional-section>

                                                        <div class="s-features-list-wrapper" v-if="product.normal_mode_switch">
                                                            <div class="s-list-label">[`Features`]</div>
                                                            <component-features v-bind:product="product" v-bind:features="sku_mod.features" v-bind:vertical="true" v-bind:columns="false"></component-features>
                                                        </div>

                                                        <div class="s-plugin-fields-list fields space-24 vertical"
                                                            v-if="sku_mod.additional_fields.length">
                                                            <template v-for="field in sku_mod.additional_fields">
                                                                <component-plugin-field
                                                                    v-if="field.placement === 'bottom'"
                                                                    v-bind:key="field.id"
                                                                    v-bind:field="field"
                                                                    v-bind:errors="errors"
                                                                    v-bind:sku_mod="sku_mod"></component-plugin-field>
                                                            </template>
                                                        </div>

                                                        <div class="s-other-fields fields space-24">
                                                            <div class="field">
                                                                <div class="name unshifted">
                                                                    <div class="flexbox space-8">
                                                                        <div class="s-name wide">[`Attached file`]</div>
                                                                        <div>
                                                                            <span class="wa-tooltip right" data-title="{_w("Attached file")|escape}"><i class="fas fa-question-circle s-icon gray"></i></span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="value">
                                                                    <template v-if="parseInt(sku_mod.id) > 0">
                                                                        <component-file-manager v-bind:sku_mod="sku_mod"></component-file-manager>
                                                                    </template>
                                                                    <template v-else>
                                                                        <p>[`Save product data to attach a file.`]</p>
                                                                    </template>
                                                                </div>
                                                            </div>

                                                            <div class="field">
                                                                <div class="name unshifted">

                                                                    <div class="flexbox space-8">
                                                                        <span class="s-name">{ { product.normal_mode_switch ? "[`Variant ID`]" : "[`SKU ID`]" } }</span>
                                                                        <span class="wa-tooltip right" data-title="{_w("Numeric ID of this variant stored in the database.")|escape}"><i class="fas fa-question-circle s-icon gray"></i></span>
                                                                    </div>

                                                                </div>
                                                                <div class="value middle">
                                                                    <span class="s-ident" v-bind:class="{ 'hint': sku_mod.id < 0 }">{ { sku_mod.id < 0 ? "[`An ID will be shown after saving.`]" : sku_mod.id } }</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="s-column-stocks">
                                                <div class="s-stocks-section">
                                                    <div class="s-visible-part">

                                                        <div class="fields vertical">
                                                            <div class="field">
                                                                <div class="name">[`Quantity`]</div>
                                                                <div class="value">

                                                                    <div class="s-field-wrapper">
                                                                        <div class="s-icon left" v-bind:class="{ 'text-green' : sku_mod.stocks_indicator > 0, 'text-orange' : sku_mod.stocks_indicator == 0, 'text-red' : sku_mod.stocks_indicator < 0 }">
                                                                            <i class="icon size-16"><svg><use xlink:href='{$_sprite_url}#warehouse'></use></svg></i>
                                                                        </div>
                                                                        <input class="small s-field full-width is-number" type="text" placeholder="∞"
                                                                                v-model="sku_mod.count"
                                                                                v-bind:readonly="!!stocks_array.length"
                                                                                v-on:click="focusSkuModStocks(sku_mod)"
                                                                                v-on:input="validate($event, 'number-negative', sku_mod, 'count')">
                                                                    </div>

                                                                    <template v-if="stocks_array.length">
                                                                        <div class="s-toggle" v-on:click.prevent="modificationStocksToggle(sku_mod)">
                                                                            <span class="s-text">{ { sku_mod.stocks_expanded ? {_w("Hide stocks")|json_encode} : {_w("Show stocks")|json_encode} } }</span>
                                                                            <span class="s-icon" v-show="!sku_mod.stocks_expanded"><i class="fas fa-angle-down"></i></span>
                                                                            <span class="s-icon" v-show="sku_mod.stocks_expanded"><i class="fas fa-angle-up"></i></span>
                                                                        </div>
                                                                    </template>

                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class="s-hidden-part" v-if="sku_mod.stocks_expanded">
                                                        <div class="s-stocks-list-section" v-bind:class="{ 'is-large': stocks_array.length > 6 }">
                                                            <div class="s-section-body">
                                                                <div class="s-stocks-list">

                                                                    <template v-for="stock in stocks_array">
                                                                        <div class="s-stock-wrapper">
                                                                            <div class="flexbox middle space-12"
                                                                                data-tooltip-id="product-sku-24"
                                                                                v-bind:data-title="getStockTitle(stock)">

                                                                                <div class="s-column">
                                                                                    <div class="s-field-wrapper">
                                                                                        <div class="s-icon left" v-bind:class="stock_icon_class(sku_mod.stock[stock.id], stock)">
                                                                                            <i class="icon size-16"><svg><use xlink:href='{$_sprite_url}#warehouse'></use></svg></i>
                                                                                        </div>
                                                                                        <input class="small s-field full-width is-number" type="text" placeholder="∞"
                                                                                                v-model="sku_mod.stock[stock.id]"
                                                                                                v-bind:readonly="stock.is_virtual"
                                                                                                v-bind:style="{ 'opacity' : stock.is_virtual ? '.5' : ''}"
                                                                                                v-bind:class="{ 'transparent' : stock.is_virtual }"
                                                                                                v-on:change="changeSkuModStocks(sku_mod)"
                                                                                                v-on:input="validate($event, 'number-negative', sku_mod.stock, stock.id)">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="s-column wide">
                                                                                    <span class="cursor-default"
                                                                                            v-bind:style="{ 'opacity' : stock.is_virtual ? '.5' : '' }">{ { stock.name } }</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </template>

                                                                </div>
                                                            </div>
                                                            <div class="s-section-footer">
                                                                <button class="button small light-gray" type="button" v-on:click.prevent="modificationStocksToggle(sku_mod, false)">[`Close`]</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="s-column-actions tablebox" v-if="product.normal_mode_switch">
                                                {strip}
                                                <div class="s-actions">
                                                    <button class="button small light-gray text-gray"
                                                            data-tooltip-id="product-sku-10"
                                                            v-on:click.prevent="copyModification(sku_mod, sku_mod_index, sku, sku_index)">

                                                        <span class="icon"><i class="fas fa-copy"></i></span>
                                                    </button>
                                                    <button class="custom-mt-4 button small light-gray text-red"
                                                            data-tooltip-id="product-sku-11"
                                                            v-if="sku.modifications.length > 1"
                                                            v-on:click.prevent="removeModification($event, sku_mod, sku_mod_index, sku, sku_index)">

                                                        <span class="s-icon icon size-16">
                                                            <svg><use xlink:href='{$_sprite_url}#trash-alt'></use></svg>
                                                        </span>
                                                    </button>
                                                    <button class="custom-mt-4 button small light-gray disabled"
                                                            data-tooltip-id="product-sku-12"
                                                            v-if="sku.modifications.length <= 1">

                                                        <span class="s-icon icon size-16 text-light-gray" style="opacity: .5">
                                                            <svg><use xlink:href='{$_sprite_url}#trash-alt-slash'></use></svg>
                                                        </span>
                                                    </button>
                                                </div>
                                                {/strip}
                                            </div>
                                        </div>
                                    </div>

                               </div>

                               <div class="s-modifications-actions" v-if="product.normal_mode_switch">
                                   <button class="button light-gray rounded small text-blue" type="button"
                                           v-bind:data-tooltip-id="sku.expanded ? 'product-sku-19' : 'product-sku-20'"
                                           v-on:click.prevent="toggleSkuModifications($event, sku)">
                                       <span class="s-icon" v-show="!sku.expanded">
                                           <i class="fas fa-angle-down"></i>
                                       </span>
                                       <span class="s-icon" v-show="sku.expanded">
                                           <i class="fas fa-angle-up"></i>
                                       </span>
                                       <span class="s-name">{_w("Variants")}: { { sku.modifications.length } }</span>
                                   </button>

                                   <button class="button light-gray rounded small" type="button" v-on:click="addModification(sku, sku_index)">
                                       <span class="s-icon text-green"><i class="fas fa-plus-circle"></i></span>
                                       <span class="s-name">[`Add a variant to the SKU`]</span>
                                   </button>
                               </div>
                           </div>
                       </div>
                    </div>
                </div>
                <div v-if="!product.skus.length">
                    [`No SKUs.`]
                </div>
            </div>

            {* BAGES *}
            <div class="s-product-badges-section js-product-badges-section fields" v-bind:class="{ 'is-minimal-mode' : !product.normal_mode_switch }">
                <div class="tablebox fixed space-16 field">
                    <div class="name">
                        <span class="s-name">[`Badge`]</span>
                        <span class="wa-tooltip inline right" data-title="{_w("An icon or brief caption to highlight this product among others.")|escape}">
                            <i class="fas fa-question-circle s-icon gray"></i>
                        </span>
                    </div>
                    <div class="value">
                        <div class="s-column">
                            <template v-if="product.badges">
                                <div class="s-badges-list">
                                    <template v-for="badge in product.badges">
                                        <div class="s-badge-wrapper"
                                             v-bind:class="{ 'is-active': (badge.id === product.badge_id) }"
                                             v-on:click.prevent="changeProductBadge(badge)">

                                            <span class="s-icon" v-if="badge.id === 'new'"><i class="fas fa-bolt"></i></span>
                                            <span class="s-icon" v-if="badge.id === 'bestseller'"><i class="fas fa-chart-line"></i></span>
                                            <span class="s-icon" v-if="badge.id === 'lowprice'"><i class="fas fa-piggy-bank"></i></span>
                                            <span class="s-icon" v-if="badge.id === ''"><i class="fas fa-code"></i></span>
                                            <span class="s-name">{ { badge.name } }</span>
                                        </div>
                                    </template>
                                    <div class="s-button-wrapper" v-if="product.badge_id !== null">
                                        <button class="button light-gray smaller rounded" v-on:click.prevent="changeProductBadge()">
                                            <span class="s-icon"><i class="fas fa-times text-red"></i></span>
                                            <span class="s-name">[`Remove`]</span>
                                        </button>
                                    </div>
                                </div>

                                <template v-if="product.badge_form">
                                    <component-product-badge-form v-bind:product="product">
                                        {capture assign="_component_product_badge_form"}
                                            <div class="s-badge-form">
                                                <div class="flexbox middle space-8">
                                                    <textarea class="small wide" placeholder="[`Enter a value`]" v-model="badge.code"></textarea>
                                                    <button class="smaller button rounded light-gray text-green" type="button" v-on:click="updateForm">
                                                        <span class="s-icon icon top"><i class="fas fa-check"></i></span>
                                                    </button>
                                                    <button class="smaller button rounded light-gray text-gray" type="button" v-on:click="revertForm">
                                                        <span class="icon top"><i class="fas fa-times"></i></span>
                                                    </button>
                                                </div>
                                            </div>
                                        {/capture}
                                        {$_templates["component-product-badge-form"] = $_component_product_badge_form}
                                    </component-product-badge-form>
                                </template>
                            </template>
                            <template v-else>
                                <p>[`No badges`]</p>
                            </template>
                        </div>
                    </div>

                </div>
            </div>

            {* GENERAL OPTIONS *}
            <div class="s-general-options-section">
                <header class="s-section-header">
                    <h2 class="s-title">[`All product features`]</h2>
                </header>

                <component-features
                    v-bind:key="keys.product_features"
                    v-bind:product="product"
                    v-bind:features="product.features"
                    v-bind:vertical="false"
                    v-bind:columns="false"></component-features>

                <div class="s-section-footer">
                    <button class="button small light-gray rounded" id="js-show-add-feature-dialog"
                            data-type-id="{$product["type_id"]|default:""|escape}"
                            v-bind:disabled="states.load.add_feature">
                        <span class="s-icon text-gray"
                              v-if="states.load.add_feature"
                              v-bind:key="'loading'"><i class="fas fa-spinner fa-spin"></i></span>
                        <span class="s-icon text-green"
                              v-else
                              v-bind:key="'icon'"><i class="fas fa-plus-circle"></i></span>
                        <span class="s-name">[`Add a new feature`]</span>
                    </button>
                </div>
            </div>

            <div class="s-product-params-section">
                <header class="s-section-header">
                    <h2 class="s-title">[`Custom parameters`]</h2>
                </header>

                <div class="alert small">
                    <div class="wa-message white flexbox space-8">
                        <div class="message-icon"><i class="fas fa-info-circle"></i></div>
                        <div class="message-text wide">
                            [`Optional set of custom <em>key=value</em> parameters which can be used in design theme templates as <em>&#123;$product.params.key&#125;</em>. Each key=value pair must be on a separate line.`]
                        </div>
                    </div>
                </div>

                <component-flex-textarea
                    v-model="product.params"
                    v-bind:class="'small wide'"></component-flex-textarea>
            </div>

        </div>

        {* FEATURES HIDDEN ON FRONT *}
        {capture assign="_footer_content"}
            <div class="s-errors-place" v-if="errors.global.length">
                <div class="wa-message small error flexbox space-8" v-for="error in errors.global" v-bind:data-id="error.id" v-bind:key="error.id">
                    <div class="message-icon">
                        <i class="fas fa-exclamation-circle text-red"></i>
                    </div>
                    <div class="message-text wide">{ { error.text } }</div>
                    <div class="message-actions">
                        <div class="message-action" v-on:click.prevent="removeError(null, error)">
                            <i class="fas fa-times message-toggle"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="s-features-hidden-on-front-section" v-if="features_hidden_on_front.length">
                <div class="wa-message small warn flexbox space-8">
                    <div class="message-icon"><i class="fas fa-exclamation-triangle text-yellow"></i></div>
                    <div class="message-text wide">
                        <span class="s-text" v-html="features_hidden_on_front_string"></span>
                        <span class="s-icon" data-tooltip-id="product-sku-features-hidden-on-front"><i class="fas fa-question-circle  gray"></i></span>
                    </div>
                </div>
            </div>
        {/capture}


        <!-- plugin hook: 'backend_prod_content.bottom' -->
        {* @event backend_prod_content.%plugin_id%.bottom *}
        {if !empty($backend_prod_content_event)}{foreach $backend_prod_content_event as $_}{ifset($_.bottom)}{/foreach}{/if}

        {shopSettingsTypefeatFeatureWidgetAction::widget([
            "selection" => "#js-show-add-feature-dialog",
            "product_id" => $product.id|default:"new"
        ])}

        {include file="./includes/footer.html" footer_content=$_footer_content inline}
    </div>

    <script>
        ( function($) {
            $("#js-product-sku-section-wrapper").data("ready", $.Deferred());

            var lang = "{$wa->locale()}";

            var sources = [{
                id: "vue-js",
                type: "js",
                uri: "{$wa_app_static_url}js/backend/vue/{if $wa->debug()}vue.global.js{else}vue.global.prod.js{/if}?v={$wa->version()}"
            }, {
                id: "wa-shop-products-product-sku-js",
                type: "js",
                uri: "{$wa_app_static_url}js/backend/products/product/product.sku.js?v={$wa->version()}"
            }, {
                id: "wa-content-color-picker-js",
                type: "js",
                uri: "{$wa_url}wa-content/js/farbtastic/farbtastic.js?v={$wa->version(true)}"
            }, {
                id: "wa-content-color-picker-css",
                type: "css",
                uri: "{$wa_url}wa-content/js/farbtastic/farbtastic.css?v={$wa->version(true)}"
            }];

            $.wa.loadSources(sources).then(init);

            function init() {
                {$_max_post_size = waRequest::getPostMaxSize()}
                {$_max_file_size = waRequest::getUploadMaxFilesize()}
                {$_max_post_size_mb = floor($_max_post_size * 10/(1024))/10}
                {$_max_file_size_mb = floor($_max_file_size * 10/(1024))/10}
                {$_locales["file_size"] = "{_w("Each file’s size cannot be greater than")} {$_max_file_size_mb}{_w("KB")}."}
                {$_locales["post_size"] = "{_w("Total size of selected files cannot be greater than")} {$_max_post_size_mb|escape}{_w("KB")}."}

                $.wa_shop_products.init.initProductSkuSection({
                    $wrapper: $("#js-product-sku-section-wrapper"),
                    components: {$_components|json_encode},
                    templates: {$_templates|json_encode},
                    tooltips: {$_tooltips|json_encode},
                    locales: {$_locales|json_encode},
                    urls: {
                        "save"                    : "{$wa_app_url}?module=prod&action=saveSku",
                        "sku_delete_dialog"       : "{$wa_app_url}?module=prod&action=skuDeleteDialog",
                        "add_feature_value"       : "{$wa_app_url}?module=prod&action=addFeatureValue",
                        "change_image_dialog"     : "{$wa_app_url}?module=prod&action=skuImageDialog",
                        "add_product_image"       : "{$wa_app_url}?module=prod&action=imageUpload",
                        "change_image_description": "{$wa_app_url}?module=prod&action=saveImageDetails",
                        "delete_image"            : "{$wa_app_url}?module=prod&action=deleteImage",
                        "color_transliterate"     : "{$wa_app_url}?module=settingsTypefeat&action=featuresHelper",
                        "sku_file_upload"         : "{$wa_app_url}?module=prod&action=addSkuFile",
                        "sku_file_delete"         : "{$wa_app_url}?module=prod&action=deleteSkuFile",
                        "format_feature"          : "{$wa_app_url}?module=prod&action=formatFeature"
                    },

                    max_file_size: {$_max_file_size|json_encode},
                    max_post_size: {$_max_post_size|json_encode},

                    new_sku: {$new_sku|json_encode},
                    new_modification: {$new_modification|json_encode},

                    stocks: {$stocks|array_values|json_encode},
                    product: {$formatted_product|json_encode},
                    currencies: {$currencies|json_encode},
                    selectable_features: {$formatted_selectable_features|json_encode}
                });

                $(document).trigger("wa_product_section_change", "product-sku");
            }
        })(jQuery);
    </script>
</div>
